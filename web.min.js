Array.prototype.filterObjects=function(key,value){return this.filter(function(x){return x[key]===value})};Array.prototype.removeItem=function(key,value){if(value==undefined)return;for(var i in this){if(this[i][key]==value){this.splice(i,1)}}};Object.merge=function(o1,o2){if(typeof o1=="object"&&typeof o2=="object"){for(var i in o2){o1[i]=o2[i]}return o1}throw new Error("Arguments are not Objects")};(function(R,undefined){$("#v2_Phone_Icon").hide();var path=FULLClient.require("path");function getConfig(){var config;try{config=require(path.join(process.resourcesPath,"app","config","config.json"))}catch(e){config=require(path.join(process.cwd(),"config","config.json"))}return config}function getFilePath(){if(getConfig()&&getConfig().mode=="code"){return process.cwd()}else{return path.join(path.join(process.resourcesPath,"app"))}}function getManifest(){var manifest;try{manifest=require(path.join(process.resourcesPath,"app","package.json"))}catch(e){manifest=require(path.join(process.cwd(),"package.json"))}return manifest}FULLClient.name="FULLClientGlobal";FULLClient.canQuit=false;FULLClient.log=function(){var tmp=[];for(var i=arguments.length-1;i>=0;i--){tmp[i]=arguments[i]}tmp.splice(0,0,"["+this.name+"] : ");console.debug.apply(console,tmp)};FULLClient.quit=function(){};FULLClient.isElectron=function(){return process.versions["electron"]};FULLClient.config=getConfig();FULLClient.manifest=getManifest();FULLClient.getManifest=getManifest;FULLClient.getMode=function(){return this.config.mode};FULLClient.isModeValid=function(mode){if(["1.x","test-1.x","lily"].indexOf(mode)!==-1){return true}};FULLClient.setMode=function(mode){if(this.isModeValid(mode)){this.config.mode=mode;util.app.update();return true}throw new Error("Mode is not compatible : "+mode)};FULLClient.getAppName=function(){if(/^darwin/.test(process.platform))return path.basename(process.execPath).substring(0,path.basename(process.execPath).lastIndexOf(" "));else return path.basename(process.execPath).substring(0,process.execPath.lastIndexOf("\\"))};FULLClient.getConfig=function(){return this.config[this.getMode()]};FULLClient.getFilePath=getFilePath;FULLClient.getAppPath=function(){return FULLClient.getFilePath().replace(/([/]Contents.*)/g,"")};FULLClient.set=function(key,value){this[key]=value};FULLClient.getAsarPath=function(){var arr=FULLClient.getManifest().main.match(/(.*asar)/g);return arr&&arr.length?"../"+arr[0]:"../asar/full.asar"}})(this);var shell=FULLClient.require("electron").shell;var path=FULLClient.require("path");var clipboard=require("electron").clipboard;var remote=require("electron").remote;var util={name:"utilities",log:function(){console.debug.apply(console,arguments)}};util.hasSpecialCharacters=function(data){var regex=/([^a-zA-Z0-9])/;if(typeof data=="string"&&data&&!regex.test(data)){return false}return true};util.getSharedObject=function(){return remote.getGlobal("sharedObject")};util.isHttps=function(url){return url&&url.includes("https://")};util.document={shadowRootFocus:function(webView){if(webView&&webView.shadowRoot){webView.shadowRoot.querySelector("object").focus();this.releaseFocus();return true}},releaseFocus:function(){const element=document.createElement("span");document.body.appendChild(element);const range=document.createRange();range.setStart(element,0);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);selection.removeAllRanges();document.body.removeChild(element)},claimFocus:function(){const activeElement=document.activeElement;const selection=window.getSelection();var selectionStart,selectionEnd,range;if(activeElement){selectionStart=activeElement.selectionStart;selectionEnd=activeElement.selectionEnd}if(selection.rangeCount)range=selection.getRangeAt(0);const restoreOriginalSelection=function(){if(selectionStart>=0&&selectionEnd>=0){activeElement.selectionStart=selectionStart;activeElement.selectionEnd=selectionEnd}else if(range){selection.addRange(range)}};requestAnimationFrame(restoreOriginalSelection)}};util.showBadgeLabel=function(count){if(!count)count="";var text=count.toString().trim(),cDom=document.querySelector("canvas");var canvas=cDom?cDom:document.createElement("canvas");canvas.height=140;canvas.width=140;var ctx=canvas.getContext("2d");ctx.fillStyle="red";ctx.beginPath();ctx.ellipse(70,70,70,70,0,0,2*Math.PI);ctx.fill();ctx.textAlign="center";ctx.fillStyle="white";if(text.length>2){ctx.font="75px sans-serif";ctx.fillText(""+text,70,98)}else if(text.length>1){ctx.font="100px sans-serif";ctx.fillText(""+text,70,105)}else{ctx.font="125px sans-serif";ctx.fillText(""+text,70,112)}if(count&&parseInt(count)){FULLClient.ipc.send({eType:"setOverlayIcon",dataURL:canvas.toDataURL()});return text}else{FULLClient.ipc.send({eType:"setOverlayIcon",count:null})}return false};util.escapeSpaces=function(str){if(str&&typeof str=="string"){return str.replace(/[ ]/g,"\\ ")}};util.getTempDirectory=function(){return process.env.TMPDIR||process.env.TEMP||process.env.TMP};util.print={appInfo:function(){var tmp={mode:FULLClient.getMode(),packageJson:FULLClient.getManifest(),config:FULLClient.getConfig(),asarPath:FULLClient.getAsarPath()};return tmp}};util.scripts={get:function(){return document.scripts[document.scripts.length-1]}};util.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}};util.doNotBubble=function(e){if(e){e.cancelBubble=true}};util.mocha={sb:function(){FULLClient.ipc.send({eType:"open",title:"sbMocha"})},v2:function(){FULLClient.ipc.send({eType:"open",title:"v2Mocha"})}};util.analytics={push:function(accountNumber,eventAction,connId,metaInfo){util.publish("/analytics/push",accountNumber,eventAction,connId,metaInfo)}};util.user={isUserInfoAvailable:function(){return userDAO.getUser()?userDAO.getUser():false},getEmail:function(){var _user=this.isUserInfoAvailable();if(_user){return _user.email}}};util.getRemote=function(){return FULLClient.require("electron").remote};util.preventEvent=function(e){if(e){e.cancelBubble?e.cancelBubble=true:false;e.preventDefault?e.preventDefault():false}};util.getDemoLines=function(){return["8007066511","8004616705","8004617310","8004619489","8004619578","8008050816","8008352647","8004611592","8004614207","8004615165","8004617420","8007047593","8007066572","8004618540","8004612449","8004619537","8008087316","8004615398","8004617493","8007047614","8004611676","8006800906","8004612458","8004614214","8007066573","8004618597","8004612596","8007047591","8004618658","8008087751","8007047635","8004611683","8005456981","8004614237","8004618497","8004615406","8007066604","8004618659","8004614259","8007047636","8007047643","8004612413","8004614359","8005457026","8004614250","8004618512","8004616486","8008088543","8007066609","8004612435","8007047641","8004614784","8006800797","8004618523","8004615502","8004614354","8004616508","8006352757","8008088612","8007066615","8004614425","8004616495","8004618524","8004616539","8004610376","8006352780","8004612497","8004618678","8006800904","8007047684","8004614706","8007066617","8004612597","8004618552","8006800910","8004610485","8007066618","8007095720","8004617250","8008038489","8008038490","8008038514","8008038516","8008038529","8008038532","8008038533","8008352608","8008352718","8008352909","8008353022","8008353430","8008391943","8008392012","8008392169","8008392197","8008392252","8006352720","8004612183","8004612417","8773257467","8773257468","8773257480","8773257488","8773257495","8773257496","8773257497","8773257498","8773257499","8773257763","8773257785","8773258200","8773258711","8773258981","8773259051","8773259052","8773259055","8773259056","8773259060","8773259063","8773259064","8773259065","8773259070","8773259073","8773259742","8773261118","8773261123","8773261142","8773261919","8773265164","8773265367","8773265371","8773265607","8773265961","8773267997","8773267998","8773268102","8773269238","8773269321","8773271035","8773271271","8773271601","8773271602","8773271606","8773271607","8773271750","8773271981","8773272107","8773272242","8773272246","8773272285","8773272483","8773273082","8773273292","8773273937","8773275427","8773275687","8773276074","8773276078","8773276079","8773276080","8773276081","8773276085","8773276270","8773276637","8773276966","8773277162","8773278001","8773278408","8773278409","8773278693","8773278842","8773279172","8773279682","8773280314","8773281194","8773281286","8773281357","8773281416","8773281886","8773282321","8773282399","8773282475","8773282826","8773283207","8773283285","8773285258","8773286354","8773287453","8773288576","8773289801","8773290433","8773290598","8773290615","8773291275","8773291279","8773299571","8773299576","8773299969","8773299970"]};util.getParameterByName=function(name,url){if(name&&url){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(url);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "))}};util.getParameters=function(url){if(!url)return{};var keyValue={};if(url.indexOf("?")!==-1){var lUrl=url.split("?");lUrl=lUrl[1].split("&");for(var i=lUrl.length-1;i>=0;i--){var key,value;key=lUrl[i].split("=")[0];value=lUrl[i].split("=")[1];keyValue[key]=value;if(/connid/.test(key))keyValue["connId"]=value}}return keyValue};util.isFetch=function(params){if(params&&(params.fetch||params.isAgentResearch)){return true}};util.isEmail=function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)};util.loadWebSiteInBrowser=function(url){if(util.isUrl(url)){shell.openExternal(url)}};util.loadWebSiteInNewWindow=function(url){if(util.isUrl(url)){FULLClient.emitter.sendToMain({eType:"loadWebsiteInNewWindow",url:url})}};util.loadURL=function(url,options,cb){var newurl;if(url){url+=url.indexOf("?")!=-1?"":"?";if(url.indexOf("http")==-1&&(newurl="http://"+url)&&this.isUrl(newurl)){url=newurl}}if(this.isUrl(url)){if(util.window.getName()==namespace.CONTAINER_SB){this.publish("/tab/controller/create",url,options,cb)}else{var accLoad=new SBcommunication("accountOpt");accLoad[accLoad.opt].opt="load";accLoad[accLoad.opt].url=url;FULLClient.ipc.sendToSB(accLoad)}return}throw new Error("Invalid URL : "+url)};util.publish=function(scheme,context){amplify.publish.apply(amplify,arguments)};util.subscribe=function(scheme,context){amplify.subscribe.apply(amplify,arguments)};util.unsubscribe=function(scheme,context){amplify.unsubscribe.apply(amplify,arguments)};util.debug={_activateDebug:function(){util.log("Debugging : ",util)},_deActivateDebug:function(){},on:function(){this._activateDebug();util.publish("/debug/switch/global/on")},off:function(){util.publish("/debug/switch/global/off")}};util.getBrowserWindow=function(){return this.getRemote().BrowserWindow};util.getAllWindows=function(){return this.getBrowserWindow().getAllWindows()};util.notification={truncate:function(str,charRestrictionCount){if(str&&charRestrictionCount&&str.length>charRestrictionCount){return str.substr(0,charRestrictionCount)}return str},isValid:function(nObj){return nObj&&nObj.title&&nObj.body},getTitle:function(nObj){return this.truncate(nObj.title,45)},getBody:function(nObj){return this.truncate(nObj.body,150)},create:function(nObj){if(this.isValid(nObj)){var n=new ClientListener("notify");n[n.opt].title=this.getTitle(nObj);n[n.opt].body=this.getBody(nObj);util.publish("/notification/create/show",n)}},prevent:function(){if(/^win/.test(process.platform)){console.warn("preventing native notifications");util.getCurrentWindow().webContents.session.setPermissionRequestHandler(function(webContents,permission,callback){if(permission==="notifications"){return callback(false)}callback(true)});return true}}};util.caching={windows:{v2:null,sb:null,chat:null,timer:null,reset(){this.v2=this.sb=this.chat=this.timer=null},getByTitle(){return this.getTarget(util.window.getName())},getV2(){return this.v2?this.v2:this.getTarget(namespace.CONTAINER_V2)},getSB(){return this.sb?this.sb:this.getTarget(namespace.CONTAINER_SB)},getChat(){return this.chat?this.chat:this.getTarget(namespace.CONTAINER_CHAT)},getTimer(){return this.timer?this.timer:this.getTarget(namespace.CONTAINER_TIMER)},getTarget(title){var targetArray=util.getAllWindows();for(var i=targetArray.length-1;i>=0;i--){if(targetArray[i].getURL().indexOf(title+".html")!==-1){switch(title){case namespace.CONTAINER_V2:{this.v2=targetArray[i];return this.v2}case namespace.CONTAINER_CHAT:{this.chat=targetArray[i];return this.chat}case namespace.CONTAINER_TIMER:{this.timer=targetArray[i];return this.timer}default:{this.sb=targetArray[i];return this.sb}}}}}}};util.getCurrentWindow=function(){return this.caching.windows.getByTitle()||this.getRemote().getCurrentWindow()};util.clear=function(){if(!util.clear.isCleared){util.clear.isCleared=true;this.httpCache.clear();this.cookies.clear();this.storage.clear();userDAO.clear()}};util.persistentStorage={clear:function(cb){var storage=["appcache","cookies","indexdb","local storage"];var quota=["temporary","persistent","syncable"];util.getCurrentWindow().webContents.session.clearStorageData({storage:storage,quotas:quota},cb||function clearStorage(){console.warn("storage clear for following ",storage,quota)})}};util.flush=function(){util.getCurrentWindow().webContents.session.flushStorageData()};util.webview={post:function(webview,msg,channel){if(webview&&msg&&typeof msg=="object"){webview.send(channel||"webapp-msg",msg)}}};util.getInitObj=function(tabId){return{name:"init",opt:"userinfo",init:{tabIndex:tabId,contactInfo:JSON.stringify(userDAO.getUserDcmResponse())},isElectron:true,source:"AnyWhereWorks"}};util.storage={isAvailable:function(){return typeof Locstor=="function"?true:false},set:function(k,v){if(k&&v&&this.isAvailable()){Locstor.set(k,v)}},get:function(k){if(k&&this.isAvailable()){return Locstor.get(k)}},clear:function(){if(this.isAvailable()){util.log("LOCALSTORAGE is getting cleared !!");Locstor.clear()}}};util.window={getName:function(){var scripts=util.scripts.get();var title;switch(path.basename(scripts.src)){case"chatContainer.js":{title=namespace.CONTAINER_CHAT;break}case"webContainer.js":{title=namespace.CONTAINER_SB;break}case"v2Container.js":{title=namespace.CONTAINER_V2;break}case"hiddenWindow.js":{title=namespace.HIDDEN_CONTAINER;break}default:{break}}return title}};util.httpCache={remove:function(){var remote=util.getRemote();var win=remote.getCurrentWindow?remote.getCurrentWindow():false;if(win){win.webContents.session.clearCache(function(){util.log("CacheCleared ",arguments)})}},clear:function(){util.log("httpCache is getting cleared !!");this.remove()}};util.copy=function(text){clipboard.writeText(text)};util.clipboard={read:function(){var tc=new Thinclient("readFromClipboard"),option=tc[tc.opt],image=this.readImage();if(image.isEmpty()){option.type="text";option.text=this.readText()}else{option.type="Image";option.image=image}return tc},readImage:function(){var data=clipboard.readImage();var imgUrl=!data.isEmpty()?data.toDataUrl():"";return{dataUri:imgUrl,size:data.getSize(),isEmpty:imgUrl?false:true}},writeImage:function(path){return clipboard.writeImage(path)},readText:function(){return clipboard.readText()},writeText:function(text){return text?clipboard.writeText(text):false}};util.cookies={clear:function(){util.log("COOKIES is getting cleared !!");this.removeAllCookies()},_delete:function(cookies,win,dfd){if(typeof cookies=="object"&&win){var args=[],cb=function(error){if(error)dfd?dfd.reject("Error"):false;else dfd.resolve("success")},URL="http"+(cookies.secure?"s":"")+"://"+cookies.domain+cookies.path;console.log("url : "+URL+", cookies name : "+cookies.name);args.push(URL);args.push(cookies.name);args.push(cb);win.webContents.session.cookies.remove.apply(null,args)}},get:function(domainName,cb){var remote=util.getRemote(),cookieDomainObj={},win=remote.getCurrentWindow?remote.getCurrentWindow():false;if(domainName)cookieDomainObj["domain"]=domainName;win.webContents.session.cookies.get(cookieDomainObj,cb)},remove:function(domainName){if(domainName)return this.removeAllCookies(domainName);throw Error("Domain name is not Valid "+domainName)},getDFDs:function(length){var tmp=[];for(var i=0;i<length;i++){tmp.push($.Deferred())}return tmp},cookieDeletion:function(arr){$.when.apply($,arr).done(function(){console.log("Cleared Cookies successfully ");util.publish("/app/cookies/cleared")}).fail(function(){console.log("failed")})},removeAllCookies:function(domainName){var removeDFD=[],self=this,remote=util.getRemote(),cookieDomainObj={},keys,win=remote.getCurrentWindow?remote.getCurrentWindow():false;if(domainName)cookieDomainObj["domain"]=domainName;if(win){win.webContents.session.cookies.get(cookieDomainObj,function(error,cookies){keys=Object.keys(cookies);removeDFD=util.cookies.getDFDs(keys.length);util.cookies.cookieDeletion(removeDFD);for(var i=0;i<keys.length;i++){self._delete(cookies[keys[i]],win,removeDFD[i])}})}return removeDFD}};util.gmail={session:function(){util.cookies.get("google.com",function(error,cookies){if(error){return}var len=cookies.filter(function(cookie){return/HID|SSID/.test(cookie.name)}).length;if(!len){console.warn("Gmail session InActive.")}else{console.log("Gmail session active.")}})}};util.accessMods={mask:{enumerable:false,writable:true,configurable:false},protected:{enumerable:true,writable:false,configurable:false},private:{enumerable:false,writable:false,configurable:false}};util.UI={v2:$("#v2_Phone_Icon")};util.v2={getV2LastReceivedStatus:function(){var v2Obj=Locstor.get("v2");var status=null;if(v2Obj){status=v2Obj.lastReceivedStatus}return status},isV2LoggedIn:function(){var v2=util.storage.get("v2");if(v2&&v2.loggedIn){return true}else return false},isV2Available:function(){return true},getStatusList:function(){return["Email","Offline","ActiveResponse","Active Response","AfterCallWorks","AfterCallWork","Default","Busy","Available","Repeat","Chat","Lunch","Meeting","Personal","Project","Training","System","Break","Break2","Break3","PendingBusy","CallingCustomer","FailedConnectAgent","Video Call","Book Time","Synclio Call","Learning"]},passOriginalEvent:function(originalObject){if(!this.isV2Available())return;if(typeof originalObject=="object"&&originalObject.name=="v2Communication"){FULLClient.ipc.sendToV2(originalObject);return true}},getV2Url:function(){return util.config.getV2url().split(/^(.*.com)/)[1]+"/AgentInfoAction/saveAgentInfo.do"},getAjaxData:function(StatusString,connIdString,isDummyBoolean){return new UserClockStatus(StatusString,connIdString,isDummyBoolean)},getAjaxDetails:function(StatusString,connIdString,isDummyBoolean){return{type:"POST",url:this.getV2Url(),data:this.getAjaxData(StatusString,connIdString||"N/A",!!isDummyBoolean)}},pushStatusToYoco:function(StatusString,connIdString,isDummyBoolean){if(StatusString,connIdString){return $.ajax(this.getAjaxDetails(StatusString,connIdString,isDummyBoolean))}throw new Error("Not Valid statusPush params ",{StatusString:StatusString,connIdString:connIdString,isDummyBoolean:isDummyBoolean})},statusPush:function(sObj){if(typeof sObj=="object"&&new RegExp(sObj.status,"g").test(this.getStatusList())){if(!this.isV2LoggedIn()){console.log("V2 is not LoggedIn ... sending status to YOCO  :",sObj.status);this.pushStatusToYoco(sObj.status,"N/A",true)}else{var v2=new V2Communication("statusPush");v2.statusPush=sObj.status;v2.isInterruptible=sObj.isInterruptible;v2.source="FULLClient_utilities";v2.isForce=true;FULLClient.ipc.sendToV2(v2);return true}}},dial:function(no){if(!this.isV2Available())return;if(util.isNumber(no)){var dNo=new V2Communication("outbound");dNo[dNo.opt].phoneNumber=no;dNo.source="FULLClient_utilities";dNo.isForce=true;FULLClient.ipc.sendToV2(dNo);return true}}};util.isUrl=function(s){var regexp=/(file|ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return s?regexp.test(s):false};util.replaceAll=function(Source,stringToFind,stringToReplace){var temp=Source;var index=temp.indexOf(stringToFind);while(index!=-1){temp=temp.replace(stringToFind,stringToReplace);index=temp.indexOf(stringToFind)}return temp};util.isNumber=function(n){return!isNaN(parseFloat(n))&&isFinite(n)};util.crashReporter={port:null,_portDFD:null,getDFD:function(){if(!this._portDFD){this._portDFD=$.Deferred()}return this._portDFD},getPort:function(){if(!this._portDFD){this.hook()}FULLClient.ipc.send({eType:"crashReporter",source:util.window.getName()=="AnyWhereWorks"?"Chat":util.window.getName(),opt:"port"})},setPort:function(port){if(util.isNumber(port)){this.port=port;this.getDFD().resolve(port)}},hook:function(){util.log("Hook Crash collector DFD ");this.getDFD().done(function(port){util.log("Dynamic port been Captured in Crash Reporter",port);if(port){util.log("Starting crash reporter in Browser Window "+document.title);var crashReporter=util.getRemote().crashReporter;crashReporter.start({productName:"FULLClient-Electron",companyName:"FULLCreative",autoSubmit:true,submitURL:"http://localhost:"+port+"/crashreporter",extra:{githuburl:"https://github.com/kamesh-a",email:"kamesh.arumugam@a-cti.com",contact:"+919884228421",crashreport:"Please contact us regarding this report "}})}})},init:function(){this.getPort()}};util.windowEvents={show:function(containerName){if(containerName){FULLClient.ipc.send({title:containerName,eType:"windowEvents",opt:"show"})}},focus:function(containerName){if(containerName){FULLClient.ipc.send({title:containerName,eType:"windowEvents",opt:"focus"})}},restore:function(containerName){if(containerName){FULLClient.ipc.send({title:containerName,eType:"windowEvents",opt:"restore"})}},minimize:function(containerName){if(containerName){FULLClient.ipc.send({title:containerName,eType:"windowEvents",opt:"minimize"})}},hide:function(containerName){if(containerName){FULLClient.ipc.send({title:containerName,eType:"windowEvents",opt:"hide"})}}};util.config={getSBurl:function(){return FULLClient.getConfig().sb5},getOldV2url:function(){var config=FULLClient.getConfig().v2;if(typeof config=="string")return config;else if(typeof config=="object")return config.old},getV2url:function(){var config=FULLClient.getConfig().v2;if(typeof config=="string")return config;else if(typeof config=="object")return config.new}};util.mouse={callback:null,registerCB:function(fn,context){if(fn&&typeof fn=="function"){this.callback=fn}},execute:function(type){if(this.callback){this.callback.call(null,{etype:"contextmenu",action:"click",menu:type})}else if(type){switch(type){case"cut":{util.publish("/tab/controller/mouse/"+type);break}case"copy":{util.publish("/tab/controller/mouse/"+type);break}case"paste":{util.publish("/tab/controller/mouse/"+type);break}case"replace":{util.publish("/tab/controller/mouse/"+type);break}default:{break}}}}};util.app={restart:function(){util.flush();util.publish("/app/restart/commence")},update:function(){if(util.window.getName()!=namespace.CONTAINER_SB){util.publish("/asar/update/commence")}else{FULLClient.ipc.sendToChat({mode:FULLClient.getMode(),name:"setMode"})}}};util.sendMessage={isValidMsg(message){return message&&typeof message=="object"?true:false},toMediator(message){if(this.isValidMsg(message))FULLClient.emitter.sendToMediator(message)},toMain(message){if(this.isValidMsg(message))FULLClient.emitter.sendToMain(message)},toSB(message){if(this.isValidMsg(message))FULLClient.emitter.sendToSB(message)},toChat(message){if(this.isValidMsg(message))FULLClient.emitter.toChat(message)},toV2(message){if(this.isValidMsg(message))FULLClient.emitter.toV2(message)},toWebview(message){FULLClient.emitter.toWebview(message)}};util.subscribe("/util/sendMessage/toMediator",util.sendMessage,util.sendMessage.toMediator);util.subscribe("/util/sendMessage/toMain",util.sendMessage,util.sendMessage.toMain);util.subscribe("/util/sendMessage/toSB",util.sendMessage,util.sendMessage.toSB);util.subscribe("/util/sendMessage/toChat",util.sendMessage,util.sendMessage.toChat);util.subscribe("/util/sendMessage/toV2",util.sendMessage,util.sendMessage.toV2);util.subscribe("/util/sendMessage/toTimer",util.sendMessage,util.sendMessage.toTimer);util.subscribe("/util/sendMessage/toWebview",util.sendMessage,util.sendMessage.toWebview);util.checkForUpdates={isFromMenu:function(){var update=util.storage.get("update");if(update&&update.checkForUpdates)return true;else return false},setFlag:function(bool){util.storage.set("update",{checkForUpdates:bool})}};util.zoom={zoomInEnabled:true,zoomOutEnabled:true,updateUIOnFocus:function(win){var contact=userDAO.getUser();if(contact){if(win){if(!win.zoomLevel){this.enableBothForcibly()}else if(win.zoomLevel==namespace.ZOOMOUT_LIMIT){this.disableInUI(namespace.ZOOMOUT);this.enableZoomIn(true)}else if(win.zoomLevel==namespace.ZOOMIN_LIMIT){this.disableInUI(namespace.ZOOMIN);this.enableZoomOut(true)}else{this.enableBothForcibly()}}}},disableAllOnClearCache:function(){this.postToBackground(namespace.DISABLE,namespace.ALL);this.setFlag(namespace.ZOOMIN,false);this.setFlag(namespace.ZOOMOUT,false)},enableBoth:function(){this.enableZoomIn();this.enableZoomOut()},enableBothForcibly:function(){this.postToBackground(namespace.ENABLE,namespace.BOTH);this.setFlag(namespace.ZOOMIN,true);this.setFlag(namespace.ZOOMOUT,true)},enableZoomIn:function(isForce){if(isForce||!this.zoomInEnabled){this.postToBackground(namespace.ENABLE,namespace.ZOOMIN);this.setFlag(namespace.ZOOMIN,true)}},enableZoomOut:function(isForce){if(isForce||!this.zoomOutEnabled){this.postToBackground(namespace.ENABLE,namespace.ZOOMOUT);this.setFlag(namespace.ZOOMOUT,true)}},disableInUI:function(zoomType){this.postToBackground(namespace.DISABLE,zoomType);this.setFlag(zoomType,false)},setFlag:function(zoomType,bool){if(zoomType==namespace.ZOOMIN){this.zoomInEnabled=bool}else{this.zoomOutEnabled=bool}},postToBackground:function(switchType,option){if(switchType&&option){var bg=new PostToBackground("menuActions");bg[bg.choice].opt=switchType+option;FULLClient.emitter.sendToMain(bg[bg.choice])}},getActiveTab:function(){var tab=util.tabs&&util.tabs.getActiveTab()||document.querySelector("webview#LoginModule");return tab},isUnderThreshold:function(zoomLevel){if(zoomLevel>=namespace.ZOOMOUT_LIMIT&&zoomLevel<=namespace.ZOOMIN_LIMIT){return true}else{return false}},isAtThreshold:function(zoomLevel){if(zoomLevel==namespace.ZOOMOUT_LIMIT||zoomLevel==namespace.ZOOMIN_LIMIT){return true}else{return false}},setZoomLevel:function(win,zoomLevel,zoomType){if(this.isUnderThreshold(zoomLevel)){win.setZoomLevel(zoomLevel);win.zoomLevel=zoomLevel;if(this.isAtThreshold(zoomLevel)){this.disableInUI(zoomType)}}},zoomIn:function(win){if(win){if(!win.zoomLevel){win.zoomLevel=namespace.ZOOM_ACTUAL_SIZE}this.enableZoomOut();this.setZoomLevel(win,win.zoomLevel+namespace.ZOOM_FACTOR,namespace.ZOOMIN)}},zoomOut:function(win){if(win){if(!win.zoomLevel){win.zoomLevel=namespace.ZOOM_ACTUAL_SIZE}this.enableZoomIn();this.setZoomLevel(win,win.zoomLevel-namespace.ZOOM_FACTOR,namespace.ZOOMOUT)}},resetZoom:function(win){if(win){this.enableBoth();win.setZoomLevel(namespace.ZOOM_ACTUAL_SIZE);win.zoomLevel=namespace.ZOOM_ACTUAL_SIZE}}};util.subscribe("/util/menu/disableAll/onClearCache",util.zoom,util.zoom.disableAllOnClearCache);util.engine={getMinorVersion:function(){return parseInt(process.versions["electron"].split(".")[1])},getMajorVersion:function(){return parseInt(process.versions["electron"].split(".")[0])}};util.subscribe("/util/window/events/show",util.windowEvents,util.windowEvents.show);util.subscribe("/util/window/events/hide",util.windowEvents,util.windowEvents.hide);util.subscribe("/util/window/events/restore",util.windowEvents,util.windowEvents.restore);util.subscribe("/util/window/events/focus",util.windowEvents,util.windowEvents.focus);util.subscribe("/util/window/events/minimize",util.windowEvents,util.windowEvents.minimize);util.init=function(){this.crashReporter.init();this.notification.prevent()};util.subscribe("/util/crashreporter/set/port",util.crashReporter,util.crashReporter.setPort);util.subscribe("/util/v2/push/original/event",util.v2,util.v2.passOriginalEvent);util.subscribe("/util/v2/statusPush",util.v2,util.v2.statusPush);util.subscribe("/util/v2/dialNumber",util.v2,util.v2.dial);util.subscribe("/util/v2/windows/caching/reset",util.caching.windows,util.caching.windows.reset);(function(R){var projectMap={default:null,answerconnectId:"YH0D44",adaptavantId:"91dfed2f-d29f-4302-89ee-341e9364b941"};var accessModifier={mask:{enumerable:false,writable:true,configurable:false},protected:{enumerable:true,writable:false,configurable:false},private:{enumerable:false,writable:false,configurable:false}};var self=userInfoObject={user:{},loggedIn:false,setloggedIn:function(flag){this.loggedIn=flag},isloggedIn:function(){return this.loggedIn},isUserObjectValid:function(lUserInfo){lUserInfo=lUserInfo||this.user;return lUserInfo&&lUserInfo["success"]&&lUserInfo["contact"]&&lUserInfo["contact"].login?true:false},getContactLocalStorage:function(){try{return Locstor.get("userContactInfo")}catch(e){console.error("Exception while getting in LocalStorage, User INFO : "+e.message);console.error("Exception while getting in LocalStorage, User INFO : ",e.stack);return{}}},setContactLocalStorage:function(user){try{return Locstor.set("userContactInfo",user)}catch(e){console.error("Exception while setting in LocalStorage, User INFO : "+e.message);console.error("Exception while setting in LocalStorage, User INFO : ",e.stack);return false}},setV2Login:function(login){var user=this.getContactLocalStorage();if(login&&user&&user.contact){user.contact.v2Login=login;return this.setUser(user)}},getUserDcmResponse:function(){try{if(self.isUserObjectValid(self.user)||self.isUserObjectValid(self.user=self.getContactLocalStorage()))return self.user}catch(userInfoException){console.error(userInfoException.message);console.error(userInfoException.stack)}return false},getAccessToken:function(){return this.user["accessToken"]||this.getContactLocalStorage()["accessToken"]},setAccessToken:function(token){console.warn("We are trying to set Access token ",token);if(token&&this.user){this.user["accessToken"]=token;this.setUser(this.user);return this.user["accessToken"]}},getUser:function(){try{if(self.isUserObjectValid(self.user)||self.isUserObjectValid(self.user=self.getContactLocalStorage()))return self.user.contact}catch(userInfoException){console.error(userInfoException.message);console.error(userInfoException.stack)}return false},setUser:function(userObject){try{if(typeof userObject=="object"&&this.isUserObjectValid(userObject)){self.user=userObject;self.user.contact?function(){self.user.contact.email=self.user.contact.login;self.user.contact.fullname=self.user.contact.fullName=self.user.contact.firstName+" "+self.user.contact.lastName}():false;self.setContactLocalStorage(self.user);return self.getUserDcmResponse()}else{return false}}catch(userInfoException){console.error("Error While Setting User Object : "+userInfoException.message);console.error("Error While Setting User Object : ",userInfoException.stack);return false}},getUserContactSkillSet:function(){try{if(self.isUserObjectValid(self.user)||self.isUserObjectValid(self.user=self.getContactLocalStorage()))return self.user.contactSkillSet}catch(userInfoException){console.error(userInfoException.message);console.error(userInfoException.stack)}return false},getUserSkillSet:function(){try{if(self.isUserObjectValid(self.user)||self.isUserObjectValid(self.user=self.getContactLocalStorage()))return self.user.skillSet}catch(userInfoException){console.error(userInfoException.message);console.error(userInfoException.stack)}return false},getSkillByType:function(type,typeValue,queryType){if(!typeValue||!type||!queryType)return false;try{var tmpSkillObj,skillSetArray=this[queryType]();if(skillSetArray&&skillSetArray.length){for(var i=skillSetArray.length-1;i>=0;i--){tmpSkillObj=skillSetArray[i];if(typeof tmpSkillObj=="object"&&tmpSkillObj[type]==typeValue.trim()){return tmpSkillObj}}}return false}catch(userInfoException){console.error(userInfoException.message);console.error(userInfoException.stack)}},patch:function(skillName){var skill=this.getSkillByType("title",skillName,"getUserSkillSet");return skill?this.getSkillById(skill.skillSetId):false},getSkillByName:function(skillName){var tmp=this.patch(skillName);if(skillName=="FullWork")return tmp||this.patch("CEA")||{};else return tmp},getSkillById:function(id){return this.getSkillByType("skillSetID",id,"getUserContactSkillSet")},getCompanyId:function(){if(projectMap["default"])return projectMap["default"];var skillObj=self.getSkillById("98223b25-b41c-4c7e-bb91-569003f4cc45");projectMap["default"]=skillObj&&skillObj.accountID?skillObj.accountID:projectMap.answerconnectId;return projectMap["default"]},updateUserInfoViaApi:function(email){return $.ajax({url:"https://live-contactsapi.appspot.com/services/signin/v2.0/Account/authenticate_v2?apikey=SEN42",type:"POST",data:'{"login":"'+(this.getEmail()||email)+'"}',contentType:"application/json"}).done(function(json){this.setUser(json)}.bind(this))},getEmail:function(){var tmp=this.getUser();return tmp?tmp.email:false},getV2Login:function(){var tmp=this.getUser();return tmp?tmp.v2Login:false},clear:function(){this.user=null}};R["userDAO"]=userInfoObject;for(var prop in userInfoObject){if(userInfoObject.hasOwnProperty(prop)){if(["loggedIn","user"].indexOf(prop)!=-1)Object.defineProperty(userInfoObject,prop,accessModifier.mask);else Object.defineProperty(userInfoObject,prop,accessModifier.protected)}}Object.defineProperty(R,"userDAO",accessModifier.protected);util.subscribe("/user/info/update/via/api",userInfoObject,userInfoObject.updateUserInfoViaApi)})(this);var namespace={channel:{SB:"msg-to-FULL",CHAT:"msg-to-Chat",V2:"msg-to-V2",Mediator:"msg-to-Mediator",Main:"msg-to-Main"},APP_ID:/^win/.test(process.platform)&&/FULLClient/.test(process.execPath)?"FULL":"AnywhereWorks",HIDDEN_CONTAINER:"HiddenWindow",CONTAINER_CHAT:"AnyWhereWorks",CONTAINER_CHAT_ALIAS:"Chat",CONTAINER_SB:"FULL",CONTAINER_V2:"V2",CONTAINER_TIMER:"Timer",CONTAINER_V2_SOFTPHONE:"V2SoftPhone",ZOOMIN:"ZoomIn",ZOOMOUT:"ZoomOut",ENABLE:"enable",DISABLE:"disable",BOTH:"Both",ALL:"All",ZOOMIN_LIMIT:9,ZOOMOUT_LIMIT:-8,ZOOM_ACTUAL_SIZE:0,ZOOM_FACTOR:1};function PostToBackground(operationType){this.name="PostToBackground";this.choice=operationType;this.menuActions={name:"menuActions",eType:"menuActions",opt:null}}var analytics={TAB_LOAD:"TabLoad",TAB_ONLOAD:"TabOnload",FETCH:"Fetch",TAB_CLOSE:"TabClose",TAB_XCLOSE:"TabXClose",TAB_XCLOSE_Cancel:"TabXClosePopupCancel",V2_CLOSED:"V2Closed",RELOAD_V2:"ReloadV2",APP_CLEAR_CACHE:"AppClearCache",BACKUP_FORM:"BackUpForm",APP_ABNORMAL_QUIT:"AppCrashed",APP_CLOSED:"AppClosed",FULLCREATIVE_PAGE:"FULLCreativeWebsite",INCOGNITO_LINK:"IncognitoLinkLoaded",TIMERWIDGET_DROPDOWN:"TimerDropDown",TIMERWIDGET_TAB_DROPDOWN:"TabTimerDropDown",MAX_LOADED_TABS:"MaxLoadedTab",CHAT_ICON_CLICKED:"ChatIconClicked",REFETCH_RECENT_CLICKED:"RefetchRecentClicked",FEEDBACK_CLICKED:"FeedbackClicked",SENDING_FEEDBACK_BEGIN:"SendingFeedbackBegin",FEEDBACK_SUCCESS:"FeedbackSentSuccessfully",FEEDBACK_FAILED:"FeedbackFailed",NETWORK_STRENGTH_CLICKED:"NetworkStrengthClicked",UPDATE_BTN_CLICKED:"UpdateButtonClicked",UPDATE_LATER_CLICKED:"UpdateLaterClicked",WIPE_DATA:"AppWipeData"};function ImageCapture(frameName,encodedImg,feedbackId){this.name="image";this.frame=frameName;this.img=encodedImg;this.parentId=feedbackId}function TabLock(text,isInformational){if(typeof text!="string"){return{}}this.name="tabLock";this.url=location.href;this.enableLock=true;this.dialog={informational:isInformational?true:false,text:text?text:"Do you wish to force close the tab?"}}function TimerCommunication(opt,connId){this.name="TimerCommunication";this.setOperation.apply(this,arguments);this.setConnectionInfo={name:"setConnectionInfo",DAIM:null};this.updateConnectionInfo={name:"updateConnectionInfo",DAIM:null,status:null};this.closeConnection={name:"closeConnection"}}TimerCommunication.prototype.setOperation=function(opt,connId){if(opt&&connId&&new RegExp(opt,"ig").test(["setConnectionInfo","updateConnectionInfo","closeConnection"])){this.opt=opt;this.connId=connId;return true}throw new Error("Specified Operation is not available")};function SBcommunication(operationType){if(operationType)operationCycle=operationType;else operationCycle=null;this.name="sbCommunication";this.opt=operationCycle;this.accountOpt={url:"",name:"accountOpt",opt:null};this.resizeContainer={name:"resizeContainer",w:null,h:null};this.statusPush={name:"statusPush",status:null}}function V2Communication(operationType){var v2Options=["statusPush","outbound","getStatus","reloadJS","close"],statusTypes={name:"statusTypes",_available:"Available",_break:"Break",_meeting:"Meeting",_systemissues:"System",_personaltime:"Personal",_offline:"Offline"};var sbOpt={name:"sbOpt",account:"accountOpt",status:"statusPush",_event:"_event",webtab:"webtab"};if(operationType)operationCycle=operationType;else operationCycle=v2Options;this.name="v2Communication";this.opt=operationCycle;this.resizeContainer={name:"resizeContainer",w:null,h:null};this.visibility={name:"visibility",isShow:false};this.statusPush=statusTypes;this.isInterruptible=false;this.getStatus=v2Options;this.outbound={name:"outbound",phoneNumber:""};this.queryAndGetTabSource={name:"queryAndGetTabSource",paramName:null,paramValue:null};this.close=false}function WidgetTimer(operationType){var operation=operationType?operationType:false;this.name="widgettimer";this.opt=operation;this.toWidgetContainer={name:"toWidgetContainer",data:{}};this.toSbwindow={name:"toSbwindow",data:{}};this.setHeightWidth={name:"setHeightWidth",data:{}}}function ClientListener(lOperation){var operation=lOperation?lOperation:false;this.name="clientlistener";this.opt=operation;this.count={name:"count",target:"chat",count:undefined};this.showUpdatePopup={name:"showUpdatePopup",domain:location.origin,gitRepoName:null,version:null,restartBtnName:null,cancelBtnName:null};this.hideUpdatePopup={name:"hideUpdatePopup"};this.restartBtnClick={name:"restartBtnClick"};this.cancelBtnClick={name:"cancelBtnClick"};this.extensions={name:"extensions",emittype:undefined,message:undefined};this.accessToken={name:"accessToken",token:null};this.blur={name:"blur",domain:location.origin};this.focus={name:"focus",domain:location.origin};this.badgelabel={name:"badgelabel",count:undefined};this.notify={name:"notify",title:undefined,body:undefined,sec:undefined,icon:undefined};this.show={name:"show",target:"chat"};this.hide={name:"hide",target:"chat"};this.getstate={name:"getstate"};this.requestattention={name:"requestattention",isContinuous:false};this.restart={name:"restart"};this.readFromClipboard={name:"readFromClipboard"};this.loadwebsite={name:"loadwebsite",isFullwork:undefined,isBrowserLoad:undefined,url:undefined};this.loadaccount={name:"loadaccount",accountnumber:undefined};this.goclock={name:"goclock",isStop:undefined,daim:0};this.enableOnTop={name:"enableOnTop"};this.disableOnTop={name:"disableOnTop"};this.storeinbuffer={name:"storeinbuffer",value:null};this.setv2status={name:"setv2status",status:null};this.getv2status={name:"getv2status"};this.download={name:"download",filename:undefined,mimetype:undefined,url:undefined,contentlength:undefined,isViewable:false};this.toGuestPage={name:"toGuestPage",guest:{source:location.href,destination:null},data:{}}}function Application(opt){this.name="Application";this.apps={v2:"v2container",ibr:"inbuiltrouting",ic:"inbuiltchat",ch:"chatclient",sb:"sbcontainer",sp:"statuspanel",afk:"awayfromkeyboard",ecm:"enablecallcenterchatmode",mop:"menuoptions"};this.opt=opt?opt:"open";this.close={name:"close",appname:false};this.hide={name:"hide",appname:false};this.show={name:"show",appname:false};this.open={name:"open",appname:false};this.quit={name:"quit",callee:false};this.maximize={name:"maximize",callee:false};this.collectfeedback={name:"collectfeedback",userFeedback:null,isFromChatModule:false};this.clearCache={name:"clearCache"};this.checkForUpdates={name:"checkForUpdates"};this.onFocus={name:"onFocus"};this.zoomIn={name:"zoomIn"};this.zoomOut={name:"zoomOut"};this.resetZoom={name:"resetZoom"};this.menuoptions={name:"menuoptions",opt:undefined,showoption:{name:"showoption",optionname:undefined},hideoption:{name:"hideoption",optionname:undefined}}}function LogsAck(id){this.name="captureLogs";this.opt="captureLogs";this["captureLogs"]={uniqueId:id};this["clearLogs"]={name:"clearLogs"}}function LogACK(opt){this.name="LogACK";this.opt=opt;this["captureLogs"]={name:"captureLogs",uniqueId:null};this["clearLogs"]={name:"clearLogs"}}function Thinclient(lOpt,eventType,extension){this.name="thinclient";this.opt=lOpt?lOpt:false;this.state={name:"state",origin:null,visible:false,ext:extension?extension:"chat",etype:eventType?eventType:"click",extIsHide:false,window:{isMinimized:false,isBlured:false,isFocused:false}};this.menu={name:"menuevent",metainfo:{menu:null,menuitem:null,eventType:"click"}};this.v2Status={name:"v2Status",status:null};this.readFromClipboard={name:"readFromClipboard",text:null,type:null,image:{dataUri:null,size:null,isEmpty:true}};this.extensions={name:"extensions",type:undefined,message:undefined};this.notify={name:"notify",isEvent:false};this.afk={name:"afk",status:"user-away"};this.tabSourceQueryResult={name:"tabSourceQueryResult",result:{src:null,params:null},query:{}};this.networkDetection={name:"networkDetection",isUp:true};this.downloadFileInfo={name:"downloadFileInfo",originalObject:null,downloadedPercentage:null,downloadedMB:null}}(function(root){function StatusController(lUImsg){this.name="StatusController";this.UImsg=lUImsg||null}StatusController.prototype.setUImsg=function(uiMessage){if(typeof uiMessage=="object"&&uiMessage instanceof StatusUIMessenger){this.UImsg=uiMessage;return true}};function StatusUIController(lUImsg){this.name="StatusUIController";this.UImsg=lUImsg||null}StatusUIController.prototype.setUImsg=function(uiMessage){if(typeof uiMessage=="object"&&uiMessage instanceof StatusUIMessenger){this.UImsg=uiMessage;return true}};function StatusUIMessenger(){this.name="StatusUIMessenger";this.opt=null;this.originalEvent=null;this.status={name:"status",value:null,source:"auto"};this.clockedOut={name:"clockedOut"};this.clockedIn={name:"clockedIn"};this.hide={name:"hide"};this.show={name:"show"}}StatusUIMessenger.prototype={constructor:StatusUIMessenger,setStatus:function(lStatus,source){if(lStatus){this.opt="status";this["status"]["value"]=lStatus;this["status"]["source"]=source||"auto";return true}},setClockedOut:function(){this.opt="clockedOut"},setClockedIn:function(){this.opt="clockedIn"},setHide:function(){this.opt="hide"},setShow:function(){this.opt="show"},setOriginalEvent:function(obj){if(typeof obj=="object"){this.originalEvent=obj}}};root["StatusController"]=StatusController;root["StatusUIController"]=StatusUIController;root["StatusUIMessenger"]=StatusUIMessenger;Object.defineProperty(root,"StatusController",util.accessMods.protected);Object.defineProperty(root,"StatusUIController",util.accessMods.protected);Object.defineProperty(root,"StatusUIMessenger",util.accessMods.protected)})(this);(function(root,util,undefined){function GoclockHours(_in,dateAddedInMilliSec,src){this.in=_in||false;this.name="GoclockHours";this.DAIM=dateAddedInMilliSec||0;this.source=src||"goClockModule"}GoclockHours.prototype={constructor:GoclockHours,setDAIM:function(hoursJDOList){if(hoursJDOList&&hoursJDOList.constructor==Array){this._getDAIMfromJDOlist(hoursJDOList);return true}},_getDAIMfromJDOlist:function(hoursJDOList){this.DAIM=0;for(var i=hoursJDOList.length-1;i>=0;i--){this.DAIM+=this._getDAIM(hoursJDOList[i])}},_getDAIM:function(hoursJDO){var time=0;if(hoursJDO){if(hoursJDO.clockingStatus=="CLOCKED_IN")this.in=true;if(hoursJDO.clockInLongTime&&hoursJDO.clockOutLongTime)time=hoursJDO.clockOutLongTime-hoursJDO.clockInLongTime}return time},getTimeInMilliSeconds:function(){return this.DAIM}};function UserClockStatus(StatusString,connIdString,isDummyBoolean){this.agent=userDAO.getUser().fullname;this.state=StatusString;this.agentname=userDAO.getUser().fullname;this.v2login=userDAO.getUser().email;this.email=userDAO.getUser().email;this.connectionId=connIdString||"N/A";this.uniquepin=userDAO.getCompanyId();this.clockingStatus=isDummyBoolean?"DUMMY":"REAL";this.requestSource="FULLClient";this.sourceEngine=nwUserAgent}function GoClockController(operation){this.name="GoClockController";this.opt=operation||"sync";this.sync={name:"sync"};this.hoursJDO=null}GoClockController.prototype={constructor:GoClockController,setSync:function(isStop,DAIM){this["opt"]="sync";this["hoursJDO"]=isStop?new GoclockHours:new GoclockHours(true,DAIM)},getHours:function(){return this.hoursJDO}};function GoClockUIController(GoclockHoursObj){this.name="GoClockUIController";this.hoursJDO=GoclockHoursObj||null}GoClockUIController.prototype={constructor:GoClockUIController,setHours:function(GoclockHoursObj){this.hoursJDO=GoclockHoursObj},getHours:function(){return this.hoursJDO}};root["GoClockUIController"]=GoClockUIController;root["GoClockController"]=GoClockController;root["GoclockHours"]=GoclockHours;root["UserClockStatus"]=UserClockStatus;Object.defineProperty(root,"GoClockUIController",util.accessMods.protected);Object.defineProperty(root,"GoClockController",util.accessMods.protected);Object.defineProperty(root,"GoclockHours",util.accessMods.protected);Object.defineProperty(root,"UserClockStatus",util.accessMods.protected)})(this,util);function quitAppFaster(e){if(!FULLClient["canQuit"]){if(/^win/.test(process.platform)&&(!userDAO.getSkillByName("FullWork")||namespace.APP_ID!=namespace.CONTAINER_CHAT)){util.publish("/util/window/events/minimize",namespace.CONTAINER_SB)}else{util.publish("/util/window/events/hide",namespace.CONTAINER_SB)}util.publish("/timer/hwnd/show");return false}}onload=function(){var sbwin=util.getCurrentWindow();$("#v2_Phone_Icon").show();util.publish("/status/controller/mode/internalMode");util.publish("/goclock/controller/queryHours");util.publish("/status/UIController/hide/option/viewprofile",{mode:"live",source:"callcentermode"});console.log("Checking terminal-notifier permission from main window..!");util.publish("/notification/create/checkNotificationDependency");function embedIframeDom(url){var staticWelcomePage=new WebviewProxy("LoginModule",url,"LoginModule");staticWelcomePage.setContentloaded(function(){util.publish("menuBar/updateTitle")});return staticWelcomePage.getView()}$('div[id="1_content"]').append(embedIframeDom("https://sites.google.com/a/a-cti.com/redone-team-vc/home/"));util.publish("module/controller/onload",{source:"onload"});util.publish("/webview/controller/app/onload");FULLClient.ipc.send({eType:"isCrashed",container:namespace.CONTAINER_SB});window.onbeforeunload=quitAppFaster;if(userDAO.getSkillByName("FullWork"))$("#_chat").show().find("cite").hide();if(namespace.APP_ID!=document.title){document.title=namespace.APP_ID}function checkDependencies(){var FormData,request,getPort;try{FormData=require("form-data");request=require("request");getPort=require("get-port");util.publish("/start/engine/updater/")}catch(e){console.log("----- Updating the system -----");util.publish("/start/engine/updater/force/",true)}}checkDependencies();window.onfocus=function(){util.publish("/timer/hwnd/hide");util.tabs.focusActiveTab()};window.onblur=function(){util.publish("/timer/hwnd/show")};sbwin.on("minimize",function(){util.publish("/timer/hwnd/show")});sbwin.on("restore",function(){if(/^win/.test(process.platform))util.publish("/timer/hwnd/hide")})};(function(root,util,undefined){var urlParser=FULLClient.require("url");function getExeScript(srcInWebview){var url="images.sb.a-cti.com/chrome/js/webviewAPI.js";var _scriptString='var _webivewSupport=document.createElement("script");';if(srcInWebview&&/^https/.test(srcInWebview))_scriptString+='_webivewSupport.src="https://commondatastorage.googleapis.com/'+url+'";';else _scriptString+='_webivewSupport.src="http://'+url+'";';_scriptString+='_webivewSupport.type="text/javascript";';_scriptString+="document.body.appendChild(_webivewSupport);";return _scriptString}root["getExecuteScript"]=getExeScript;var isNWCompatible=function(){return true};function WebviewProxy(id,sourceUrl,partitionName){this._createWebviewDom(id,sourceUrl,partitionName)}WebviewProxy.prototype={constructor:WebviewProxy,_createWebviewDom:function(id,sourceUrl,partitionName){if(this.isNWCompatible()){var webPage=document.createElement("webview");webPage.src=sourceUrl;webPage.id=id;this.id=id.replace(/[a-z]*/,"");this.callbackRegister={};this._webview=webPage;this.setWidth("100%");this.setHeight("100%");this.setUserAgent();this.setPreload("../assets/js/preload/preloadWebview.js");this.setNewWinPolicy(webviewController.checkBrowserCompatible);this.setMediaControl();this.setLoadRedirect();this.setDisableWebSecurity();this.setMessageListener();this.setCrashListeners();this.setLoadAborted(webviewController.loadAbort);this.setContentloaded(this.setContextMenu.bind(this));this.setFindInPage()}},setCB:function(eventName,cb){if(eventName){return this.callbackRegister[eventName]=cb}},getCB:function(eventName){if(eventName){return this.callbackRegister[eventName]}},setCB:function(eventName,cb){if(eventName){return this.callbackRegister[eventName]=cb}},getCB:function(eventName){if(eventName){return this.callbackRegister[eventName]}},isNWCompatible:function(){return true},getView:function(){return this._webview},setHidden:function(){this.getView().removeAttribute("style");this.getView().setAttribute("class","webview_hide")},setContextMenu:function(){if(this.isNWCompatible()&&!this.getView().dataset.contextMenuEnabled){this.getView().getWebContents().on("context-menu",function(event,param){util.publish("/context/menu/event/",event,param)});this.getView().dataset.contextMenuEnabled=true}},setHeight:function(width){if(this.isNWCompatible()){this.getView().style.width=width}},setWidth:function(height){if(this.isNWCompatible()){this.getView().style.height=height}},setUserAgent:function(){if(this.isNWCompatible()){this.getView().setAttribute("useragent",nwUserAgent)}},setDisableWebSecurity:function(){if(this.isNWCompatible()){this.getView().setAttribute("disablewebsecurity",true)}},setMediaControl:function(){if(this.isNWCompatible()){this.getView().addEventListener("permissionrequest",function(e){if(e.permission){e.request.allow()}})}},setLoadRedirect:function(){if(this.isNWCompatible()){var self=this;this.getView().addEventListener("did-get-redirect-request",function(evt){if(evt.isMainFrame){var oldUrlObject=urlParser.parse(evt.oldUrl||evt.oldURL);var newUrlObject=urlParser.parse(evt.newUrl||evt.newURL);console.debug("["+self.id+"] [mainframe = "+evt.isMainFrame+"] LoadRedirect : oldUrl: "+oldUrlObject.host+", newUrl : "+newUrlObject.host);util.publish("webview/service/domain/redirect",self.id,newUrlObject)}})}},setPreload:function(preloadScriptPath){if(this.isNWCompatible()){this.getView().setAttribute("preload",preloadScriptPath||"../asar/full.asar/webPreload.min.js")}},setLoadstart:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("did-start-loading",cb);this.setCB("did-start-loading",cb)}},setLoadstop:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("did-stop-loading",cb);this.setCB("did-stop-loading",cb)}},setContentloaded:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("did-finish-load",cb);this.setCB("did-finish-load",cb)}},setFrameFinishLoad:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("did-frame-finish-load",cb);this.setCB("did-frame-finish-load",cb)}},setDomReady:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("dom-ready",cb);this.setCB("dom-ready",cb)}},setDialogController:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("dialog",cb);this.setCB("dialog",cb)}},setNewWinPolicy:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("new-window",cb);this.setCB("new-window",cb)}},setLoadAborted:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("did-fail-load",cb);this.setCB("did-fail-load",cb)}},setResponsive:function(cb){if(cb&&this.isNWCompatible()){this._webview.addEventListener("responsive",cb);this.setCB("responsive",cb)}},reload:function(){var src=this.getView().src;var view=new WebviewProxy(this.getView().id,src,this.partition);view.setContentloaded(this.getCB("did-finish-load"));var parent=$(this.getView()).parent();parent.children().remove("webview");parent.append(view.getView())},restore:function(){if(/&currentTabIndex=/.test(this.getView().src)&&!/&isCrashed/.test(this.getView().src)){this.getView().src+="&isCrashed=true";console.log("Appending crash param : "+this.getView().src)}else this.reload()},setCrashListeners:function(){function listener(e){console.error("Crashed : ",e);util.preventEvent(e);this.restore()}this._webview.addEventListener("crashed",listener.bind(this));this._webview.addEventListener("gpu-crashed",listener.bind(this));this._webview.addEventListener("plugin-crashed",listener.bind(this));this._webview.addEventListener("destroyed",listener.bind(this))},setUnresponsive:function(cb){if(cb&&this.isNWCompatible()){this.getView().addEventListener("crashed",cb)}},setMessageListener:function(){this.getView().addEventListener("ipc-message",function(event){util.publish("/msgModule/handler/",event.args[0],event.channel)})},setNodeIntegration:function(){this.getView().setAttribute("nodeintegration",true)},setFindInPage:function(){this.getView().addEventListener("found-in-page",function(e){util.publish("/webview/found/in/page/",e)})}};root["WebviewProxy"]=WebviewProxy;root["webviewController"]=webviewController;var webviewController={counter:1,backUpDomain:["jersey","setmore"],urlFetchedDomain:[],errList:["ERR_ABORTED","ERR_CONNECTION_CLOSED","ERR_BLOCKED_BY_CLIENT","ERR_ADDRESS_UNREACHABLE","ERR_EMPTY_RESPONSE","ERR_FILE_NOT_FOUND","ERR_UNKNOWN_URL_SCHEME"],loadAbort:function(event,errorCode,errorDescription,validatedURL,isMainFrame){var e=event;console.check("did failed to load : ",event,errorCode,errorDescription,validatedURL,isMainFrame);console.debug("\n LoadAbort url: "+e.url+"\n LoadAbort toplevel : "+e.isTopLevel+"\n LoadAbort code: "+e.code+"\n LoadAbort reason: "+e.reason);if(e.isTopLevel&&!e.target.getAttribute("isReloaded")&&webviewController.errList.indexOf(e.reason)==-1){console.warn("Reloading the Webview !!! ");e.target.stop?e.target.stop():false;e.target.reload?e.target.reload():false;e.target.setAttribute("isReloaded",true)}},getDomainsLoadableInBrowser:function(){if(this.urlFetchedDomain.length)return this.urlFetchedDomain;else return[]},initialCallForSpreadSheetUrl:function(){this.getUrlFromSpreadSheet(this.addUrls)},getUrlFromSpreadSheet:function(cb){$.post("https://script.google.com/macros/s/AKfycbxg0brhayGhgksKPdn9_Ku379GehCIRiMDiNhYkA3jrHftF1RU/exec").done(function(response){if(response){cb.call(this,response)}}.bind(this)).fail(function(err){console.error("Error in getting Urls from spreadsheet :",err)})},addUrls:function(jsobj){util.publish("/open/browse/private/whitelist",jsobj)},checkBrowserCompatible:function(e){e.preventDefault();e.cancelBubble=true;util.publish("/open/browse/private/window",e)},openNewWindow:function(e){e.cancelBubble=true;if(e&&e.url){console.log("NewWindowEvent, opening : "+e.url);if(e.target.src.indexOf(FULLClient.getConfig().chat)!=-1){util.loadWebSiteInBrowser(e.url);return true}util.loadWebSiteInNewWindow(e.url);return true}},loadStart:function(e){root["test"][webviewController.counter++]=e}};util.subscribe("/webview/controller/app/onload",webviewController,webviewController.initialCallForSpreadSheetUrl)})(this,util);(function(root,$,util,lUserDAO,undefined){var v2Intercept={checkForV2Live:function(orgObj){if(orgObj&&orgObj.isInterruptible&&this.isOldV2()){orgObj["statusPush"]="Interruptible";return true}},isOldV2:function(){if(/staging-v2/.test(util.config.getOldV2url()))return true}};var statusPanelController={name:"statusPanelController",log:function(){util.log.apply(this,arguments)},mode:lUserDAO.getSkillByName("FullWork")?"external":"internal",getMode:function(){return this.mode},approvedOptionList:util.v2.getStatusList(),isWhiteListed:function(status){return this.approvedOptionList.indexOf(status)!==-1?true:false},isModuleLoadable:function(){return userDAO.getSkillByName("FullWork")||userDAO.getSkillByName("CEA")?false:true},pushToV2:function(sObj){if(sObj&&!/fetch/.test(sObj.calltype)&&(sObj.connId||sObj.isForce)){this.log("pushing status to V2: ",sObj);util.publish("/util/v2/push/original/event",sObj);util.tabs.removeInterruptibleConnId(sObj.connId);return true}console.warn("['pushToV2'] discarded : ",sObj)},pushInterrutibleInfo:function(info){console.log("pushInterrutibleInfo ...",info);if(info&&info.connId){var iObj=new V2Communication("statusPush");iObj.statusPush="Available";iObj.isInterruptible="true";iObj.isForceClose=true;iObj.connId=info.connId;iObj.source="FULLClient_status_controller";this.timer.orgEventModify(iObj);v2Intercept.checkForV2Live(iObj);this.pushStatus(iObj);return true}},pushXcloseInfo:function(info){console.log("pushXcloseInfo :: ",info);if(info&&info.connId){var iObj=new V2Communication("statusPush");iObj.statusPush=info.status;iObj.isInterruptible=info.isInterruptible;iObj.connId=info.connId;iObj.source="FULLClient_status_controller";console.log("Xclose info obj :",iObj);if(info.isInterruptible)v2Intercept.checkForV2Live(iObj);this.pushStatus(iObj);return true}},isOldV2:function(){if(/staging-v2/.test(util.config.getOldV2url()))return true},isOriginalEventValid:function(orgObj){if(orgObj&&orgObj["connId"]&&orgObj["calltype"]){return true}},pushViaStatus:function(statusObj){if(statusObj&&this.isWhiteListed(statusObj.value)){var lObj=new V2Communication("statusPush");lObj.statusPush=statusObj.value;lObj.source="FULLClient_status_controller";lObj.isForce=true;this.pushStatus(lObj);return true}},_mergeProperties:function(obj1,obj2){if(obj1&&obj2){obj1.connId=obj2.connId||obj2.connid;obj1.tabIndex=obj2.tabIndex;obj1.calltype=obj1.calltype||obj2.calltype;obj1.userpin=obj2.userpin;return obj1}},isInterruptible:function(iObj){if(iObj&&iObj.connId&&util.tabs.isInterruptible(iObj.connId)){iObj.isInterruptible="true";console.log("IS_INTERRUPTIBLE["+iObj.connId+"] : with status ["+iObj["statusPush"]+"]");return true}},pushOriginalEvent:function(orgObj){if(!this.isOriginalEventValid(orgObj)){var mergedObj=this._mergeProperties(orgObj,util.tabs.getOriginalParam(orgObj.source));orgObj=mergedObj?mergedObj:orgObj}if(this.isOriginalEventValid(orgObj)){this.timer.orgEventModify(orgObj);this.isInterruptible(orgObj);v2Intercept.checkForV2Live(orgObj);this.pushStatus(orgObj)}else{this.log("Discarding this push, without connID not status push will work ",orgObj);return false}},timer:{_getStorageInfo:function(oEvt){if(oEvt&&oEvt.connId){var connId=oEvt.connId;var connIdInfo=util.storage.get("timerConnIdMap");if(connIdInfo[connId]){var status=connIdInfo[connId].status;var isApproved=statusPanelController.isWhiteListed(status);if(isApproved){console.log("TIMERDROP_DOWN : status changed from["+oEvt["statusPush"]+"] to ["+status+"]");return status}}return false}},orgEventModify:function(oEvt){if(oEvt&&oEvt.connId){var status=this._getStorageInfo(oEvt);oEvt["statusPush"]=status||oEvt["statusPush"];return oEvt["statusPush"]}}},pushStatus:function(sObject){this.pushToV2(sObject)},listener:function(msg){if(msg){console.log("Message @ STATUSModule : ",msg.UImsg);var statusUImsg=msg.UImsg;switch(statusUImsg.opt){case"status":{if(this.isWhiteListed(statusUImsg["status"].value)){if(statusUImsg["status"].source=="manual"){this.log("Outgoing status : v2/IR/chromeappAPI/7056: "+statusUImsg["status"].value);statusUImsg.originalEvent?this.pushOriginalEvent(statusUImsg.originalEvent):this.pushViaStatus(statusUImsg["status"])}else{this.log("Incoming status to main container for UI :"+statusUImsg["status"].value);util.publish("/goclock/extension/status",msg.UImsg["status"].value)}}break}default:{break}}return true}}};util.subscribe("/status/controller/push/xclose/Info",statusPanelController,statusPanelController.pushXcloseInfo);util.subscribe("/status/controller/recieved/postMessage",statusPanelController,statusPanelController.listener);util.subscribe("/status/controller/push/interruptible/info",statusPanelController,statusPanelController.pushInterrutibleInfo);root["statusPanelController"]=statusPanelController;module.exports=statusPanelController})(this,jQuery,util,userDAO);(function(root,$,util,undefined){var statusUI={options:$("#status_change"),colorCode:$("#status_notify_color"),statusText:$("#status_notify_text"),tickMarkHTML:'<i id="tick_icon" class="fa fa-check"></i>',isModuleLoadable:function(){return userDAO.getSkillByName("FullWork")||userDAO.getSkillByName("CEA")?false:true},setColorCode:function(lColor){this.colorCode.removeClass().addClass(lColor)},setTickMark:function(statusName){if(statusName){var dom=this.options.children("#"+statusName);dom.html(this.tickMarkHTML+dom.text())}},unsetTickMark:function(){this.options.find("#tick_icon").remove()},setStatusText:function(lStatus){},hideUIPanel:function(){this.options.parent().hide();this.statusText.parent().hide()},setUserImage:function(){var photo=userDAO.getUser()&&util.isUrl(userDAO.getUser().photoID)?userDAO.getUser().photoID:"http://images.sb.a-cti.com/TC/node-webkit/common-images/user-ic.png";document.querySelector("#userpicture_image").src=photo},showUIPanel:function(){if(this.isModuleLoadable()){}},showViewProfile:function(){this.options.find("i.fa-user").parent().siblings().hide();this.statusText.hide();this.options.addClass("clockoutUl")},showAllOptions:function(){this.options.find("i.fa-user").parent().siblings().show();this.statusText.show();this.options.removeClass("clockoutUl");this.hideClockOutOption()},hideViewProfile:function(){this.options.find("i.fa-user").parent().hide()},optionsClicked:function(statusEvent){var stat=statusEvent.target.id||$(statusEvent.target).text();if(stat){console.debug("************* Pushing Status from App ************* "+stat);switch(stat){case"View Profile":{break}case"View Timesheets":{util.loadURL(FULLClient.getConfig().goclock);break}default:{statusPanelUIController.setManualStatus(stat);break}}}},hideClockOutOption:function(){$(".fa-sign-out").parent().hide().siblings(".divider:last").hide()},decider:function(status){if(status){this.setStatusText(status);this.unsetTickMark();switch(status){case"Available":{this.setColorCode("online");this.setTickMark(status);break}case"Break":{this.setColorCode("away");this.setTickMark(status);break}case"Personal":{this.setColorCode("away");this.setTickMark(status);break}case"Meeting":{this.setColorCode("dnd");this.setTickMark(status);break}case"Project":{this.setColorCode("away");this.setTickMark(status);break}case"Lunch":{this.setColorCode("offline");this.setTickMark(status);break}case"Busy":{this.setColorCode("dnd");break}case"Offline":{this.setColorCode("offline");break}case"PendingBusy":{this.setColorCode("dnd");break}case"Chat":{this.setColorCode("away");break}case"Repeat":{this.setColorCode("away");break}case"ActiveResponse":{this.setColorCode("away");break}case"AfterCallWork":{this.setColorCode("away");break}case"FailedConnectAgent":{this.setColorCode("dnd");break}default:{this.setColorCode("away");break}}}}};statusUI.options.on("click",statusUI.optionsClicked);statusUI.hideClockOutOption();var statusPanelUIController={msgListener:function(msg){if(msg&&msg.name=="StatusUIController"){var StatusUImsg=msg.UImsg;if(StatusUImsg&&StatusUImsg.name=="StatusUIMessenger"&&StatusUImsg.opt){switch(StatusUImsg.opt){case"clockedIn":{statusUI.showAllOptions();break}case"clockedOut":{statusUI.showViewProfile();break}case"show":{statusUI.showUIPanel();break}case"hide":{statusUI.hideUIPanel();break}case"status":{statusUI.decider(StatusUImsg["status"].value);break}default:{break}}}}},setManualStatus:function(lStatus,originalEvent){if(lStatus||originalEvent){var msg=new StatusUIMessenger;msg.setStatus(lStatus||originalEvent.statusPush,"manual");msg.setOriginalEvent(originalEvent);this.toStatusController(msg)}},setAutoStatus:function(lStatus,originalEvent){if(lStatus||originalEvent){var msg=new StatusUIMessenger;msg.setStatus(lStatus||originalEvent.statusPush,"auto");msg.setOriginalEvent(originalEvent);this.toStatusController(msg);var pushToTabs=new ClientListener("setv2status");pushToTabs.name="setV2status";pushToTabs[pushToTabs.opt].status=lStatus;util.publish("/tab/controller/status/to/tabs",pushToTabs)}},toStatusController:function(lStatusUIMessengerObj){if(lStatusUIMessengerObj){var toStatusController=new StatusController(lStatusUIMessengerObj);util.publish("/status/controller/recieved/postMessage",toStatusController);return true}}};util.subscribe("/status/UIController/sync",statusPanelUIController,statusPanelUIController.msgListener);util.subscribe("/status/UIController/manual/status/change",statusPanelUIController,statusPanelUIController.setManualStatus);util.subscribe("/status/UIController/auto/status/change",statusPanelUIController,statusPanelUIController.setAutoStatus);util.subscribe("/status/UIController/hide/option/viewprofile",statusUI,statusUI.hideViewProfile);root["statusPanelUIController"]=statusPanelUIController;root["statusUI"]=statusUI})(this,jQuery,util);(function(root,$,mediator,undefined){var goClockCore={mode:"internal",name:"GoClockCore",afkNotify:function(info){util.v2.pushStatusToYoco(info.status,"N/A",true)}};mediator.subscribe("/module/afk/notify",goClockCore,goClockCore.afkNotify);module.exports=goClockCore})(this,jQuery,amplify);(function(util){var updateTargetUrlDOM=$(".update-target-url");var weakMap=new WeakMap;function didGetResponseDetails(e,s,nu,ou,code,meth,ref,headers,rType){displayDomainOnly(e.newURL)}function getDomain(str){var urlWithProtocol=str.match(/(https?:\/\/)([a-z\-.]*)/g);return trimProtocolInURL(urlWithProtocol?urlWithProtocol[0]:"")}function displayDomainOnly(content){trimContentAndDisplay(getDomain(content))}function trimContentAndDisplay(content,length){var lContent=content?content.trim():content;if(lContent){displayPreview("Waiting for "+lContent.substr(0,length?length:45)+"...")}}function displayPreview(content){var data=trimProtocolInURL(content);if(!updateTargetUrlDOM.is(":visible")){updateTargetUrlDOM.show()}updateTargetUrlDOM.text(data)}function trimProtocolInURL(url){var lURL=url?url.trim():url;return lURL=lURL.includes("http")?lURL.replace(/(https?:\/\/)/,""):lURL}function LinkPreview(webview){this.wv=webview;this.previewOn();displayPreview("Connecting...");this.addListener();weakMap.set(webview,this)}LinkPreview.prototype.previewOn=function(content){updateTargetUrlDOM.show()};LinkPreview.prototype.previewOff=function(){updateTargetUrlDOM.hide()};LinkPreview.prototype.removeListener=function(){this.wv.removeEventListener("did-get-response-details",didGetResponseDetails)};LinkPreview.prototype.dispose=function(){this.wv=null};LinkPreview.prototype.setUpdateURL=function(){this.wv.addEventListener("update-target-url",function(e){var url=e.url;if(url&&url.trim()){trimContentAndDisplay(url,150)}else{updateTargetUrlDOM.hide()}})};LinkPreview.prototype.addListener=function(){this.wv.addEventListener("did-get-response-details",didGetResponseDetails);this.wv.addEventListener("will-navigate",function(e){displayDomainOnly(e.url);this.removeListener();this.wv.addEventListener("did-get-response-details",didGetResponseDetails)}.bind(this));this.wv.addEventListener("did-finish-load",function(){this.removeListener();this.setUpdateURL();this.previewOff()}.bind(this));this.wv.addEventListener("did-navigate",function(e){displayDomainOnly(e.url)});this.wv.addEventListener("did-get-redirect-request",function(e){displayDomainOnly(e.newURL)})};util.subscribe("/link/preview/load/webview",function(webview){new LinkPreview(webview)});util.subscribe("/link/preview/dispose/webview",function(webview){if(weakMap.has(webview)){var linkpreview=weakMap.get(webview);linkpreview.dispose();weakMap.delete(webview)}})})(util);(function(util,ls){var restore={set:function(module,newData){var tmpData;if(module&&newData){if(tmpData=this._get(module)){tmpData.push(newData)}else tmpData=[newData];ls.set(module,JSON.stringify(tmpData))}},_get:function(module,cb){if(module){return ls.get(module)}},get:function(module,cb){if(module&&typeof cb=="function"){setTimeout(function(){cb.call(null,ls.get(module))},0)}},remove:function(module,key){var oldData;if(module&&key){oldData=this._get(module);if(oldData){for(var i=0;i<oldData.length;i++){if(oldData[i].key==key){oldData.splice(i,1);break}}ls.set(module,JSON.stringify(oldData));return true}}},removeAll:function(module){if(module){ls.remove(module);return true}},publish:function(){util.publish("/tab/restore/check")}};util.subscribe("/app/restore/check",restore,restore.publish);util.subscribe("/app/restore/set",restore,restore.set);util.subscribe("/app/restore/get",restore,restore.get);util.subscribe("/app/restore/remove",restore,restore.remove);util.subscribe("/app/restore/removeAll",restore,restore.removeAll);module.exports=restore})(util,Locstor);(function(R,util){var apiHandler={name:"apiHandler",log:function(){util.log.apply(this,arguments)},unloadTab:function(info){if(info&&info["close"].tabIndex){this.log("info.source::"+info["originalEvent"].source);this.log("info.tabIndex::"+info["close"].tabIndex);util.publish("/tab/controller/close/tab/",{source:info["originalEvent"].source,isForce:false,tabIndex:info["close"].tabIndex})}},pushStatus:function(sInfo){if(sInfo&&sInfo["status"].pushStatus){util.publish("/status/UIController/manual/status/change",sInfo["status"].pushStatus,sInfo.originalEvent)}},handler:function(msg){switch(msg.opt){case"close":{this.pushStatus(msg);this.unloadTab(msg)}case"status":{break}case"logACK":{util.publish("/feedback/gotACK",msg["logACK"]);break}case"logs":{util.publish("/feedback/setLogs",msg["logs"]);break}default:{break}}}};var clientListenerHandler={handler:function(msg){switch(msg.opt){case"setv2status":{util.publish("/util/v2/statusPush",{status:msg[msg.opt].status});break}case"loadwebsite":{if(msg[msg.opt].isBrowserLoad){util.loadWebSiteInBrowser(msg[msg.opt].url)}else if(msg[msg.opt].isFullwork){util.publish("/tab/controller/load/fullwork",msg[msg.opt].url)}else{util.loadWebSiteInNewWindow(msg[msg.opt].url)}break}default:{break}}}};var sbHandler={name:"sbMsgHandler",log:function(){util.log.apply(this,arguments)},load:function(loadInfo){this.log("LoadTab : ",loadInfo);if(loadInfo){util.caching.windows.getSB().show();util.caching.windows.getSB().focus();util.loadURL(loadInfo.url)}},unload:function(unloadInfo){this.log("UnLoadTab : ",unloadInfo);if(unloadInfo&&unloadInfo.url&&util.isUrl(unloadInfo.url)){util.publish("/tab/controller/close/tab/",{source:null,isForce:false,tabIndex:util.getParameterByName("currentTabIndex",unloadInfo.url)})}},events:function(eventInfo){switch(eventInfo.triggerEvent){case"enter":{break}case"f8":{break}case"fetch":{break}default:{msgModule.log("UNKNOWN Event Operation in sbHandler Events : ",eventInfo);break}}},handler:function(msg){switch(msg.opt){case"collectfeedback":{util.publish("/feedback/initiate",{userFeedback:msg[msg.opt].userFeedback,isFromChatModule:msg[msg.opt].isFromChatModule,token:msg[msg.opt].token});break}case"accountOpt":{if(msg[msg.opt].opt=="load"){this.load(msg[msg.opt])}else if(msg[msg.opt].opt=="unLoad"){this.unload(msg[msg.opt])}break}case"_event":{this.events(msg[msg.opt]);break}case"onFocus":{util.zoom.updateUIOnFocus(util.zoom.getActiveTab());break}case"zoomIn":{util.zoom.zoomIn(util.zoom.getActiveTab());break}case"resetZoom":{util.zoom.resetZoom(util.zoom.getActiveTab());break}case"zoomOut":{util.zoom.zoomOut(util.zoom.getActiveTab());break}case"clearCache":{$("#preferences .clear_cache").trigger("click");break}default:{break}}}};var msgModule={name:"MessageModule",log:function(){util.log.apply(this,arguments)},proxy:function(){msgModule.handler.apply(msgModule,arguments)},handler:function(){var msg=arguments[0].name?arguments[0]:arguments[1];switch(msg.name){case"crashed":{if(msg.crashed){console.warn("SBWindow crash detected Restoring app data");util.publish("/app/restore/check",{source:"main"})}else{console.debug("SBWindow not crashed, Deleting Restoration data");util.publish("/app/restore/removeAll","tabs")}break}case"fulloauth":{this.log("Recieved message on fulloauth block : ",msg);util.publish("/app/loginModule/msg/recieved",msg);break}case"clientlistener":{clientListenerHandler.handler(msg);break}case"reLogin":{FULLClient["canQuit"]=true;window.close();break}case"updateEngine":{this.log("Downloading Engine Update");util.publish("/start/engine/updater/force/",true);break}case"sbCommunication":{sbHandler.handler(msg);break}case"v2Communication":{util.publish("/v2Handler/msg/handler",msg);break}case"chromeAppAPI":{apiHandler.handler(msg);break}case"tabLock":{if(msg.enableLock)util.publish("tabCloseController/lockTabOnClose",msg);break}case"Dummy":{console.log("Testing DATA : reached");break}case"appQuit":{if(!FULLClient["canQuit"]){$("#QuitApp").trigger("click");$("#QuitApp").parent().parent().hasClass("open")?$("#QuitApp").parent().parent().removeClass("open"):false}}case"Application":{sbHandler.handler(msg);break}case"crashReporter":{util.publish("/util/crashreporter/set/port",msg.port);break}case"v2EventLogs":{break}case"analytics":{util.publish("/analytics/push",msg.accountNumber,msg.eventAction,msg.connId,msg.metaInfo);break}case"timerWidget":{util.publish("/timer/markActiveTabById");break}default:{this.log("Default Sequence Capture this : ",msg);break}}}};var ipc=FULLClient.require("electron").ipcRenderer;ipc.on("msg-to-FULL",msgModule.proxy);util.subscribe("/msgModule/handler/",msgModule,msgModule.proxy)})(this,util);(function(R,util){var menuBar={defaultTitle:"AnyWhereWorks",defaultTabID:"1",isTimerActive:function(){return $("ul.v2_tab>li>span").hasClass("timecount")},updateTitle:function(title){if(title){if(/^AnywhereWorks$|^FULL$/.test(title)){this.setWebPageTitle()}else{this.setWindowTitle(title+" - SwitchBoard");this.setTabTitle(title)}}else{this.setWebPageTitle()}},setWindowTitle:function(title){util.getCurrentWindow().setTitle(title||this.defaultTitle)},getTabId:function(){var tabId=util.tabs.getActiveTabId();return tabId?tabId:this.defaultTabID},setTabTitle:function(title){if(!this.isTimerActive()){$("#"+this.getTabId()+" a").text(title||this.defaultTitle)}},getWebPageTitle:function(activeTab){if(activeTab)return activeTab.getTitle()},setWebPageTitle:function(){var title=this.getWebPageTitle(this.getActiveTab());this.setWindowTitle(title);this.setTabTitle(title)},getActiveTab:function(){return util.tabs.getActiveTab()||document.getElementById("LoginModule")}};util.subscribe("menuBar/updateTitle",menuBar,menuBar.updateTitle)})(window,util);(function(R,util,$){function sbARStatusPush(connid,status){if(connid&&status&&userDAO.getUser()&&!/code/.test(FULLClient.getMode())&&!util.hasSpecialCharacters(connid)){$.get(FULLClient.getConfig().sb+"/ActiveResponseAction/updateCustomInteraction.do?connId="+connid+"&status="+status+"&emailId="+userDAO.getUser().email).done(function success_callback(){console.debug("sbARStatusPush, connid :: "+connid+", status :: "+status+", push success!!!!")}).fail(function error_callback(){console.error("sbARStatusPush, connid :: "+connid+", status :: "+status+", FAILED - requeing !!!!");setTimeout(function(){sbARStatusPush(connid,status)},5e3)})}console.warn("Discarding["+connid+"] status push to AR server "+status)}util.subscribe("tab/sbARStatusPush",null,sbARStatusPush);var url=FULLClient.require("url"),tabHolderDOM=$("ul.v2_tab");$("ul.v2_tab").on("click","li",function(event){var _targ;event.stopPropagation();console.log("["+event.target.tagName+"]CODE clicked..!");switch(event.target.tagName){case"A":{_targ=event.target.parentElement;break}case"CODE":{_targ=event.target.parentElement;if(/ico-circle/.test(event.target.classList)){console.log("X-Closing tab..");util.publish("/tabLock/closeUI/decider/",{source:tabController.sources.getURLbyId(_targ.id),isForce:true,tabIndex:_targ.id});return false}break}case"I":{_targ=event.target.parentElement.parentElement;if(/active/.test(_targ.classList)){$(event.target.parentElement).siblings(".dropdown-menu").toggle()}break}case"LI":{_targ=event.target;if(/dropdown-menu/.test(event.target.parentElement.classList)){$(event.target.parentElement).toggle();_targ=event.target.parentElement.parentElement;var params=util.tabs.getOriginalParamById(_targ.id);console.debug("what we are storing:",event.target.innerText);util.publish("/timer/update/connid/info",{connId:params.connId,status:event.target.innerText})}break}case"SPAN":{if(/ico-circle/.test(event.target.classList)){console.log("X-Closing tab..");_targ=event.target.parentElement.parentElement;util.publish("/tab/closeUI/decider/",{source:tabController.getSrcByTabId(_targ.id),isForce:true,tabIndex:_targ.id});return false}else{_targ=event.target.parentElement;if(/active/.test(_targ.classList)){$(_targ).siblings(".dropdown-menu").toggle()}}break}default:{_targ=event.target;break}}if(/LI/.test(_targ.tagName)){tabController.markActiveByElement(_targ);tabController.autoFocus(_targ.id);amplify.publish("webview/service/zoom/UI/update",tabController.getActiveTabSrc(_targ.id));util.publish("/find/in/page/hide")}});jQuery(window).bind("resize",jQuery.debounce(20,false,function(event){if(event.target.nodeName=="WEBVIEW"&&event.target.id=="softphoneWidget"){return}tabController.resizeAll();setTimeout(function(){util.publish("/tabs/resize/dynamic")},0)}));function Tabs(url,options,cb){this.url=url;this.options=options;this.name="TabModule";this._open()}Tabs.prototype.getURL=function(){return this.url};Tabs.prototype.setURL=function(url){this.url=url};Tabs.prototype.log=function(){util.log(this,arguments)};Tabs.prototype.getId=function(){if(!this.id)this.id=Math.floor(Math.random()*1e10+1);return this.id};Tabs.prototype._parseURL=function(){if(!this.params&&this.url){this.params=url.parse(this.url,true)}return this.params};Tabs.prototype.getParameters=function(){if(!this.params){this._parseURL()}if(this.params){return this.params.query}};Tabs.prototype.getAccountNumber=function(){var query=this.getParameters();if(query&&new RegExp(util.config.getSBurl(),"g").test(this.url)){return query.acctNum||query.accountNumber}};Tabs.prototype.getNameOfTab=function(){var accountNumber;if((accountNumber=this.getAccountNumber())&&$.isNumeric(accountNumber))return accountNumber;else if(this.getURL().indexOf("cHZHQnhWZDYwbHhXQjZseHhZM0dKWnc6MA")!==-1)return"Backup Form";else return namespace.APP_ID==namespace.CONTAINER_CHAT?namespace.CONTAINER_CHAT:namespace.APP_ID};Tabs.prototype.constructURL=function(){this.isDemoLine();var url=this.getURL().replace(/(&currentTabIndex=)[0-9]*/g,"");url=url.replace(/(&apavailable=)[a-z]*/g,"");url+="&currentTabIndex="+this.getId()+"&apavailable="+(util.answerPhrase&&util.answerPhrase.isAPavailable(this.getAccountNumber())?"true":"false");util.publish("/fetch/save/recentURL",url);this.setURL(url);return url};Tabs.prototype._setDataAttr=function(dom){if(dom){var params=util.getParameters(this.url);if(params.connId){dom.dataset.connId=params.connId}if(/repeats|epCustom/i.test(params.calltype)){dom.dataset.connIdIsBilled="false";setTimeout(function(){util.publish("/tab/controller/billAR/check/inactive/tabs")},0)}}};Tabs.prototype._constructUI=function(){var commonTabUI,tabName=this.getNameOfTab(),params=util.getParameters(this.getURL());commonTabUI='<li class="'+tabName+'" id="'+this.getId()+'" >'+'<a href="javascript:void(0)">'+tabName+"</a>"+'<code class="ico-circle">&times;</code>'+"</li>";if(/repeats|epCustom/i.test(params["calltype"])){util.publish("/timer/start/",this.getURL());commonTabUI='<li class="'+tabName+'" id="'+this.getId()+'" >'+'<span id="timedrop'+this.getId()+'" class="timecount">'+'<i class="fa fa-caret-down"></i>'+"</span>"+'<span class="fa fa-clock-o color_green"></span>'+'<ul class="dropdown-menu timer">'+'<li class="hint--right" aria-label="On Completion - Available">Available</li>'+'<li class="hint--right" aria-label="On Completion - Break">Break</li>'+'<li class="hint--right" aria-label="On Completion - Project">Project</li>'+'<li class="hint--right" aria-label="On Completion - Meeting">Meeting</li>'+'<li class="hint--right" aria-label="On Completion - System">System</li>'+'<li class="hint--right" aria-label="On Completion - Personal">Personal</li>'+'<li class="hint--right" aria-label="On Completion - Training">Training</li>'+'<li class="hint--right" aria-label="On Completion - Offline">Offline</li>'+"</ul>"+'<a id="tabName" href="javascript:void(0)">'+tabName+"</a>"+'<code class="ico-circle">&times;</code>'+"</li>"}util.publish("/find/in/page/hide");tabHolderDOM.append(commonTabUI);setTimeout(function(){util.publish("/tabs/resize/dynamic")},0)};Tabs.prototype._constructUIView=function(){var url,webviewUI,contentViewHolder='<div id="'+this.getId()+'_content" class="tab-content " ></div>';url=this.getURL();util.publish("/app/restore/set","tabs",{key:this.getId(),url:url});tabController.registerMetaInfo(url);webviewUI=new WebviewProxy("web"+this.getId(),url,"FULLClient:tab:"+this.getId());var params=util.getParameters(url);util.analytics.push(params["accountNumber"],analytics.TAB_LOAD,params["connId"],url);webviewUI.setContentloaded(this.getOnload()||this.onload);webviewUI.setDomReady(this.domReady);util.publish("/link/preview/load/webview",webviewUI.getView());this._setDataAttr(webviewUI.getView());this.isNodeIntegAvailable()?webviewUI.setNodeIntegration():false;$("div.tab-content-hold").append(contentViewHolder).find("#"+this.getId()+"_content").append(webviewUI.getView());tabController.markActiveByElement(document.getElementById(this.getId()));setTimeout(function(){util.publish("/answerphrase/compute",this.getId())}.bind(this),0);console.debug("Tabload["+this.getId()+"] = "+url);util.publish("/timer/set/active/connid/",this.getId())};Tabs.prototype.isDemoLine=function(){var regex=/(isDemoLine=true)/g;var accNo=util.getParameterByName("acctNum",this.getURL())||util.getParameterByName("accountNumber",this.getURL());if(util.getDemoLines().indexOf(accNo)!==-1&&!regex.test(url))this.url+="&isDemoLine=true";return this.url};Tabs.prototype._open=function(){this.constructURL();this._constructUI();this._constructUIView()};Tabs.prototype.isNodeIntegAvailable=function(){var cbObject=this.getOptions();if(cbObject&&cbObject.nodeintegrations){return cbObject.nodeintegrations}};Tabs.prototype.getOnload=function(){var cbObject=this.getCallBacks();if(cbObject){return cbObject.onload}};Tabs.prototype.getCallBacks=function(){var options=this.getOptions();if(options&&options.callbacks)return options.callbacks};Tabs.prototype.getOptions=function(){return this.options};Tabs.prototype.onload=function(evt){var id=tabController._getIDByElement(evt.target);console.warn("Onload received : "+evt.target.src);var params=util.getParameters(evt.target.src);util.analytics.push(params["accountNumber"],analytics.TAB_ONLOAD,params["connId"],evt.target.src);util.webview.post(tabController.getTabById(id),util.getInitObj(id),"webapp-init")};Tabs.prototype.domReady=function(evt){var id=tabController._getIDByElement(evt.target);if(util.tabs.getActiveTabId()===id)tabController.autoFocus(id)};Tabs.prototype.isClosable=function(argument){this.canClose=true};var tabController={_initialTab:null,UI:{holder:$(".tab-content-hold")},name:"tabController",log:function(){util.log.apply(this,arguments)},billAR:{lastARConnId:null,_fetchUnbilledAR:function(){$("webview[data-conn-id-is-billed=false]").each(function(index,dom){var src=tabController.sources.getURLbyId(tabController._getIDByElement(dom));console.warn("BILL AR original source _fetchUnbilledAR ",src);this.isNotChargeable(util.getParameters(src),dom)}.bind(this))},markARforBilling:function(){this._fetchUnbilledAR()},store:function(params){if(params&&params.connId&&params.calltype&&params.calltype.toLowerCase()!="fetch"){return this.lastARConnId=params.connId}},isNotChargeable:function(params,dom){var connid=params.connId,dom=dom||util.tabs.getTabById(params.currentTabIndex);if(params.calltype&&["repeats","epcustom"].indexOf(params.calltype.toLowerCase())!=-1&&connid&&this.lastARConnId){if(!(this.lastARConnId==connid)&&!this.isConnIdBilled(dom)){console.warn('AR : <"'+connid+'"> not charged');sbARStatusPush(connid,"donot-charge");this.updateDataBillInfo(dom);return true}}},updateDataBillInfo:function(dom){if(dom){return dom.dataset.connIdIsBilled="true"}},isConnIdBilled:function(dom){if(dom){return dom.dataset.connIdIsBilled==="true"}}},sources:{name:"sourceMap",idMap:{},getOriginalSrc:function(defectiveSrc){return this.getURLbyId(this.getIDbyUrl(defectiveSrc))},getURLbyId:function(id){if(id){return this.idMap[id]}},getIDbyUrl:function(lUrl){if(lUrl){var tabId,idRegex,wv=$("webview");tabController.log("Original SRC : "+lUrl);for(var i=wv.length-1;i>=0;i--){if(wv[i].src.trim()==lUrl.trim()||wv[i].src.trim().includes(lUrl.trim())){idRegex=new RegExp("[0-9]+","g").exec(wv[i].id);tabId=idRegex&&idRegex.length?idRegex[0]:false;tabController.log("Successfully got ID : "+tabId);break}}return tabId}},reclaimMemory:function(key){this.idMap[key]=null;delete this.idMap[key]},writeInMap:function(key,value,map){if(typeof map=="object"&&key&&value)map[key]=value},checkURLPresence:function(key,url,map){return new RegExp(url,"ig").test(map[key])},store:function(url,params){if(params&&params.currentTabIndex){if(!this.checkURLPresence(params.currentTabIndex,url,this.idMap))this.writeInMap(params.currentTabIndex,url,this.idMap)}}},interruptible:{connIDarray:[],isPresent:function(connId){return connId&&this.connIDarray.indexOf(connId)!==-1},isValid:function(reqParam){return reqParam&&(reqParam["connId"]||reqParam["connid"])&&reqParam["isInterruptible"]&&reqParam["isInterruptible"]=="true"},store:function(reqParam){reqParam["connId"]=reqParam["connId"]||reqParam["connid"];if(this.isValid(reqParam)&&!this.isPresent(reqParam["connId"])){return this.connIDarray.push(reqParam["connId"])}},remove:function(connId){this.connIDarray=this.connIDarray.filter(function(currentConnId){if(!new RegExp(currentConnId,"i").test(connId)){return true}})},mergeConnIdTypoProps:function(obj){if(obj&&(obj.connId||obj.connid)){var connidValue=obj.connId||obj.connid;obj.connId=connidValue;return obj}},check:function(lConnIdObj){var mergedObj=this.mergeConnIdTypoProps(lConnIdObj);if(mergedObj&&this.isPresent(mergedObj.connId))return mergedObj},send:function(mergedObj){amplify.publish("/status/controller/push/interruptible/info",mergedObj)}},registerMetaInfo:function(url){if(url&&util.isUrl(url)){var reqParam=util.getParameters(url);this.sources.store(url,reqParam);this.interruptible.store(reqParam);this.billAR.store(reqParam)}},_getInitialTab:function(){if(!this._initialTab){this._initialTab=$(".v2_tab li#1")}return this._initialTab},_hideInitialTab:function(){this._getInitialTab().hide()},_checkInitialTab:function(){if(!this.getAllWebview().length){this._showInitialTab()}else{this.populateOtherTab()}},_showInitialTab:function(){this._getInitialTab().show();this.markActiveByElement(this._getInitialTab().get(0));util.publish("menuBar/updateTitle")},resizeAll:function(){return this.UI.holder.height(this.getResizeHeight())},getResizeHeight:function(){return window.innerHeight-64},close:function(targetEl){var id=this._getIDByElement(targetEl);this.closeByID(id)},closeActiveTab:function(){this.close(this.getActiveTab())},closeByID:function(tabId){if(tabId&&tabId&&tabId!=1){this.removeTab(tabId);this._checkInitialTab();util.publish("/app/restore/remove","tabs",tabId)}},removeTab:function(id){var tmp=this.getAllUIForTab(id);util.publish("/link/preview/dispose/webview",tmp.webview.get(0));tmp.ui.remove();tmp.webview.remove();tmp.outerWebviewDiv.remove()},markActiveByElement:function(ele){if(ele&&ele.id){$(ele).addClass("active").siblings().removeClass("active");$("#"+ele.id+"_content").addClass("active").siblings().removeClass("active")}},markActiveById:function(id){var ele;if(id&&(ele=document.getElementById(id))){$(ele).addClass("active").siblings().removeClass("active");$("#"+ele.id+"_content").addClass("active").siblings().removeClass("active")}},create:function(url,options,cb){if(url){new Tabs(url,options,cb);this._hideInitialTab();util.publish("/maxtabcounter/pushNumberOfTabsLoadedInfo")}},closeCompute:function(closeParamObj){util.publish("/timer/findLastActiveARAndUpdate");this.log("closeCompute :: ",closeParamObj);util.publish("/tabLock/closeUI/hideUI/");util.publish("/answerphrase/close/active/ap");if(closeParamObj){var id,params,originalURL;if(closeParamObj.tabIndex){id=closeParamObj.tabIndex;params=util.getParameters(closeParamObj.source)}if(!util.isNumber(id)){params=util.getParameters(closeParamObj.source);id=params.currentTabIndex}if(!util.isNumber(id)){params=this.getOriginalParamFromDSource(closeParamObj.source);id=params.currentTabIndex}originalURL=this.sources.getURLbyId(id);this.log("tabId : "+id+" > originalURL : "+originalURL);if(originalURL){params=util.getParameters(originalURL);this.log("computed params : ",params);this.billAR.isNotChargeable(params);util.analytics.push(params["accountNumber"],analytics.TAB_CLOSE,params["connId"],originalURL);this.closeAccountByTabId(params);this.closeTimerInterval(params)}}},closeTimerInterval:function(params){if(params.connId&&/repeats|epCustom/i.test(params.calltype)){util.publish("/timer/close/",params)}},closeAccountByTabId:function(params){if(params){this.closeByID(params.currentTabIndex);setTimeout(function(){util.publish("/tabs/resize/dynamic")},0);setTimeout(function(){this.sources.reclaimMemory(params.currentTabIndex)}.bind(this),5e3);return params}},getOriginalParamFromDSource:function(src){var orignalSource=this.sources.getOriginalSrc(src);return orignalSource?util.getParameters(orignalSource):false},populateOtherTab:function(){var id,allViews=this.getAllWebview();if(allViews.length&&(id=this._getIDByElement(allViews[allViews.length-1]))){this.markActiveById(id);this.autoFocus(id)}else{this.autoFocus("1");util.publish("/timer/hwnd/hide")}},reload:function(){var activeTab=util.tabs.getActiveTab();if(activeTab)activeTab.reload()},terminate:function(){},informAllTabs:function(msgInfo){var views=this.getAllWebview();for(var i=0;i<views.length;i++){util.webview.post(views[i],msgInfo,"webapp-msg")}},getAllWebview:function(){return $("webview:not(#processReduce,#LoginModule,#softphoneWidget)")},getAllUIForTab:function(id){return id?{ui:$("#"+id),webview:$("#web"+id),outerWebviewDiv:$("#"+id+"_content")}:false},_getIDByElement:function(ele){if(!ele)return;var matcher=ele.id.match("[0-9]+");return matcher&&matcher.length?matcher[0]:1},getActiveTabSrc:function(id){var tab=this.getActiveTab(id);return tab?tab.src:false},getSrcByTabId:function(id){var tab=this.getActiveTab(id);return tab?tab.src:false},getActiveTabId:function(){return this._getIDByElement(this.getActiveTab())},getActiveTab:function(id){return id?this.getTabById(id):this.getTabByCss()},getTabByMatchingParams:function(queryInfo){if(queryInfo&&queryInfo.paramValue){var webviews=this.getAllWebview();for(var i=webviews.length-1;i>=0;i--){var view=webviews[i];if(new RegExp(queryInfo.paramValue,"i").test(view.src)){return view.src}}}},getTabByCss:function(){var wrapperView=document.querySelector(".tab-content.active");if(wrapperView&&wrapperView.children&&wrapperView.children.length>0&&wrapperView.children[0].id!="LoginModule"){return wrapperView.children[0]}},getTabById:function(id){return id?document.querySelector("#web"+id):false},_shadowRootFocus:function(webView){return util.document.shadowRootFocus(webView)},_focusById:function(id){if(id&&id!=1&&util.isNumber(id)){this._shadowRootFocus(document.querySelector("#web"+id));util.publish("menuBar/updateTitle",$("#"+id)[0].classList[0])}},_focusByActivity:function(){var toActivate=this.getTabByCss();if(toActivate){this._shadowRootFocus(toActivate)}},autoFocus:function(id){this._focusById(id);util.publish("/answerphrase/compute",id);setTimeout(function(){if(util.tabs.getTabById(id)){util.publish("/timer/set/active/connid/",id)}},0)},debug:{_activateDebug:function(){this.log("Globals activated, added named a.[TabController] = Tab control manager, b.[Tabs] = Tab Creator");R["TabController"]=this;R["Tabs"]=Tabs},_deActivateDebug:function(){this.log("Globals deactivated, added named a.[TabController] = Tab control manager, b.[Tabs] = Tab Creator");R["TabController"]=null;R["Tabs"]=null;delete window["TabController"];delete window["Tabs"]}},loadWorkURL:function(url){var availableTabs=this.getAllWebview();if(!url){var fullWorkSkill=userDAO.getSkillByName("FullWork");if(fullWorkSkill&&fullWorkSkill.url)url=fullWorkSkill.url}if(url){for(var i=0;i<availableTabs.length;i++){if(availableTabs[i].src.indexOf(url)!==-1){this.markActiveByElement(availableTabs[i].parentElement);this.markActiveByElement(document.getElementById(tabController._getIDByElement(availableTabs[i].parentElement)));return true}}util.loadURL(url)}},restore:{recoverTabs:function(restoreInfo){util.publish("/app/restore/removeAll","tabs");console.warn("Restore INFO : ",restoreInfo);for(var i=0;restoreInfo&&i<restoreInfo.length;i++){var url=restoreInfo[i].url;setTimeout(function(url){console.log("original URL : "+url);if(!/&isCrashed/.test(url)){url+="&isCrashed=true";console.log("appending crash parame : "+url)}util.loadURL(url)}.bind(null,url),0)}FULLClient.ipc.send({eType:"isRestored",container:namespace.CONTAINER_SB})},eventRecieved:function(){util.publish("/app/restore/get","tabs",this.recoverTabs)}},clickTab:function(tabs,i){var tabId=tabs[i].id.slice(3);$("#"+tabId).trigger("click")},switchTab:function(){var tabs=util.tabs.getAllTabs();if(typeof tabs[0]=="undefined")return;var ct=util.tabs.getActiveTab().id;for(var i=0;i<tabs.length;i++){if(tabs[i].id==ct){if((i=i+1)<tabs.length){this.clickTab(tabs,i);return}else if(i+1>tabs.length){this.clickTab(tabs,0);return}}}}};var tabCloseController={tabCloseMap:[],lockTabOnClose:function(msg){var map={tabId:util.getParameterByName("currentTabIndex",msg.url),options:msg.dialog};this.tabCloseMap.push(map)},reclaimMemory:function(tabID){this.tabCloseMap.removeItem("tabId",tabID)},isTabAvailable:function(id){return this.tabCloseMap.filterObjects("tabId",id)}};util.subscribe("/timer/markActiveById",tabController,tabController.markActiveById);util.subscribe("/switch/tab/shortcut",tabController,tabController.switchTab);util.subscribe("tabCloseController/reclaimMemory",tabCloseController,tabCloseController.reclaimMemory);util.subscribe("tabCloseController/lockTabOnClose",tabCloseController,tabCloseController.lockTabOnClose);util.subscribe("/tab/controller/create",tabController,tabController.create);util.subscribe("/tab/controller/close/active",tabController,tabController.closeActiveTab);util.subscribe("/tab/controller/close/by/element",tabController,tabController.close);util.subscribe("/tab/controller/close/by/id",tabController,tabController.closeByID);util.subscribe("/tab/controller/close/tab/",tabController,tabController.closeCompute);util.subscribe("/tab/controller/close/billAR",tabController.billAR,tabController.billAR.isNotChargeable);util.subscribe("/tab/controller/billAR/check/inactive/tabs",tabController.billAR,tabController.billAR.markARforBilling);util.subscribe("/tab/controller/load/fullwork",tabController,tabController.loadWorkURL);util.subscribe("/tab/controller/status/to/tabs",tabController,tabController.informAllTabs);util.subscribe("/debug/switch/global/on",tabController,tabController.debug._activateDebug);util.subscribe("/debug/switch/global/off",tabController,tabController.debug._deActivateDebug);util.subscribe("/tab/restore/check",tabController.restore,tabController.restore.eventRecieved);util.subscribe("module/controller/onload",tabController,tabController.resizeAll);util.tabs={getLastARConnId:function(){return tabController.billAR.lastARConnId},getOriginalTabSrc:function(id){return id?tabController.sources.getURLbyId(id):false},isInterruptible:function(connId){return tabController.interruptible.isPresent(connId)},removeInterruptibleConnId:function(connId){return tabController.interruptible.remove(connId)},getTabByParam:function(queryInfo){return tabController.getTabByMatchingParams(queryInfo)},getActiveTabId:function(){return tabController.getActiveTabId()},getTabById:function(id){return id?tabController.getTabById(id):false},getActiveTab:function(){return tabController.getActiveTab()},getAllTabs:function(){return tabController.getAllWebview()},getOriginalParam:function(src){return tabController.getOriginalParamFromDSource(src)},getOriginalParamById:function(id){var sourceUrl=tabController.sources.getURLbyId(id);return sourceUrl?util.getParameters(sourceUrl):null},getActiveTabSrc:function(id){return id?tabController.getActiveTabSrc(id):false},focusActiveTab:function(){tabController._focusByActivity();return true}};R.tabController=tabController;R.Tabs=Tabs;if(module&&module.exports){module.exports.tabController=tabController;module.exports.Tabs=Tabs}})(this,util,jQuery);(function(R,util){var statusDropDown={dropdown:$(".closeDwn ul"),dropdown_btn:$("#status_switch"),showDropDownBtn:function(){this.dropdown_btn.show()},hideDropDownBtn:function(){this.dropdown_btn.hide()},setListener:function(){this.dropdown_btn.click(function(){console.warn("@CloseTab: status switch");this.toggleDropDown(true)}.bind(this))},isBtnFocused:function(){if(this.dropdown_btn.is(":focus")){return true}},isVisible:function(){return this.dropdown.is(":visible")},hideDropDown:function(){return this.dropdown.hide()},showDropDown:function(){this.dropdown.show();commonUtils.highLightSelectedElement()},toggleDropDown:function(isMouseClick){if(this.isVisible()){this.hideDropDown();this.checkForStatusChange(isMouseClick)}else this.showDropDown()},checkForStatusChange:function(isMouseClick){if(!isMouseClick){var selectedElem=commonUtils.getSelectedElem();console.log("Changing status in UI with enter key press",selectedElem);statusHandler.statusSwitchHandler(selectedElem)}}};var sendMessage={toAnalytics:function(params,originalURL,isRecentRefetch,status,type){console.log("Sending to analytics ... ",arguments);if(params&&type){var metaInfo={url:originalURL||tabInfoObj["tabSrcUrl"]};if(textAreaHandler["userText"]){metaInfo["tabXCloseInfo"]=textAreaHandler["userText"]}metaInfo["status"]=status;metaInfo["isRecentRefetch"]=isRecentRefetch;metaInfo["originalSrcUrl"]=tabInfoObj["tabSrcUrl"];metaInfo["currentTabLocation"]=tabInfoObj["currentTabLocation"];console.warn("@closeTab Info : to analytics : ",metaInfo);util.analytics.push(params["accountNumber"],type,params["connId"],JSON.stringify(metaInfo))}},sendPopUpCancelInfo:function(){console.log("sendPopUpCancelInfo !!!!!");var params,connID,isRecentRefetch,status;params=commonUtils.getParams();connID=commonUtils.getConnID(params);isRecentRefetch=refetchRoutine.isRecentRefetch(params)||false;if(!isRecentRefetch)status=statusHandler.fetchStatusInfo(connID);this.toAnalytics(params,null,isRecentRefetch,status,analytics.TAB_XCLOSE_Cancel)},getMailSubject:function(tabInfo,params){var sub="Tab X-Close";if(params&&refetchRoutine.isRecentRefetch(params)){sub+=" (Recent Refetch)"}var accInfo=tabInfo.accountNumber||tabInfo.connId||"";console.log("accInfo : ",accInfo);sub+=" : "+accInfo;console.warn("@closeTab : mail Subject : ",sub);return sub},getMetaInfo:function(){var params=commonUtils.getParams();var tabInfo=commonUtils.getTabInfo(params);console.warn("@closeTab - tabInfo :",tabInfo);return{type:"tab-XClose",tabInfo:tabInfo,xCloseReason:textAreaHandler.userText,subject:this.getMailSubject(tabInfo,params)}},toDev:function(){console.warn("@closeTab - Started Mailing to Dev");var metaInfo=this.getMetaInfo();util.publish("/mailHelper/mailsend",metaInfo,function(){console.warn("Mail Pushed to Dev with TabInfo : ",metaInfo)})}};var textAreaHandler={textArea:$("#closeTabUI").find("textarea"),errTextShown:false,userText:null,tabFocus:false,focusTextArea:function(){this.textArea.focus()},setListener:function(){this.textArea.on("change keyup paste keypress",this.textArea_onKeyPress).on("focus",function(){this.onFocusTextArea.call(this)}.bind(this)).on("blur",function(){this.removeTextAreaStyle.call(this)}.bind(this))},clearTextArea:function(){this.textArea.val("")},clearText:function(){this.userText=null},textArea_onKeyPress:function(evt){util.doNotBubble(evt);if(this.value.trim().length){textAreaHandler.hideErrText()}},showErrText:function(){this.errTextShown=true;this.textArea.addClass("error").focus()},hideErrText:function(){this.errTextShown=false;this.textArea.removeClass("error")},highlightTextArea:function(){this.textArea.css({border:"1px solid #DCDCDC","box-shadow":"0px 0px 10px #DCDCDC"})},removeTextAreaStyle:function(){this.textArea.css({border:"","box-shadow":""})},onFocusTextArea:function(){if(!this.errTextShown){this.highlightTextArea()}else{this.textArea.addClass("error")}if(statusDropDown.isVisible()){return statusDropDown.hideDropDown()}},getUserText:function(){if(!this.setText()){console.warn("@closeTab - No text found");this.showErrText()}return this.userText},setText:function(){this.userText=this.textArea.val().trim();return this.userText},updateTextInUI:function(params){if(this.getTextFromLS(params)){console.log("Updating text in UI.... ",this.userText);return this.textArea.val(this.userText)}else{console.warn("Text not available in LS.... ",this.userText);this.textArea.val("")}},getTextFromLS:function(params){console.log(" Getting text from Loc Storage",params);var connIdMap=commonUtils.getConnIdMap();var connId=params.connId||params.connid;if(connIdMap[connId]&&connIdMap[connId].text){this.userText=connIdMap[connId].text;return this.userText}},storeTextInLS:function(){console.log("storeTextInLS :",this.userText);var params=commonUtils.getParams();var connId=params.connId||params.connid;var connIdMap=commonUtils.getConnIdMap();if(connIdMap[connId]){console.log("adding text alone to connid map");connIdMap[connId].text=this.userText}else{console.log("conn id not in map");connIdMap[connId]={connid:connId,currentTabIndex:params.currentTabIndex,status:null,text:this.userText}}util.storage.set("timerConnIdMap",connIdMap)}};var statusHandler={statusTextList:["Close / Go Available","Close / Go to Break","Close / Meeting","Close / System Issues","Close / Project","Close / Personal","Close / Training","Close / Offline"],defaultStatusText:"Close / Go Available",defaultStatus:"Available",statusSelected:false,statusMap:{Available:"Close / Go Available",Break:"Close / Go to Break",Meeting:"Close / Meeting",System:"Close / System Issues",Project:"Close / Project",Personal:"Close / Personal",Training:"Close / Training",Offline:"Close / Offline"},getStatusIndex:function(statusText){if(statusText){return this.statusTextList.indexOf(statusText)}},getStatusElemFromDom:function(statusText){var index=this.getStatusIndex(statusText);if(index!==-1){return $(".closeDwn ul li:eq("+index+")")}},setListener:function(){$(".closeDwn ul li").click(function(event){console.log("dropdown item clicked");statusHandler.status_switch.call(statusHandler,$(this))})},updateStatusInUI:function(statusText){console.log("Updating status text :",statusText);if(statusText){closeTabDecider.closeTabBtn.text(statusText)}},fetchStatusInfo:function(connId){var connIdMap=commonUtils.getConnIdMap();if(connId&&connIdMap[connId]&&connIdMap[connId].status){return connIdMap[connId].status}},storeStatusInfo:function(status){console.log("Storing status  :",status);if(status){var params=commonUtils.getParams();var connId=params.connid||params.connId;var statusInfo=commonUtils.getConnIdMap();statusInfo[connId]={connid:connId,currentTabIndex:params.currentTabIndex,status:status};util.storage.set("timerConnIdMap",statusInfo)}},checkForStatusSelection:function(){if(!this.statusSelected){this.storeStatusInfo(this.defaultStatus)}},getStatusKey:function(value){for(var key in this.statusMap){if(new RegExp("^"+value+"$").test(this.statusMap[key])){return key}}},getStatusValue:function(key){return this.statusMap[key]},setFlag:function(bool){this.statusSelected=bool},getLastSelectedStatusAndUpdateInUI:function(connId){var status=this.fetchStatusInfo(connId);if(status){this.setFlag(true);this.updateStatusInUI(this.getStatusValue(status))}else this.updateStatusInUI(this.defaultStatusText);return status||this.defaultStatus},getStatusFromUI:function(){if(closeTabDecider.closeTabBtn&&closeTabDecider.closeTabBtn.text)return closeTabDecider.closeTabBtn.text().trim()},checkForStatusMatch:function(){var statusInUI=this.getStatusFromUI();var lastStatusFromDropdown=commonUtils.getSelectedElem();if(this.isNewStatus(lastStatusFromDropdown,statusInUI)){return statusInUI}},isNewStatus:function(selectedStatus,statusInUI){console.log("is New status :selectedStatus : ",selectedStatus," statusInUI : ",statusInUI);if(statusInUI&&selectedStatus&&statusInUI!==selectedStatus){return true}},getSelectedStatus:function(elem){if(elem){commonUtils.setCurrentElem(elem);return commonUtils.getSelectedElem()}},statusSwitchHandler:function(statusText){if(!statusText)return;if(this.isNewStatus(statusText,this.getStatusFromUI())){console.log("statusSwitchHandler ...",statusText);this.updateStatusInUI(statusText)}else{if(statusDropDown.isVisible()){console.log("statusSwitchHandler : hideDropDown");statusDropDown.hideDropDown()}}this.setFlag(true);this.storeStatusInfo(this.getStatusKey(statusText));closeTabDecider.closeTabCB.call(closeTabDecider)},status_switch:function(selectedElement){if(selectedElement){console.log("Status switch from key press");this.statusSwitchHandler(this.getSelectedStatus(selectedElement))}},getXcloseInfoObj:function(params){if(params){var connId=commonUtils.getConnID(params);return{status:statusHandler.fetchStatusInfo(connId),connId:connId,isInterruptible:params.isAR?util.tabs.isInterruptible(connId):false,calltype:params.calltype}}},pushStatus:function(params){var xCloseObj=this.getXcloseInfoObj(params);console.log("changing V2 status for recent AR : ",xCloseObj);util.publish("/status/controller/push/xclose/Info",xCloseObj)}};var commonUtils={firstElem:$("#status_scroll").children().first(),lastElem:$("#status_scroll").children().last(),currentElem:null,getParams:function(tabSourceUrl){return util.getParameters(tabSourceUrl||tabInfoObj.getTabSrc())},getConnID:function(params){var connID=params.connId||params.connid;if(connID){return connID}},getTabInfo:function(params){if(params){console.warn("@closeTab - getTabInfo : params : ",params);return{originalSrcUrl:tabInfoObj.tabSrcUrl,currentTabLocation:tabInfoObj.getCurrentTabUrl(),accountNumber:params["accountNumber"],connId:params["connId"]||params["connid"]}}},getConnIdMap:function(){var connIdMap=util.storage.get("timerConnIdMap");if(!connIdMap)connIdMap={};return connIdMap},getElemIndex:function(elem){return elem.index?elem.index():elem.getAttribute("value")},setCurrentElem:function(value){if(value){this.currentElem=value}},focusFirstElem:function(){this.setCurrentElem(this.firstElem);this.highLightElem(this.currentElem.siblings(),this.currentElem)},focusLastElem:function(){this.setCurrentElem(this.lastElem);this.highLightElem(this.currentElem.siblings(),this.currentElem);this.scrollLast()},getSelectedElem:function(){if(this.currentElem){return this.currentElem.length?this.currentElem[0].textContent.trim():this.currentElem.textContent.trim()}},highLightSelectedElement:function(){var statusInUI=statusHandler.checkForStatusMatch();if(statusInUI){this.currentElem=statusHandler.getStatusElemFromDom(statusInUI)}if(this.currentElem){var index=this.getElemIndex(this.currentElem);if(index>=0&&index<4){this.scrollFirst()}else{this.scrollLast()}this.highLightElem(this.currentElem.siblings(),this.currentElem)}else{this.scrollFirst()}},highLightElem:function(prevElem,currentElem){if(prevElem)prevElem.css("background-color","#ffffff").find("a").css("color","#333");if(currentElem)currentElem.css("background-color","#218AA0").find("a").css("color","#ffffff")},scrollFirst:function(){keyEventHandler.menu.scrollTop(0)},scrollLast:function(){keyEventHandler.menu.scrollTop(101)}};var tabInfoObj={tabSrcUrl:null,currentTabLocation:null,tabIdToClose:null,setId:function(tabId){if(tabId)this.tabIdToClose=tabId},getTabSrc:function(){this.tabSrcUrl=util.tabs.getOriginalTabSrc(this.tabIdToClose);return this.tabSrcUrl},getCurrentTabUrl:function(){this.currentTabLocation=util.tabs.getTabById(this.tabIdToClose).getURL();console.warn("@closeTab : Getting current tab Location : ",this.currentTabLocation);return this.currentTabLocation}};var closeTabDecider={closeTabUI:$("#closeTabUI"),textArea:$("#closeTabUI").find("textarea"),closeTabBtn:$("#closeTabYes"),transparentBg:$(".black-screen"),isPopUpShown:function(){return this.closeTabUI.is(":visible")},showUI:function(){console.warn("@closeTab : showing popuUp");setTimeout(function(){this.showTransparentBG();this.closeTabUI.show().find("textarea").focus()}.bind(this),0)},hideUI:function(){if(this.isPopUpShown()){console.warn("@closeTab : hiding popuUp");this.closeTabUI.hide();textAreaHandler.clearTextArea();this.hideTransparentBG()}},storeTextAndHideUI:function(){textAreaHandler.setText();sendMessage.sendPopUpCancelInfo();textAreaHandler.storeTextInLS();textAreaHandler.clearText();this.hideUI()},showTransparentBG:function(){this.transparentBg.show()},hideTransparentBG:function(){this.transparentBg.hide()},applyTabLock:function(params){console.log("apply tab lock");var connID=commonUtils.getConnID(params);if(connID){console.log("applying... tab lock");textAreaHandler.hideErrText();statusDropDown.hideDropDown();refetchRoutine.removeJustClose();statusHandler.getLastSelectedStatusAndUpdateInUI(connID);textAreaHandler.updateTextInUI(params);this.showUI()}},isCallTypeValid:function(calltype){if(calltype&&/repeats|epCustom|InBoundCall/i.test(calltype)){console.log("ITs a valid interaction...");return true}},lockAllTab:function(tabInfo){tabInfoObj.setId(tabInfo.tabIndex);console.warn("@closeTab -lockAllTab - TAB ID: ",tabInfoObj.tabIdToClose);var params=commonUtils.getParams(tabInfo.source);console.warn("@closeTab - lockAllTab - params : ",params);if(forceCloseRoutine.isThirdPartyAr(params)){console.log("Third party routine closing withou lock...");return forceCloseRoutine.closeThirdPartyAr(params,tabInfo)}if(refetchRoutine.isRecentRefetch(params)){refetchRoutine.lockRecentRefetch(params)}else if(!util.isFetch(params)&&this.isCallTypeValid(params.calltype)){console.warn("Applying Lock to Interaction - calltype: ",params.calltype);this.applyTabLock(params)}else{console.warn("Closing the Tab without Lock - calltype: ",params.calltype);this.closeTab(tabInfo)}},decider:function(tabInfo){this.lockAllTab(tabInfo)},closeTab:function(tabInfo){if(tabInfo&&typeof tabInfo=="object"){util.publish("/tab/controller/close/tab/",tabInfo)}},closeTabCB:function(){console.warn("@closeTab - closeTabCB : userText : ",this.userText,": statusSelected Flag :",this.statusSelected);if(textAreaHandler.getUserText()){console.warn("@closeTab - user feedback :",this.userText);statusHandler.checkForStatusSelection();statusHandler.setFlag(false);var selectedStatus=statusHandler.getLastSelectedStatusAndUpdateInUI();this.hideUI();sendMessage.toDev();forceCloseRoutine.init(selectedStatus)}},changeBgColor:function(selected,siblings){siblings.css("background-color","")},setListeners:function(){this.setBtnListener();keyEventHandler.setListener();mouseEventHandler.setListener();statusDropDown.setListener();textAreaHandler.setListener();statusHandler.setListener();$("body").on("keydown","#closeTabUI",function(e){if(e.keyCode==27){this.escKeyPress()}}.bind(this))},escKeyPress:function(){if(this.isPopUpShown())this.storeTextAndHideUI()},setBtnListener:function(){$("#closeTabYes").click(function(){console.warn("@CloseTab: Yes Btn Clicked");this.closeTabCB.call(this)}.bind(this));$("#closeTabNo").click(function(){console.warn("@CloseTab: No Btn Clicked");this.storeTextAndHideUI()}.bind(this))}};util.subscribe("shortcuts/keyPress/escape",closeTabDecider,closeTabDecider.escKeyPress);var forceCloseRoutine={init:function(selectedStatus){console.log("forceClose Routine ....selectedStatus :",selectedStatus);var isRecentRefetch,originalSrcUrl=tabInfoObj.getTabSrc(),params=commonUtils.getParams(originalSrcUrl);closeTabDecider.closeTab({source:originalSrcUrl,tabIndex:tabInfoObj.tabIdToClose});if(refetchRoutine.isRecentRefetch(params)){isRecentRefetch=true;refetchRoutine.closeRecentRefetch(params)}else if(this.isInBoundCall(params)){console.log("@forceClose Routine , isInBoundCall ");isRecentRefetch=false;this.closeInBoundCall(params)}else if(this.isAR(params)){isRecentRefetch=false;console.log("@forceClose Routine, repeats  and  epCustom");this.closeAR(params)}sendMessage.toAnalytics(params,originalURL,isRecentRefetch,selectedStatus,analytics.TAB_XCLOSE)},isThirdPartyAr:function(params){if(params.xCloseCompleted){return true}},closeThirdPartyAr:function(params,tabInfo){if(this.isAR(params)){console.warn("pushing Available staus for third party like intercom..");util.publish("tab/sbARStatusPush",params.connId,"Completed");util.publish("/status/UIController/manual/status/change","Available")}closeTabDecider.closeTab(tabInfo)},closeAR:function(params){if(!params.xCloseCompleted){util.publish("tab/sbARStatusPush",params.connId,"Completed-TabClose");params.isAR=true;statusHandler.pushStatus(params)}},closeInBoundCall:function(params){params.isAR=false;statusHandler.pushStatus(params)},isAR:function(params){if(params&&params.connId&&params.calltype&&["repeats","epcustom"].indexOf(params.calltype.toLowerCase())!=-1){return true}},isInBoundCall:function(params){if(params&&params.connId&&!params.xCloseCompleted&&params.calltype&&/InBoundCall/i.test(params.calltype)){return true}}};var refetchRoutine={justCloseText:"Close Tab",applyJustClose:function(){statusDropDown.hideDropDownBtn();statusHandler.updateStatusInUI(this.justCloseText)},removeJustClose:function(){statusDropDown.showDropDownBtn()},lockRecentRefetch:function(params){console.log("locking Recent Refetched Interaction");if(params.connId||params.connid){console.log("applying... tab lock for recent Refetched account");textAreaHandler.hideErrText();this.applyJustClose();textAreaHandler.updateTextInUI(params);closeTabDecider.showUI()}},isRecentRefetch:function(params){var connID=params.connId||params.connid;if(params&&params.recentRefetch&&connID&&!util.isFetch(params)){return true}},closeRecentRefetch:function(params){console.log("@recent refetch force close ...");var connID=params.connId||params.connid;console.log("@recent refetch Completed-TabClose ...");util.publish("tab/sbARStatusPush",connID,"Completed-TabClose")}};var mouseEventHandler={isScrolling:false,mouseOverElem:null,checkMouseOver:function(){if(this.mouseOverElem){this.mouseOutCb(this.mouseOverElem);this.mouseOverElem=null}},mouseOverCb:function(selected,siblings){commonUtils.setCurrentElem(selected);commonUtils.highLightElem(siblings,selected);this.setMouseOverElem(selected)},setMouseOverElem:function(selectedElem){if(selectedElem)this.mouseOverElem=selectedElem},mouseOutCb:function(unSelectedElement){if(!unSelectedElement)return;commonUtils.highLightElem(unSelectedElement)},setListener:function(){$(".closeDwn ul").scroll(function(){mouseEventHandler.isScrolling=true;clearTimeout($.data(this,"scrollTimer"));$.data(this,"scrollTimer",setTimeout(function(){mouseEventHandler.isScrolling=false},250))});$(".closeDwn ul li").on("mouseenter",function(event){if(mouseEventHandler.isScrolling){return}mouseEventHandler.mouseOverCb.call(mouseEventHandler,$(this),$(this).siblings())}).on("mouseleave",function(e){if(mouseEventHandler.isScrolling){return}mouseEventHandler.mouseOutCb.call(mouseEventHandler,mouseEventHandler.mouseOverElem)})}};var keyEventHandler={menu:$("#status_scroll"),currentDiv:null,setListener:function(){$("#xClosePopUp").keydown(function(e){this.tabKeyPress(e);this.arrowKeyEvent.call(this,arguments)}.bind(this))},tabKeyPress:function(e){if(e.keyCode==9&&$(e.target).is("#closeTabNo")){textAreaHandler.focusTextArea()}},enterKeyPress:function(){if(statusDropDown.isBtnFocused()){statusDropDown.toggleDropDown()}},isArrowKey:function(args){if(args&&args.length&&(args[0].which==40||args[0].which==38))return true},isEnterKey:function(args){if(args&&args.length&&args[0].which==13)return true},isUpArrow:function(args){if(args&&args.length&&args[0].which==38){return true}},isDownArrow:function(args){if(args&&args.length&&args[0].which==40){return true}},arrowKeyEvent:function(args){var params=commonUtils.getParams();if(refetchRoutine.isRecentRefetch(params))return;if(this.isArrowKey(args)){this.statusScroll.call(this,args)}else if(this.isEnterKey(args)){this.enterKeyPress()}},upLimit:function(currentElem){var index=commonUtils.getElemIndex(currentElem);if(index<=4){return true}},downLimit:function(currentElem){var index=commonUtils.getElemIndex(currentElem);if(index>=4){return true}},scrollUp:function(){if(this.upLimit(commonUtils.currentElem)){console.debug("Going uppp");this.currentDiv=this.menu.children().last();var menuTop=this.menu.scrollTop();var elemHeight=this.currentDiv.outerHeight();this.menu.scrollTop(menuTop-elemHeight)}},scrollDown:function(){if(this.downLimit(commonUtils.currentElem)){console.debug("Going Down",commonUtils.currentElem);this.currentDiv=this.menu.children().first();var menuTop=this.menu.scrollTop();var elemHeight=this.currentDiv.outerHeight();this.menu.scrollTop(menuTop+elemHeight)}},getPrevElemIndex:function(previousElem){if(previousElem)return commonUtils.getElemIndex(previousElem)},hasPrevious:function(){if(commonUtils.currentElem.prev().size()==0){return false}else return true},canGoUp:function(prevElem){if(prevElem){var prevElemIndex=this.getPrevElemIndex(prevElem);if(prevElemIndex>=0&&prevElemIndex<=6){return true}}},hasNext:function(){if(commonUtils.currentElem.next().size()==0){return false}else return true},canGoDown:function(nextElem){if(nextElem){var nextElemIndex=this.getNextDivIndex(nextElem);if(nextElemIndex>=1&&nextElemIndex<=7){return true}}},getNextDivIndex:function(nextElem){if(nextElem)return commonUtils.getElemIndex(nextElem)},getPrevElem:function(){if(this.hasPrevious())return commonUtils.currentElem.prev();else return $("#status_scroll").children().last()},goUp:function(prevElem){commonUtils.highLightElem(prevElem.siblings(),prevElem);commonUtils.setCurrentElem(prevElem);this.scrollUp()},onScrollUp:function(){if(!commonUtils.currentElem){return commonUtils.focusLastElem()}var previousElem=this.getPrevElem();if(this.canGoUp(previousElem)){this.goUp(previousElem)}},getNextElement:function(){if(this.hasNext())return commonUtils.currentElem.next();else return $("#status_scroll").children().first()},goDown:function(nextElem){console.log("GO DOWN : nextElem ",nextElem);commonUtils.highLightElem(nextElem.siblings(),nextElem);commonUtils.setCurrentElem(nextElem);this.scrollDown()},onScrollDown:function(){var nextElement;if(!commonUtils.currentElem){return commonUtils.focusFirstElem()}nextElement=this.getNextElement();if(this.canGoDown(nextElement)){this.goDown(nextElement)}},statusScroll:function(args){if(statusDropDown.isVisible()){if(this.isDownArrow(args)){return this.onScrollDown()}else if(this.isUpArrow(args)){return this.onScrollUp()}}else{statusDropDown.showDropDown()}}};R.tabLock={closeTabDecider:closeTabDecider,textAreaHandler:textAreaHandler,mouseEventHandler:mouseEventHandler,keyEventHandler:keyEventHandler,refetchRoutine:refetchRoutine,statusDropDown:statusDropDown,statusHandler:statusHandler,sendMessage:sendMessage,commonUtils:commonUtils,tabInfoObj:tabInfoObj};util.subscribe("/tabLock/closeUI/decider/",closeTabDecider,closeTabDecider.decider);util.subscribe("/tabLock/closeUI/hideUI/",closeTabDecider,closeTabDecider.hideUI);util.subscribe("module/controller/onload",closeTabDecider,closeTabDecider.setListeners)})(window,util);$("input:text,textarea").keydown(function(e){switch(e.keyCode){case 81:case 82:case 87:{if(e.metaKey||e.ctrlKey){console.log(" cmd + w");util.preventEvent(e)}break}}});$("textarea").add('input:text[name="fetchVal"]').keydown(function(e){switch(e.keyCode){case 13:{util.publish("/fetch/load",e);break}case 27:{if(e.currentTarget.name=="fetchVal")util.publish("/fetch/hide/gui");else util.publish("/feedback/closeFeedback");break}}});if(!(userDAO.getSkillByName("FullWork")||userDAO.getSkillByName("CEA"))){$("#_chat").hide().next().hide()}$("#v2_Phone").click(function(){util.publish("/util/window/events/show",namespace.CONTAINER_V2)});$(".option-list #preferences").click(function(event){var target=$(event.currentTarget);target.hasClass("open")?target.removeClass("open"):target.addClass("open").siblings().removeClass("open");if($("header.main-header figure").hasClass("open"))$("header.main-header figure").removeClass("open")});$("#_chat").click(function(){util.publish("/util/window/events/show",namespace.CONTAINER_CHAT)});$(".option-list #preferences ul").click(function(event){if(event.target.innerHTML&&event.target.nodeName.toString()==="LI"){switch(event.target.innerText.trim()){case"Fetch":{util.publish("/fetch/display/gui");break}case"Re-Fetch Recent":{util.analytics.push(null,analytics.REFETCH_RECENT_CLICKED,FULLClient.getMode()+" "+FULLClient.getManifest().version+" "+process.platform,"User clicking on Refetch Recent.");util.publish("/refetch/recent");break}case"LoopToDo":{util.loadURL("http://my.loopto.do/?");break}case"Back up form":{util.analytics.push(null,analytics.BACKUP_FORM,null,"Agent using backup form");util.loadURL("https://docs.google.com/a/a-cti.com/spreadsheet/viewform?usp=drive_web&formkey=cHZHQnhWZDYwbHhXQjZseHhZM0dKWnc6MA#gid=17");break}case"Feedback":{util.analytics.push(null,analytics.FEEDBACK_CLICKED,FULLClient.getMode()+" "+FULLClient.getManifest().version+" "+process.platform,"User clicking on Feedback");util.publish("/feedback/display/gui");break}case"Team FULL Creative":{util.analytics.push(null,analytics.FULLCREATIVE_PAGE,null,"User Loaded Team FullCreative page");util.loadURL("https://sites.google.com/a/a-cti.com/redone-team-vc/home/");break}case"Reload V2":{util.publish("/v2/logout/confirmation","Are you sure, you want to reload?");break}case"Clear Cache":{event.stopImmediatePropagation();if(!util.clear.isCleared){$(event.target).addClass("hover_remove").children("i").addClass("show");util.analytics.push(null,analytics.APP_CLEAR_CACHE,null,"Clearing Cache for App from SB Window");util.publish("/softphone/softPhoneStop");util.publish("/util/menu/disableAll/onClearCache");util.clear()}break}case"Exit":{FULLClient["canQuit"]=true;util.publish("/app/quit/popup");break}case"Quit":{FULLClient["canQuit"]=true;util.publish("/app/quit/popup");break}case"Chats":{util.analytics.push(null,analytics.CHAT_ICON_CLICKED,FULLClient.getMode()+" "+FULLClient.getManifest().version+" "+process.platform,"User clicking on Chat icon");break}case"Network Strength":{util.analytics.push(null,analytics.NETWORK_STRENGTH_CLICKED,FULLClient.getMode()+" "+FULLClient.getManifest().version+" "+process.platform,"User clicking on Network strength indicator");break}default:{console.error("Some Funny sequence in settings tab capture it :: "+event.target.innerHTML.trim());break}}}});(function(util){var fileUpload={fileList:[],getImage:function(fileListObj){if(fileListObj&&fileListObj.length){for(var i=0;i<fileListObj.length;i++){var file=fileListObj[i];if(file.size<1024*1024*10){this.conversion(file.name,file.size);this.fileList.push(file)}else{alert("Maximum File Size limit is 10MB !!")}}this.clearInputHolder()}},extractFileName:function(txt){var fileName=txt.trim().replace(" ","").split(".")[0];return fileName},picReader:function(feedbackObj){try{if(feedbackObj&&this.fileList&&this.fileList.length){var count=0;for(var i=0;i<this.fileList.length;i++){count=count+1;var file=this.fileList[i];util.publish("/feedback/setImage",new ImageCapture(file.name||"UserUpload",this.getImageBlob(file),feedbackObj.id),false);if(count==this.fileList.length)feedbackObj.deferred.resolve("Files are stored in DB")}}else{console.debug("No Manual attachment files to upload");feedbackObj.deferred.resolve("NoFileToUpload")}}catch(e){feedbackObj.deferred.resolve("failed : "+e.message);console.error("UserFileUpload Failed :",e.message);console.error("UserFileUpload Failed :",e.stack)}},getImageBlob:function(file){console.log("file type:",file.type);var _blob=new Blob([file],{type:file.type?file.type:""});return _blob},KMGTbytes:function(num){var unit,units=["TB","GB","MB","KB","Bytes"];for(unit=units.pop();units.length&&num>=1024;unit=units.pop()){num/=1024}return[num,unit]},conversion:function(fname,fsize){var fileName=fname;var sizeArray=this.KMGTbytes(fsize);var fileSize=Math.floor(sizeArray[0]);var unit=sizeArray[1];this._deleteFileByName(fileName.trim());this.attachTemplate(fileName,fileSize,unit)},attachTemplate:function(fname,fsize,unit){var str="<li>"+'<span class="attachname">'+fname+"</span>"+"<span>("+fsize+unit+")</span>"+'<a class="clearattach">&times;</a>'+"</li>";$(".attach_list").append(str)},_deleteFileByName:function(currentFileName){if(currentFileName){for(var i=0;i<this.fileList.length;i++){var filename=this.fileList[i].name;if(filename==currentFileName){this.fileList.splice(i,1);$('.attachname:contains("'+currentFileName+'")').filter(function(){var spanDOM=$(this);if(currentFileName==spanDOM.text()){spanDOM.parent().remove()}})}}}},xButton:function(target){if(target){var _t=$(target);this._deleteFileByName(_t.siblings(".attachname").text());_t.parent().remove()}},clearFileList:function(){this.clearUI();this.clearCachedList();this.clearInputHolder()},clearInputHolder:function(){$("#fileUpload").val("")},clearUI:function(){$(".attach_list").empty()},clearCachedList:function(){this.fileList=[]},fileUploadDFD:function(feedbackObj){if(feedbackObj)this.picReader(feedbackObj)},setListeners:function(){$("#agentFb .popup-body").on("change","#fileUpload",function(event){util.publish("/fileUpload/get/inputImage",event.target.files)});$("#agentFb .popup-body").on("keydown",".attach",function(e){switch(e.keyCode){case 13:{$("#agentFb .popup-body #fileUpload").trigger("click");break}case 27:{util.publish("/feedback/UI/hide");break}}});$("#agentFb").on("keydown",function(e){if(e.keyCode==27){util.publish("/feedback/UI/hide")}});$("#agentFb .popup-body").on("click",".clearattach",function(evt){util.publish("/fileUpload/xbutton",this)})},init:function(){var str='<div class="attach_hold">'+'<ul class="attach_list"></ul>'+'<div class="btn-holder">'+'<a href="#" class = "attach" tabindex="2">Attach your file</a>'+'<input id="fileUpload" type="file" accept="image/*,text/plain,text/richtext,text/rtf," multiple/>'+"</div>"+"</div>";$("#agentFb .popup-body").append(str);this.setListeners()}};var fetch={element:$("#fetch"),goFetch:$("#fetch").find("#gofetch"),valElement:$("#fetch").find("input"),close:$("#fetch").find(".close_pref"),transparentBg:$(".black-screen"),trigger:function(){this.element.show();this.transparentBg.show();this.valElement.focus()},hide:function(){this.element.hide().find("input").val("");this.transparentBg.hide()},enterKeyPress:function(event){if(event&&event.target&&event.target.placeholder&&event.target.placeholder=="Account no/Conn Id"){console.log("validation pass");this.loadAccount()}},loadAccount:function(){this.validate();this.hide()},setRecentRefetch:function(url){url?util.storage.set("recentRefetch",url):false},getRecentRefetch:function(){var url=util.storage.get("recentRefetch");if(url){return url.replace(/(calltype=)[a-zA-Z]+[&]/,"calltype=fetch&recentRefetch=true&")}},validate:function(){var dataTrimmed=this.valElement.val().trim();var lUrl=this.isUrl(dataTrimmed)||this.accountURL(dataTrimmed)||this.connIDUrl(dataTrimmed);this.setRecentRefetch(lUrl);util.loadURL(lUrl);var params=util.getParameters(lUrl);util.analytics.push(params["accountNumber"]||params["acctNum"],analytics.FETCH,params["connId"]||params["connid"],lUrl)},isUrl:function(url){if(util.isUrl(url))return url},accountURL:function(accno){if(accno){accno=accno.replace(/[^\w]/g,"");accno=/[a-zA-Z]/.test(accno)?accno.replace(/[\d]/g,""):accno.replace(/[^\d]/g,"")}if(util.isNumber(accno)){return FULLClient.getConfig().sb5+"/InitialAccountAction/getAccountInfo.do?accountNumber="+accno+"&userpin=&calltype=fetch&useDNISMap=true&fetch=true&agentLogin="+util.user.getEmail()}},connIDUrl:function(connId){if(connId)return FULLClient.getConfig().sb5+"/InitialAccountAction/getAccountInfo.do?calltype=epCustom&connId="+connId+"&agentLogin="+util.user.getEmail()+"&isAgentResearch=true"},refetch:function(){util.loadURL(this.getRecentRefetch())},init:function(){this.close.click($.proxy(this.hide,this));this.goFetch.click($.proxy(this.loadAccount,this))}};var feedback={element:$("#agentFb"),transparentBg:$(".black-screen"),close:$("#agentFb").find(".close_pref"),feedbackText:$("#agentFb").find("textarea"),sendFeedback:$("#agentFb").find("#sendFdb"),isNotCached:false,setCharCount:function(){$("#agentFb .fetch-con").prepend('<span class="character_count">Characters remaining: 500</span>');$("#agentFb .fetch-con").prepend('<span class="error-text">Please give a valid feedback</span>')},sendFeedBack:function(event){util.doNotBubble(event);if(this.feedbackText.val()&&this.validateFeedback(this.feedbackText.val())){this.hide();setTimeout($.proxy(function(){this.pushFeedback()},this),2e3)}else{$(".fetch-con").find("textarea").addClass("error");$(".error-text").addClass("error-text").show();$(".error-text").addClass("error").show()}},textArea_onKeyPress:function(evt){util.doNotBubble(evt);if(this.value.length){$(".fetch-con").find("textarea").removeClass("error");$(".error-text").addClass("error-text").hide();$(".error-text").addClass("error").hide();if(this.value.length<=500)$(".character_count").removeClass("count_less");else{$(".character_count").addClass("count_less");this.value=this.value.substring(0,497)+"...";return false}}$(".character_count").text("Characters remaining : "+(500-this.value.length))},display:function(){this.element.show();this.transparentBg.show();this.feedbackText.focus()},hide:function(event){util.doNotBubble(event);this.feedbackText.blur();this.transparentBg.hide();this.element.hide();util.publish("/fileUpload/clearUI");return true},clear:function(){this.feedbackText.val("")},validateFeedback:function(feedbackText){return feedbackText&&feedbackText.trim()?true:false},pushFeedback:function(){if(this.feedbackText.val()){$(".character_count").text("Characters remaining : 500");util.publish("/feedback/initiate",{userFeedback:this.feedbackText.val()})}this.clear()},closeFeedback:function(){this.hide();util.publish("/fileUpload/clear")},init:function(){this.setCharCount();this.sendFeedback.click($.proxy(this.sendFeedBack,this));this.feedbackText.on("change keyup paste keypress",this.textArea_onKeyPress);this.close.click($.proxy(this.closeFeedback,this))}};util.subscribe("/fileUpload/get/inputImage",fileUpload,fileUpload.getImage);util.subscribe("/fileUpload/clear",fileUpload,fileUpload.clearFileList);util.subscribe("/fileUpload/clearUI",fileUpload,fileUpload.clearUI);util.subscribe("/fileUpload/image/read",fileUpload,fileUpload.picReader);util.subscribe("/fileUpload/xbutton",fileUpload,fileUpload.xButton);util.subscribe("/fileUpload/user/uploads/capture",fileUpload,fileUpload.fileUploadDFD);util.subscribe("module/controller/onload",fileUpload,fileUpload.init);util.subscribe("/fetch/display/gui",fetch,fetch.trigger);util.subscribe("/fetch/load",fetch,fetch.enterKeyPress);util.subscribe("/fetch/hide/gui",fetch,fetch.hide);util.subscribe("/fetch/save/recentURL",fetch,fetch.setRecentRefetch);util.subscribe("/refetch/recent",fetch,fetch.refetch);util.subscribe("module/controller/onload",fetch,fetch.init);util.subscribe("module/controller/onload",feedback,feedback.init);util.subscribe("/feedback/UI/hide",feedback,feedback.hide);util.subscribe("/feedback/display/gui",feedback,feedback.display);util.subscribe("/app/cookies/cleared",function(){FULLClient.ipc.sendToChat({name:"wipedata"})})})(util);(function(){var pref=$(".option-list #preferences"),profilePic=$("header.main-header figure"),feedback=$("#agentFb"),shortcuts=key.noConflict();if(/test|code/.test(FULLClient.getMode())){shortcuts("command+shift+l,ctrl+shift+l",function(loadEvt){util.preventEvent(loadEvt);setTimeout(function(){util.loadURL("https://my.distributedsource.com/crm#task/0532b505-d15e-45b1-b6e8-f8d3200851e6?connid=LcMjycGJG1Vxd9vumswCwEsBN1RaocTbK1462027380279AR&userpin="+userDAO.getEmail()+"&calltype=epCustom")},0);setTimeout(function(){util.loadURL("https://my.distributedsource.com/crm#task/0532b505-d15e-45b1-b6e8-f8d3200851e6?connid=U94vBIbGNvLFQBtX9ItpWhhDmoXP9OsAY1462084380816AR&userpin="+userDAO.getEmail()+"&calltype=epCustom")},1e4)})}shortcuts("command+=,ctrl+=",function(){util.zoom.zoomIn(util.zoom.getActiveTab())});shortcuts("command+o,ctrl+o",function(){util.zoom.resetZoom(util.zoom.getActiveTab())});shortcuts("command+-,ctrl+-",function(){util.zoom.zoomOut(util.zoom.getActiveTab())});shortcuts("command+w,ctrl+w",function(closeEvent){util.preventEvent(closeEvent);var id=util.tabs.getActiveTabId();util.publish("/tabLock/closeUI/decider/",{source:tabController.sources.getURLbyId(id),isForce:true,tabIndex:id})});shortcuts("command+shift+r,ctrl+shift+r",function(closeEvent){var dom=util.tabs.getActiveTab();if(dom){dom.reloadIgnoringCache(true)}});shortcuts("command+shift+t,ctrl+shift+t",function(testRunner){util.preventEvent(testRunner);if(FULLClient.getMode()=="code")FULLClient.ipc.send({eType:"open",title:"sbJasmineRunner"})});shortcuts("ctrl+tab",function(tabEvent){util.preventEvent(tabEvent);util.publish("/switch/tab/shortcut")});shortcuts("command+option+i,ctrl+shift+i",function(eDeveloperTool){util.preventEvent(eDeveloperTool);util.getCurrentWindow().openDevTools()});shortcuts("command+h",function(event){util.preventEvent(event);if(/^darwin/.test(process.platform))util.windowEvents.hide(util.window.getName())});shortcuts("command+r,ctrl+r",function(reloadEvent){util.preventEvent(reloadEvent)});shortcuts("command+f12,f12",function(closeEvent){util.publish("/fetch/display/gui")});shortcuts("command+f",function(searchEvent){util.publish("/find/in/page/show")});shortcuts("enter",function(e){util.publish("/answerphrase/close/active/ap")});shortcuts("escape",function(e){util.publish("shortcuts/keyPress/escape");if(FULLClient["canQuit"]==true){util.preventEvent(e)}else{$(".quit-popup-hold.quitApp").hide();FULLClient["canQuit"]=false}util.publish("/find/in/page/hide");if(pref.hasClass("open"))pref.removeClass("open");if(profilePic.hasClass("open"))profilePic.removeClass("open");$(".timer").hide();util.publish("/v2/logout/hide")});shortcuts("command+f8,f8",function(event){var dom=util.tabs.getActiveTab();if(dom){function PassEvent(code){this.name="_event";this.keyCode=code;this.caller=""}var f8Event=new PassEvent(event.keyCode);f8Event["caller"]="app";f8Event["ctrlKeyArg"]=false;f8Event["altKeyArg"]=false;f8Event["shiftKeyArg"]=false;f8Event["metaKeyArg"]=true;dom.send("webapp-msg",f8Event);if(event.srcElement.nodeName!="WEBVIEW")util.document.shadowRootFocus(dom);util.publish("/answerphrase/close/active/ap")}})})();(function(R,util,lodash){try{var remote=FULLClient.require("electron").remote;var dictionary=require("spellchecker");var Menu=remote.Menu;var noop=lodash.noop;var defaults=lodash.defaults;var isEmpty=lodash.isEmpty;var isFunction=lodash.isFunction;var isArray=lodash.isArray;var cloneDeep=lodash.clone;var source=null;var cEvent=null;var DEFAULT_NON_EDITABLE_TPL=[{label:"Copy",click:executor.bind(null,"copy")},{label:"Select All",click:executor.bind(null,"selectAll")}];var DEFAULT_LINK_TPL=[{label:"Open Link in New Tab",click:function(){var url=cEvent.linkURL;util.loadURL(url)}},{label:"Open Link in Browser",click:function(){var url=cEvent.linkURL;util.loadWebSiteInBrowser(url)}},{label:"Copy Link Address",click:function(){var url=cEvent.linkURL;util.copy(url)}},{type:"separator"}];var DEFAULT_SUGGESTIONS_TPL=[{label:"No suggestions",click:noop},{type:"separator"}];var DEFAULT_EDITABLE_TPL=[{label:"Undo",click:executor.bind(null,"undo")},{type:"separator"},{label:"Cut",click:executor.bind(null,"cut")},{label:"Copy",click:executor.bind(null,"copy")},{label:"Paste",click:executor.bind(null,"paste")},{label:"Paste and Match Style",click:executor.bind(null,"pasteAndMatchStyle")},{type:"separator"},{label:"Select All",click:executor.bind(null,"selectAll")}];function executor(action){var args=Array.prototype.slice.call(arguments,1);if(source&&action){source[action].apply(null,args);cEvent=source=null}}var contextMenu={setSource:function(src){if(src){return source=src}},setContextEventObj:function(cEve){if(cEve){return cEvent=cEve}},getSelection:function(cEve){if(cEve&&cEve.misspelledWord){return{isMisspelled:true,spellingSuggestions:getSuggestions(cEve.misspelledWord)}}},getSuggestions:function(word){if(word&&(word=word.toLowerCase())){return dictionary.getCorrectionsForMisspelling(word).slice(0,5)}},addContentEditable:function(mainTMP){if(/^win/.test(process.platform))DEFAULT_EDITABLE_TPL.splice(6,1);mainTMP.push.apply(mainTMP,DEFAULT_EDITABLE_TPL);return mainTMP},addSuggestions:function(mainTMP,word){var suggestions=this.getSuggestions(word);console.log("suggestions we got for word["+word+"] : ",suggestions);if(!suggestions.length){mainTMP.unshift.apply(mainTMP,DEFAULT_SUGGESTIONS_TPL);return mainTMP}mainTMP.unshift.apply(mainTMP,suggestions.map(function(suggestion){return{label:suggestion,click:executor.bind(null,"replaceMisspelling",suggestion)}}).concat({type:"separator"}));return mainTMP},addLinkOptions:function(mainTMP,url){mainTMP.push.apply(mainTMP,DEFAULT_LINK_TPL);return mainTMP},getTemplate:function(contextEvObj){var template=[];if(contextEvObj.isEditable){if(contextEvObj.misspelledWord){this.addSuggestions(template,contextEvObj.misspelledWord)}this.addContentEditable(template)}else if(contextEvObj.linkURL){this.addLinkOptions(template);template.push.apply(template,DEFAULT_NON_EDITABLE_TPL)}else{template.push.apply(template,DEFAULT_NON_EDITABLE_TPL)}return template},build:function(template){if(template)return Menu.buildFromTemplate(template)},run:function(menu){if(menu){menu.popup(remote.getCurrentWindow());return true}}};util.subscribe("/context/menu/event/",function(srcEvent,contextEvent){contextMenu.setSource(srcEvent.sender);contextMenu.setContextEventObj(contextEvent);var template=contextMenu.getTemplate(cEvent);var menu=contextMenu.build(template);contextMenu.run(menu)});module.exports=contextMenu}catch(e){console.log("Error in context-menu impl ",e.message);console.log("Error in context-menu impl ",e.stack)}})(this,util,_);(function(R,util,$){try{var apiHitReduction={threshold:3e4,lastRecievedDAIM:0,isAfk:false,canDoApiCall:function(){var isApCanRequestServer=true,currentDAIM=(new Date).getTime();if(this.isAfk){isApCanRequestServer=false}return isApCanRequestServer},afkNotifier:function(info){if(info&&info.status=="User-Away")this.isAfk=true;else{this.isAfk=false;answerPhrase.doImmediateUpdate()}},setLastInputTime:function(){this.lastRecievedDAIM=(new Date).getTime();console.log("setting last input time : "+this.lastRecievedDAIM);return true}};var sb5AP={isDemoLine:function(accountNumber){return false},content:{apObject:null},_immediateUpdate:function(){this.getRecentChangedAP()},autoUpdateApJsons:function(){this.updateBrandAndAp();setInterval(this.updateBrandAndAp.bind(this),FULLClient.getMode()=="test"?6e5:108e5);setInterval(this.getRecentChangedAP.bind(this),6e4)},getRecentChangedAP:function(){if(!apiHitReduction.canDoApiCall()){return false}else{}$.getJSON(FULLClient.getConfig().sb5+"/InitialAccountAction/getAnswerPhraseListSB5.do?isFetchRecents=true",function(response,text,xhr){if(xhr.status==200){this.setAPObj(Object.merge(this.content.apObject,response))}}.bind(this))},updateBrandAndAp:function(){var self=this;function failCallback(){setTimeout(self.updateBrandAndAp.bind(self),6e4)}$.getJSON(FULLClient.getConfig().sb5+"/InitialAccountAction/getAnswerPhraseListSB5.do",function(response,text,xhr){if(xhr.status==200){self.setAPObj(response)}}).fail(failCallback)},getAPObj:function(){return this.content.apObject},setAPObj:function(apObj){this.content.apObject=apObj},_getParsedObj:function(objString){try{if(objString){return JSON.parse(objString)}}catch(e){console.error("AP : _getParsedObj : ",e.message);console.error("AP : _getParsedObj : ",e.stack)}},getAccountInfo:function(acctNo){if(this.getAPObj&&this.getAPObj()&&parseInt(acctNo)&&acctNo in this.getAPObj()){return this._getParsedObj(this.getAPObj()[acctNo])}},getAnswerPhrase:function(acctNo){},getBrand:function(acctNo){}};var sb4AP={isDemoLine:function(accountNumber){return answerPhrase._demoLines.indexOf(accountNumber)!==-1},content:{apObject:null,brandObject:null},_immediateUpdate:function(){this.updateBrandAndAp()},autoUpdateApJsons:function(){this.updateBrandAndAp();setInterval(this.updateBrandAndAp.bind(this),6e4)},updateBrandAndAp:function(){if(!apiHitReduction.canDoApiCall()){return false}else{}var self=this;$.getJSON(FULLClient.getConfig().sb+"/InitialAccountAction/getAnswerPhraseList.do",function(response,text,xhr){if(xhr.status==200){self.setAPObj(response)}});$.getJSON(FULLClient.getConfig().sb+"/InitialAccountAction/getCacheWithKey.do?acctNum=1110000003&key=getanswerphrasebrandlist",function(response,text,xhr){if(xhr.status==200){self.setBrandObj(response)}})},getAPObj:function(){return this.content.apObject},getBrandObj:function(){return this.content.brandObject},setAPObj:function(apObj){this.content.apObject=apObj},setBrandObj:function(brandObj){this.content.brandObject=brandObj},getAnswerPhrase:function(acctNo){return this.getAPObj()[acctNo]},getBrand:function(acctNo){return this.getBrandObj()[acctNo]},getAccountInfo:function(acctNo){if(this.getAPObj&&this.getAPObj()&&parseInt(acctNo)&&acctNo in this.getAPObj()){return{answerPhrase:this.getAPObj()[acctNo],brand:this.getBrandObj()[acctNo]}}}};var answerPhrase={name:"AnswerPhraseModule",_isAPAvailable:false,tabIdmap:[],_demoLines:["8007066511","8004616705","8004617310","8004619489","8004619578","8008050816","8008352647","8004611592","8004614207","8004615165","8004617420","8007047593","8007066572","8004618540","8004612449","8004619537","8008087316","8004615398","8004617493","8007047614","8004611676","8006800906","8004612458","8004614214","8007066573","8004618597","8004612596","8007047591","8004618658","8008087751","8007047635","8004611683","8005456981","8004614237","8004618497","8004615406","8007066604","8004618659","8004614259","8007047636","8007047643","8004612413","8004614359","8005457026","8004614250","8004618512","8004616486","8008088543","8007066609","8004612435","8007047641","8004614784","8006800797","8004618523","8004615502","8004614354","8004616508","8006352757","8008088612","8007066615","8004614425","8004616495","8004618524","8004616539","8004610376","8006352780","8004612497","8004618678","8006800904","8007047684","8004614706","8007066617","8004612597","8004618552","8006800910","8004610485","8007066618","8007095720","8004617250","8008038489","8008038490","8008038514","8008038516","8008038529","8008038532","8008038533","8008352608","8008352718","8008352909","8008353022","8008353430","8008391943","8008392012","8008392169","8008392197","8008392252","8006352720","8004612183","8004612417","8773257467","8773257468","8773257480","8773257488","8773257495","8773257496","8773257497","8773257498","8773257499","8773257763","8773257785","8773258200","8773258711","8773258981","8773259051","8773259052","8773259055","8773259056","8773259060","8773259063","8773259064","8773259065","8773259070","8773259073","8773259742","8773261118","8773261123","8773261142","8773261919","8773265164","8773265367","8773265371","8773265607","8773265961","8773267997","8773267998","8773268102","8773269238","8773269321","8773271035","8773271271","8773271601","8773271602","8773271606","8773271607","8773271750","8773271981","8773272107","8773272242","8773272246","8773272285","8773272483","8773273082","8773273292","8773273937","8773275427","8773275687","8773276074","8773276078","8773276079","8773276080","8773276081","8773276085","8773276270","8773276637","8773276966","8773277162","8773278001","8773278408","8773278409","8773278693","8773278842","8773279172","8773279682","8773280314","8773281194","8773281286","8773281357","8773281416","8773281886","8773282321","8773282399","8773282475","8773282826","8773283207","8773283285","8773285258","8773286354","8773287453","8773288576","8773289801","8773290433","8773290598","8773290615","8773291275","8773291279","8773299571","8773299576","8773299969","8773299970"],_getService:function(){return sb5AP},getAccountInfo:function(no){return this._getService().getAccountInfo(no)},isDemoLine:function(no){return this._getService().isDemoLine(no)},dom:{container:$("#answer_phrase_popup"),contentDiv:$("#answer_phrase_popup").children(".answer_phrase_content"),apValue:$("#answer_phrase_popup").find("#answer_phrase_val"),closeButton:$("#answer_phrase_popup").find(".close_btn")},log:function(){util.log.apply(this,arguments)},isLocalAPClosed:function(tabId){return tabId&&this.tabIdmap.indexOf(tabId)!==-1?true:false},setLocalApClosedForTab:function(tabId){if(tabId&&this.tabIdmap.indexOf(tabId)==-1){this.tabIdmap.push(tabId);return true}},getContainer:function(){return this.dom.container},getContentDiv:function(){return this.dom.contentDiv},getAPValDiv:function(){return this.dom.apValue},getCloseButton:function(){return this.dom.closeButton},getApAvailability:function(accountNumber){return accountNumber&&util.isNumber(accountNumber)&&this.getAccountInfo(accountNumber)&&!this.isDemoLine(accountNumber)?this.getAccountInfo(accountNumber):false},paintContainer:function(brand){var _child,_element=this.getContainer().get(0);_child=this.getContentDiv().get(0);if(_element){_child=_child?_child:_element.children[0];switch(brand){case"LexReception":{_element.setAttribute("style","top:30%;background: #3989b8 url(http://images.sb.a-cti.com/images/lex-greeting-badge.png) center no-repeat;background-position: center bottom;padding-bottom: 50px;");_child?_child.setAttribute("style","background:#3499d5;filter:alpha(opacity = 100);-moz-opacity:1.0;opacity:1.0;border:none;padding:2px 15px;border-radius: 4px 4px 0px 0px;"):false;break}default:{_element.setAttribute("style","top:30%;background: #474747 center no-repeat;background-position: center bottom;padding-bottom: 20px;");_child?_child.setAttribute("style","background:#474747;filter:alpha(opacity = 100);-moz-opacity:1.0;opacity:1.0;border:none;padding:2px 15px;border-radius: 4px 4px 0px 0px;"):false;break}}}},rePaintBasedOnBrand:function(url){var brand,local_answer_phrase,__req,acctNum,ani=false;var __req=util.getParameters(url);var acctNum=__req.acctNum||__req.accountNumber;var ani=__req.IncomingANI||__req.incomingANI;var accountInfo=this.getAccountInfo(acctNum);var isApFlag=__req.apavailable;if(isApFlag&&isApFlag=="false"){this.hide();return}if(acctNum&&!this.isDemoLine(acctNum)&&accountInfo){brand=accountInfo.brand;brand=brand?brand.trim():"Voicecurve";local_answer_phrase=accountInfo.answerPhrase;local_answer_phrase=local_answer_phrase?local_answer_phrase.trim():false;switch(brand){case"LexReception":{this.paintContainer("LexReception");break}case"Synclio":{this.paintContainer("Voicecurve");if(ani&&this.getAccountInfo(ani)){local_answer_phrase=this.getAccountInfo(ani).answerPhrase}break}default:{this.paintContainer("Voicecurve");break}}if(local_answer_phrase&&!(local_answer_phrase.trim().indexOf("Message System Templates")!==-1)){this.show(local_answer_phrase)}else{this.log("AnswerPhrase not Available for Params ",__req);this.hide()}}},show:function(phrase){this.getAPValDiv().html(phrase);this.getContainer().show()},hide:function(){this.getContainer().hide()},init:function(){this.log("init");this._getService().autoUpdateApJsons();this.getCloseButton().click($.proxy(this.apUIclose,this))},doImmediateUpdate:function(){this._getService()._immediateUpdate()},apUIclose:function(evt){this.hide();this.setLocalApClosedForTab(util.tabs.getActiveTabId())},computeAPforTab:function(tabId){if(tabId&&util.isNumber(tabId)&&!this.isLocalAPClosed(tabId)&&util.tabs.getTabById(tabId)){this.rePaintBasedOnBrand(util.tabs.getTabById(tabId).src)}else{this.hide()}}};answerPhrase.init();util.subscribe("/answerphrase/compute",answerPhrase,answerPhrase.computeAPforTab);util.subscribe("/answerphrase/close/active/ap",answerPhrase,answerPhrase.apUIclose);util.subscribe("/api/hit/detection/trial/",apiHitReduction,apiHitReduction.setLastInputTime);util.subscribe("/module/afk/notify",apiHitReduction,apiHitReduction.afkNotifier);util.answerPhrase={isAPavailable:function(){return answerPhrase.getApAvailability.apply(answerPhrase,arguments)}}}catch(AnswerPhraseException){console.error("Exception in AnswerPhrase routine",AnswerPhraseException);console.error("Exception in AnswerPhrase routine",AnswerPhraseException.stack)}module.exports.sb5AP=sb5AP;module.exports.answerPhrase=answerPhrase;module.exports.sb4AP=sb4AP})(this,util,jQuery);(function(R,util){var restart={getScriptName:function(){var scriptname;switch(FULLClient.getAppName().toLowerCase()){case"fullclient-electron.exe":{scriptname="fc.bat";break}case"anywhereworks.exe":{scriptname="aww.bat";break}case"anywhere works.exe":{scriptname="awwspaced.bat";break}case"aww-v2.exe":{scriptname="aww-v2.bat";break}default:{scriptname="aww.bat";break}}return scriptname},quitApp:function(){util.publish("/app/restore/removeAll","tabs");var child=require("child_process").exec,path=require("path");if(/^win/.test(process.platform)){var quietTool=path.resolve(process.resourcesPath,"app","tools","Quiet.exe");var scriptPath=path.resolve(process.resourcesPath,"app","scripts",this.getScriptName());child('START " "  "'+quietTool+'"  "'+scriptPath+'"',function(err){if(err)console.log("Error in restart"+err)})}else if(/^darwin/.test(process.platform)){var applicationPath,endIndex=process.resourcesPath.indexOf("/Contents");var appName=namespace.APP_ID=="FULL"?"FULLClient-Electron":FULLClient.getAppName();var scriptPath=path.resolve(process.resourcesPath,"app","scripts","restart.sh");applicationPath=process.resourcesPath.substring(0,endIndex);appName=util.escapeSpaces(appName);scriptPath=util.escapeSpaces(scriptPath);applicationPath=util.escapeSpaces(applicationPath);console.log("ApplicationPath to START : "+applicationPath);var daemon=child("sh "+scriptPath+" "+process.pid+" "+applicationPath+" "+appName,function(err,stdout,stderr){if(err){console.log(err)}console.debug("STDOUT :",stdout);console.warn("STDERR : ",stderr)})}},initiate:function(){this.quitApp()}};util.subscribe("/app/restart/commence",restart,restart.initiate)})(this,util);(function(){try{var appQuit={canQuit:null,_v2Dfd:null,previousStatus:null,transparentBg:$(".black-screen"),getV2Dfd:function(){return this._v2Dfd},checkStatus:function(status){if(status&&status=="Offline"&&this.canQuit){this._mannuallyResolveDFD()}else{this.previousStatus=status}},_mannuallyResolveDFD:function(){this.getV2Dfd()?this.getV2Dfd().resolveWith(appQuit,["offline to V2 success"]):false},sendOfflineToV2:function(){this.removeButtons();var dfd=$.Deferred();this._v2Dfd=dfd;if(!this.previousStatus||this.previousStatus=="Offline"){this._mannuallyResolveDFD()}else{console.log("Pushing V2 to offline");util.publish("/status/UIController/manual/status/change","Offline")}setTimeout(function(){dfd.resolveWith(appQuit,["Threshold for ofline v2 kicked in !!"])},3e3);return dfd},appQuitTypetoAnalytics:function(){if(!Locstor.get("AppQuitType")&&Locstor.get("lastAppLaunchDAIM")){util.analytics.push(null,analytics.APP_ABNORMAL_QUIT,null,"Fullclient Abnormal close")}Locstor.set("lastAppLaunchDAIM",new Date);Locstor.remove("AppQuitType")},waitThenQuit:function(){util.analytics.push(null,analytics.APP_CLOSED,null,"FULLClient Application is quiting");util.publish("/app/restore/removeAll","tabs");function logAndKill(){console.log("Posting message to quit timerWidget:");util.publish("/timer/hwnd/destroy");$("webview").remove();FULLClient.ipc.send({eType:"appQuit",name:"appQuit"});Locstor.set("AppQuitType","normal");window.close()}try{$.when(this.getV2Dfd()).done(function(value1){console.debug("Deferred were success, while quitting");logAndKill()}).fail(function(value1){console.debug("Deferred failed, timeout kicked in, while quitting");logAndKill()})}catch(e){console.log("Fatal error :: ",e.message);console.log("Fatal error :: ",e.stack);Locstor.set("AppQuitType","normal");setTimeout(window.close,0)}},quitV2:function(){},hideChatWindow:function(){},closeAppServer:function(){util.publish("serverModule/stop")},showQuitPopup:function(){var isActiveCallTab=false;if(util.tabs.getActiveTab()){var activeTabs=util.tabs.getAllTabs();for(var i=0;i<activeTabs.length;i++){var params=util.getParameters(activeTabs[i].src);if(!util.isFetch(params)){isActiveCallTab=true;var tabIndex=util.getParameterByName("currentTabIndex",activeTabs[i].src);$("#"+tabIndex).trigger("click");break}}}util.publish("/tabLock/closeUI/hideUI/");if(isActiveCallTab){FULLClient["canQuit"]=false;util.publish("/util/window/events/show",namespace.CONTAINER_SB);this.showTransparentBG();$(".quit-popup-wrapper").show();$(".quit_btn").focus()}else{this.start()}},setListeners:function(){$("body").on("click",".quit-popup-wrapper a.cancel_btn",function(event){util.publish("/app/quit/cancel");FULLClient["canQuit"]=false});$("body").on("click",".quit-popup-wrapper a.quit_btn",function(event){FULLClient["canQuit"]=true;var label='<label><img src="http://images.sb.a-cti.com/TC/node-webkit/webview/v0.2.1/images/spinner.gif"></label>';$(".quit-popup-wrapper").prepend(label);util.publish("/app/quit/commence")});$(".quit_btn").on("focus",function(){this.highlightQuitBtn()}.bind(this)).on("blur",function(){this.blurQuitBtn()}.bind(this))},blurQuitBtn:function(){$(".quit_btn").css("opacity","")},highlightQuitBtn:function(){$(".quit_btn").css("opacity","1")},highlightCancelBtn:function(){$(".cancel_btn").css("opacity","1")},isPopUpShown:function(){return $(".quit-popup-wrapper").is(":visible")},hideQuitPopup:function(){if(this.isPopUpShown()){$(".quit-popup-wrapper").hide();this.hideTransparentBG()}},showTransparentBG:function(){this.transparentBg.show()},hideTransparentBG:function(){this.transparentBg.hide()},removeButtons:function(){var quitDomCache=$(".quit-popup-wrapper");var str="Saving the background process. Please wait for a moment.";quitDomCache.find("p").text(str);quitDomCache.find("a.quit_btn").hide();quitDomCache.find("a.cancel_btn").hide();if(!quitDomCache.is(":visible"))quitDomCache.parent().show()},cancelQuit:function(){this.hideQuitPopup()},start:function(){console.log("app quitting started");this.canQuit=true;Locstor.set("v2",Object.assign(Locstor.get("v2")||{},{loggedIn:false}));this.sendOfflineToV2();this.waitThenQuit();util.unsubscribe("/app/quit/commence",appQuit,appQuit.start)}};util.subscribe("shortcuts/keyPress/escape",appQuit,appQuit.hideQuitPopup);util.subscribe("module/controller/onload",appQuit,appQuit.setListeners);util.subscribe("/app/quit/offline/check",appQuit,appQuit.checkStatus);util.subscribe("/app/quit/commence",appQuit,appQuit.start);util.subscribe("/app/quit/popup",appQuit,appQuit.showQuitPopup);util.subscribe("/app/quit/cancel",appQuit,appQuit.cancelQuit);util.subscribe("/app/quit/remove/buttons",appQuit,appQuit.removeButtons);util.subscribe("app/quit/AppQuitTypetoAnalytics/",appQuit,appQuit.appQuitTypetoAnalytics)}catch(e){console.error("Exception while sbContainer window closing : ",e);process.kill(process.pid)}})();(function(R,M){var self=awayfromkey={module:function(){var _tmp;try{_tmp=require("afk")}catch(e){console.error("While getting AFK module , ::: ",e.stack);_tmp=false}return _tmp}(),idleTimeout:60,previous_status:undefined,afk_Listener_id:undefined,afk_Listener:function(e){switch(e.status){case"away":{console.debug("AFK User-Away !!! ");amplify.publish("/module/afk/notify",{status:"User-Away",source:"afk"});var afk=new Thinclient("afk");afk[afk.opt]["status"]="User-Away";FULLClient.ipc.sendToChat(afk);break}case"back":{console.debug("AFK Back !!! ");amplify.publish("/module/afk/notify",{status:"User-Back",source:"afk"});var afk=new Thinclient("afk");afk[afk.opt]["status"]="User-Back";FULLClient.ipc.sendToChat(afk);break}}},initModule:function(){if(this.module&&userDAO.getSkillByName("FullWork")){this.afk_Listener_id=this.module.addListener(this.idleTimeout,this.afk_Listener);console.debug("Starting the AFK module id : "+this.afk_Listener_id)}},terminate:function(){if(this.module&&typeof this.afk_Listener_id!=="undefined"){console.debug("Removing module afk :::"+this.afk_Listener_id);this.module.removeListener(this.afk_Listener_id);this.afk_Listener_id=undefined}}};M.subscribe("module/controller/onload",self,self.initModule);M.subscribe("/afk/controller/stop",self,self.terminate)})(this,amplify);(function(R,util,undefined){var feedbackDB=localDB.createDB("feedbackDB",1);feedbackDB.setStoreObject({feedbackStore:"id",clientLogStore:"++id,parentId",imageStore:"++id,parentId"});localDB.register(feedbackDB);localDB.createDBInstance(feedbackDB.name,"feedbackStore");function FeedbackFD(user,uniqueId,arrayOfLogs,arrayOfImages,arrayOfFb,mailsubject){this.id=uniqueId;this.form_data=new FormData;this.setLogs(arrayOfLogs);this.setImages(arrayOfImages);this.setText(arrayOfFb);this.form_data.append("t",(new Date).getTime());this.form_data.append("tag","suggestion");this.form_data.append("user_tag","Electron");var htmlObj={html_template:"NA",html_template_subject:mailsubject};console.log("Feedback loop key : "+this.getLoopKey(mailsubject));this.form_data.append("custom_html_info",JSON.stringify(htmlObj));this.form_data.append("loopKey",this.getLoopKey(mailsubject));this.form_data.append("user_name",user?user.fullname:"Unable To get UserInfo");this.form_data.append("user_email",user?user.email:"Unable To get UserInfo")}FeedbackFD.prototype={constructor:FeedbackFD,setLogs:function(arrayOfLogs){var _blob;for(var i=arrayOfLogs.length-1;i>=0;i--){if(arrayOfLogs[i]){_blob=new Blob([arrayOfLogs[i].value],{type:"text/html"});console.warn("appending Logs arrayOfLogs["+i+"]:"+arrayOfLogs[i].host);this.form_data.append("feedbackAttachment",_blob,arrayOfLogs[i].host)}}_blob=null},getLoopKey:function(subject){console.log("Subject line ",subject);if(/AnywhereWorks/gi.test(subject)){this["for"]="AnywhereWorks";return FULLClient.getConfig().chatLoop}return FULLClient.getConfig().loop},setImages:function(arrayOfImages){for(var i=arrayOfImages.length-1;i>=0;i--){if(arrayOfImages[i]){ImageService.appendToFeedback(arrayOfImages[i],this.form_data)}}},setText:function(arrayOfFb){if(arrayOfFb[0]){this.form_data.append("card_title",arrayOfFb[0].feedback);console.warn("Feedback Appended!",arrayOfFb[0].feedback)}}};function UserFeedback(feedbackMessage){this.id=uuid.v4((new Date).getTime());this.feedback=feedbackMessage||"Auto Generated Feedback ";this.logs={};this.images={};this.save();this.publish()}UserFeedback.prototype={save:function(obj){saveService.storeById(obj||this)},publish:function(){this.captureLogs.apply(this,this.captureImages())},captureImages:function(){var dfdV2=$.Deferred();ImageService.getScreen({id:this.id,title:namespace.CONTAINER_V2,deferred:dfdV2});var dfdSB=$.Deferred();ImageService.getScreen({id:this.id,title:namespace.CONTAINER_SB,deferred:dfdSB});var dfdChat=$.Deferred();if(userDAO.getSkillByName("FullWork")){dfdChat.resolve("Stopping Chat Screen Capture.")}else{dfdChat.resolve("Not needed")}var dfdFeedbackFileUpload=$.Deferred();util.publish("/fileUpload/user/uploads/capture",{id:this.id,deferred:dfdFeedbackFileUpload});return[dfdSB.promise(),dfdV2.promise(),dfdChat.promise(),dfdFeedbackFileUpload.promise()]},captureLogs:function(sbImagePromise,v2ImagePromise,chatImagePromise,userUploadPromise){kDebug.getLogs(this.id,function(logObj){var appLogsDfd=$.Deferred();saveService.saveLogsById(logObj,appLogsDfd);stateService.chainPromises(logObj.parentId,[appLogsDfd.promise(),sbImagePromise,v2ImagePromise,chatImagePromise,userUploadPromise,iFramesLogs.sendLogCaptureSingal(this.id)])},this)}};var ImageService={getScreen:function(feedbackObj){var container=util.caching.windows.getTarget(feedbackObj.title);return container?this.getSnap(container,feedbackObj):feedbackObj.deferred.resolve("container not available")},getSnap:function(container,feedbackObj){container.capturePage(function(image){ImageService.isImageValid(image,feedbackObj)})},getImageBlob:function(file){var _blob=new Blob([file],{type:"image/png"});return _blob},appendToFeedback:function(imgObj,formData){var type=imgObj.img.type&&imgObj.img.type.indexOf("image")==-1?"_File":"_image";var name=imgObj.frame+type;formData.append("feedbackAttachment",imgObj.img,name)},isImageValid:function(image,feedbackObj){if(!image.isEmpty()){amplify.publish("/feedback/setImage",new ImageCapture(feedbackObj.title,this.getImageBlob(image.toPng()),feedbackObj.id),feedbackObj.deferred)}else{feedbackObj.deferred.resolve("Failed to Capture ",feedbackObj.title," Image");amplify.publish("/feedback/setImage",new ImageCapture(feedbackObj.title,"Failed",feedbackObj.id),feedbackObj.deferred)}}};util.subscribe("container/imageCapture",ImageService.getScreen);var stateService={chainPromises:function(uniqueId,promiseArray){$.when.apply($,promiseArray).pipe(function piping(containerLogResponse,sbImageSaveResponse,v2ImageSaveResponse,chatImageSaveResponse,UploadSaveResponse){console.log("[Feedback] chain promises pipe ");util.publish("/fileUpload/clear");return containerLogResponse.parentId}).done(function success(feedbackId){util.publish("/fileUpload/clear");console.log("[Feedback] chain promises done ");collectorService.collectForId(feedbackId)}).fail(function failed(logId,feedbackId,err){console.error("FeedbackCollector Deferred Error :",arguments)})}};var saveService={save:function(storename,jsObject,successCB,failCB){if(typeof jsObject=="object"){localDB.getDBinstance("feedbackDB")[storename].put(jsObject).then(successCB||function(){}).catch(failCB||function(err){}).finally(function(){})}},saveLogsById:function(logObj,deferred){this.save("clientLogStore",logObj,function success(){if(deferred){deferred.resolve(logObj)}else{iFramesLogs.stateMap.logsRecievedForAck(logObj.parentId)}},function fail(err){if(deferred){deferred.reject(err)}})},saveImagesById:function(imgObj,deferred){this.save("imageStore",imgObj,function done(){if(deferred){deferred.resolve(imgObj)}},function fail(err){if(deferred){deferred.reject(err)}})},storeById:function(storeFbRecord){this.save("feedbackStore",storeFbRecord)}};var queryService={queryById:function(storeName,uniqueId,keyPath,successCB,failureCB,context){localDB.getDBinstance("feedbackDB")[storeName].where(keyPath).equals(uniqueId).toArray(function(arrayOfRows){successCB(context,arrayOfRows)}).catch(function(err){failureCB(context,[err])}).finally(function(){})},getLogById:function(uniqueId,callback,context){var dfd=$.Deferred();this.queryById("clientLogStore",uniqueId,"parentId",dfd.resolveWith,dfd.rejectWith,context);return dfd.promise()},getImageById:function(uniqueId,callback,context){var dfd=$.Deferred();this.queryById("imageStore",uniqueId,"parentId",dfd.resolveWith,dfd.rejectWith,context);return dfd.promise()},getFeedbackById:function(uniqueId,callback,context){var dfd=$.Deferred();this.queryById("feedbackStore",uniqueId,"id",dfd.resolveWith,dfd.rejectWith,context);return dfd.promise()}};var cleanService={cleanById:function(storeName,uniqueId,keyPath,callback){localDB.getDBinstance("feedbackDB")[storeName].where(keyPath).equals(uniqueId).delete(callback||function(){}).catch(function(err){}).finally(function(){})},cleanLogById:function(uniqueId,callback){this.cleanById("clientLogStore",uniqueId,"parentId",callback)},cleanImageById:function(uniqueId,callback){this.cleanById("imageStore",uniqueId,"parentId",callback)},cleanFeedbackById:function(uniqueId,callback){this.cleanById("feedbackStore",uniqueId,"id",callback)},clean:function(uniqueId,callback){this.cleanLogById(uniqueId,callback);this.cleanImageById(uniqueId,callback);this.cleanFeedbackById(uniqueId,callback);collectorService.clean(uniqueId)},clientDB:function(){console.log("[Feedback][cleanService][clientDB]");try{var activeTab=util.tabs.getActiveTab();var clearLogs=new LogACK("clearLogs");kDebug.clearLogs();document.querySelector("#"+logsCollectionService.id.processReduce).send("webapp-msg",clearLogs);if(activeTab){activeTab.send("webapp-msg",clearLogs)}}catch(e){console.log("clientDB ",e.message);console.log("clientDB ",e.stack)}}};var collectorService={isFromChatModule:null,token:null,collectForId:function(uniqueId){if(!uniqueId)throw new Error("CollectorServiceFailure:: query ::uniqueId not valid "+uniqueId);console.log("Collection Service :: Started :: id["+uniqueId+"]");$.when(queryService.getLogById(uniqueId,null,this),queryService.getImageById(uniqueId,null,this),queryService.getFeedbackById(uniqueId,null,this)).pipe(function(logArray,imageArray,feedbackArray){logArray=jQuery.makeArray(logArray);imageArray=jQuery.makeArray(imageArray);feedbackArray=jQuery.makeArray(feedbackArray);var mailsubject;if(this.isFromChatModule)mailsubject="AnywhereWorks ";else mailsubject="FULLClient ";mailsubject+=userDAO.getUser().fullName;console.log("[Feedback][collectorService] pipe ");return updateCardInfoAndSend(new FeedbackFD(userDAO.getUser(),uniqueId,logArray,imageArray,feedbackArray,mailsubject))}.bind(this)).done(function(r){console.log("[Feedback][collectorService] done ");console.log("Cleaning Service :: Started :: id["+uniqueId+"]");cleanService.clientDB(uniqueId)})},initiateUserFeedback:function(userFBObj){if(userFBObj){if(userFBObj.isFromChatModule){this.isFromChatModule=userFBObj.isFromChatModule}else{this.isFromChatModule=false}new UserFeedback(userFBObj.userFeedback)}},clean:function(id){if(!id)throw new Error("CollectorServiceFailure:: clean ::uniqueId not valid "+id);console.check("Cleaning Success for, data in memory for id["+id+"]")}};var iFramesLogs={originMap:{},tabMap:{},gotTabCloseSingal:function(tabId){if(tabId&&this.tabMap[tabId]){var feedbackId=this.tabMap[tabId];var dfd=this.stateMap.getDefer(feedbackId);console.log("Resolving Deferred for tabId["+tabId+"]");dfd?dfd.resolve("tabclose_"+tabId):false}},stateMap:{setMap:function(id){this[id]={total:0,received:0}},incrementAckTotal:function(id){this[id].total++},getDefer:function(id){return this[id].defer},logsRecievedForAck:function(id){this.incrementReceived(id)},incrementReceived:function(id){if(++this[id].received>=this[id].total){this.getDefer(id).resolve(id)}},instantiateDefer:function(id){var ackDefer=$.Deferred();var self=this;setTimeout(function(){console.log("Resolving feedback from timeout id["+id+"], total = "+self[id].total+", recieved = "+self[id].received);ackDefer.resolve(id)},5e3);this[id].defer=ackDefer;return ackDefer}},sendLogCaptureSingal:function(id){var tabId=util.tabs.getActiveTabId();this.stateMap.setMap(id);if(userDAO.getSkillByName("FullWork")){logsCollectionService.getChatLogs(id)}logsCollectionService.getWebFormLogs(id);logsCollectionService.getV2Logs(id);logsCollectionService.getLogs(id);return this.stateMap.instantiateDefer(id)},isChildFrameExists:function(doc){return doc?doc.querySelectorAll("iframe"):[]},postMessage:function(winObject,id){if(winObject){winObject.postMessage(new LogsAck(id),"*");return true}}};var logsCollectionService={view:null,id:{processReduce:"processReduce"},getView:function(id){return id?document.getElementById(id):false},frameTemplate:function(uniqueId){return uniqueId?new LogsAck(uniqueId):false},postMessage:function(webDom,uniqueId){var template=this.frameTemplate(uniqueId);return webDom&&template?webDom.send("webapp-msg",template):false},getChatLogs:function(uniqueId){var template=this.frameTemplate(uniqueId);return template?FULLClient.ipc.sendToChat(template):false},getV2Logs:function(uniqueId){var template=this.frameTemplate(uniqueId);return template?FULLClient.ipc.sendToV2(template):false},getSynclioLogs:function(uniqueId){var dom=this.getView(this.id.synclio);return dom&&uniqueId?this.postMessage(dom,uniqueId):false},getWebFormLogs:function(uniqueId){var dom=util.tabs.getActiveTab();if(dom){var tabIndex=util.getParameterByName("currentTabIndex",dom.src);iFramesLogs.tabMap[tabIndex]=uniqueId}return dom&&uniqueId&&dom.src&&dom.src.indexOf(FULLClient.getConfig().sb5)==-1?this.postMessage(dom,uniqueId):false},getLogs:function(uniqueId){var dom=this.getView(this.id.processReduce);return dom&&uniqueId?this.postMessage(dom,uniqueId):false},embed:function(obj){var web=new WebviewProxy(obj.id,obj.url);web.setHidden();document.body.appendChild(web.getView());web.setContentloaded(function(){web.setHidden();util.publish("/process/reduce/embed/log/urls");util.publish("/maxtabcounter/checkAnalyticsTabInfo")})},embedLogCollector:function(){this.embed({url:"http://images.sb.a-cti.com/TC/processReduction.html",id:"processReduce"});unsentFeedback.clear()}};var unsentFeedback={retentionLimit:1,getVersion:function(string){return/([0-9]{0,}\.[0-9]{0,})/.exec(string)[0]},isSendable:function(){var localVersion=this.getVersion(FULLClient.getManifest().main);if(compareVersions(localVersion,"2.17.0")==1){return true}},query:function(){console.log("[Feedback][unsentFeedback][query]");localDB.getDBinstance("feedbackDB")["feedbackStore"].reverse().limit(this.retentionLimit).each(function(feedbackObject){var feedbackId=feedbackObject.id;console.log("[Feedback][unsentFeedback][query][feedbackId="+feedbackId+"]");setTimeout(function(){collectorService.collectForId(feedbackId)},0)})},clear:function(){if(!this.isSendable()){localDB.getDBinstance("feedbackDB")["feedbackStore"].each(function(feedbackObject){var feedbackId=feedbackObject.id;console.log("[Feedback][unsentFeedback][clear][feedbackId="+feedbackId+"]");setTimeout(function(){cleanService.clean(feedbackId)},0)}).finally(function clearFinal(){console.log("[Feedback][unsentFeedback][clear][finally method called]")})}else{console.log("[Feedback][unsentFeedback][clear][query to send unsent feedbacks]");unsentFeedback.query()}}};function sendFeedback(uploadInfo){var title=uploadInfo.FormData.get("card_title").substring(0,10);var analyticsInfo=title+" "+FULLClient.getMode()+" "+FULLClient.getManifest().version;console.log("[Feedback][sendFeedback][uniqueId = ["+uploadInfo.uniqueId+"] = "+title+"]");return $.ajax({url:uploadInfo.url,type:"POST",processData:false,contentType:false,enctype:"multipart/form-data",data:uploadInfo.FormData,headers:{Authorization:"Bearer "+(collectorService.token||userDAO.getAccessToken())}}).done(function(r){console.log("[Feedback][sendFeedback][success][uniqueId = ["+uploadInfo.uniqueId+"] = "+title+"]");util.analytics.push(null,analytics.FEEDBACK_SUCCESS,analyticsInfo,"Feedback sent");cleanService.clean(uploadInfo.uniqueId);return"sent"}).fail(function(r){console.debug("[Feedback][sendFeedback][failed][uniqueId = ["+uploadInfo.uniqueId+"] = "+title+"]");util.analytics.push(null,analytics.FEEDBACK_FAILED,analyticsInfo,"Feedback failed");setTimeout(sendFeedback,3e5,uploadInfo);return"re-sending"})}function updateCardInfoAndSend(feedbackObj){if(!/AnywhereWorks/i.test(feedbackObj["for"])){console.log("[Feedback][updateCardInfoAndSend] Chat Feedback ");feedbackObj.form_data.append("dept_id",FULLClient.getConfig().dcmApi.dept_id);feedbackObj.form_data.append("dept",FULLClient.getConfig().dcmApi.dept);feedbackObj.form_data.append("task_type",FULLClient.getConfig().dcmApi.task_type);feedbackObj.form_data.append("brand_id",FULLClient.getConfig().dcmApi.brand_id)}return sendFeedback({url:FULLClient.getConfig().feedback.chat,FormData:feedbackObj.form_data,uniqueId:feedbackObj.id})}util.subscribe("/feedback/setImage",UserFeedback.prototype,function(imgObj,deferred){saveService.saveImagesById(imgObj,deferred)});util.subscribe("/feedback/setLogs",UserFeedback.prototype,function(logsObj){console.check("LogsRecieved["+logsObj.host+"] = "+logsObj.parentId);saveService.saveLogsById(logsObj)});util.subscribe("/feedback/gotACK",UserFeedback.prototype,function(logsObj){console.check("ACK["+logsObj.host+"] = "+logsObj.id);iFramesLogs.stateMap.incrementAckTotal(logsObj.id)});util.subscribe("/feedback/initiate",collectorService,collectorService.initiateUserFeedback);util.subscribe("/tabkeeper/close",iFramesLogs,iFramesLogs.gotTabCloseSingal);util.subscribe("module/controller/onload",logsCollectionService,logsCollectionService.embedLogCollector)})(this,util);(function(R,util){var url=FULLClient.require("url");var http=FULLClient.require("http");try{$.get("http://localhost:7056/isAppUp.do?check=true&value={%22test%22:%22value%22}").done(function(){console.error("HTTPPort 7056 Active, We cannot bind onemore time..")}).fail(function(){serverModule.log("serverModule Started");serverModule.startIncomingPort()});var serverModule={instance:null,port:7056,name:"serverModule",log:function(){util.log.apply(this,arguments)},isValid:function(msg){return msg&&typeof msg=="object"?msg:false},isIPCMessagingAvailable:function(params){return R["FULLClient"]&&FULLClient.ipc&&this.isValid(params)?true:false},sendResponse:function(value,res){res.writeHead(200,{"Access-Control-Allow-Origin":"*"});res.end(value)},startIncomingPort:function(){console.warn("Inside startIncomingPort.js");this.instance=http.createServer(function(req,res){var queryObject=url.parse(req.url,true);if(queryObject.query["controller"]){console.warn("url via 127.0.0.1:7056 :: "+req.url);console.log(queryObject.query["controller"],queryObject.query)}this.router(queryObject.query["controller"]||queryObject.query["state"],queryObject.query,res)}.bind(this));this.instance.listen(serverModule.port,function(err,info){console.warn("Server started at 7056...!");if(err)console.warn("Error in Starting server for 7056:")})},stop:function(){this.log("Stoping server in serverModule:");return this.instance?this.instance.close():false},router:function(controller,params,res){var parsedObj;try{parsedObj=/(JSON)/.test(controller)?JSON.parse(params.value):{}}catch(e){console.error("Error in parsing block of Server : "+e.message);console.error("Error in parsing block of Server : ",e.stack);res.writeHead(200,{"Access-Control-Allow-Origin":"*"});res.end("JSON Parsing Error : "+e.message);return}switch(controller){case"msg-to-V2":{if(this.isIPCMessagingAvailable(params))FULLClient.ipc.sendToV2(params);this.sendResponse("Message sent sucessfully to V2.",res);break}case"msg-to-CHAT":{if(this.isIPCMessagingAvailable(params))FULLClient.ipc.sendToChat(params);this.sendResponse("Message sent Sucessfully to Chat.",res);break}case"msg-to-FULL":{if(this.isIPCMessagingAvailable(params))FULLClient.ipc.sendToSB(params);this.sendResponse("Message sent Sucessfully to SB/Full.",res);break}case"oAuth":{this.sendResponse("Oauth request "+JSON.stringify(params),res);break}case"close":{var tabIndexToClose=params["value"];var statusToPush=params["status"];util.publish("/status/UIController/manual/status/change",params["status"]);if(tabIndexToClose==="current")util.publish("/tab/controller/close/active");else util.publish("/tab/controller/close/tab/",{source:"HTTPServerModule",isForce:false,tabIndex:tabIndexToClose});this.sendResponse("status updation in progress.",res);break}case"updateStatus":{this.log('"case:updateStatus" Http Port 7056 recieved : '+params["value"]);util.publish("/status/UIController/manual/status/change",params["value"]);this.sendResponse("status updation in progress.",res);break}case"dial":{util.publish("/util/v2/dialNumber",params["value"]);this.sendResponse("Dial out done for.",res);break}case"closeJSON":{util.publish("/status/UIController/manual/status/change",params["status"],parsedObj.originalEvent);util.publish("/tab/controller/close/tab/",{source:parsedObj.source,isForce:false,tabIndex:parsedObj.tabIndex});this.sendResponse("tab close",res);break}case"updateStatusJSON":{util.publish("/status/UIController/manual/status/change",parsedObj["status"].pushStatus,parsedObj.originalEvent);this.sendResponse("status updation in progress.",res);break}case"dialJSON":{util.publish("/util/v2/dialNumber",params["value"]);this.sendResponse("Dial out done for.",res);break}case"loadURL":{util.loadURL(params["url"]);util.windowEvents.show(namespace.CONTAINER_SB);this.sendResponse("URL["+params["url"]+"] loaded in tab, successfully",res);break}default:{this.sendResponse("default response executed.",res);break}}}};R["serverModule"]=serverModule;util.subscribe("serverModule/stop",serverModule,serverModule.stop)}catch(serverModuleExcep){console.error("Exception in serverModule.js ",serverModuleExcep);console.error("Exception in serverModule.js ",serverModuleExcep.stack)}module.exports=serverModule})(this,util);(function(R,M){var fs=require("fs");var child=require("child_process").exec;var writePermissionChecker={dom:{updateFailedPopup:$("#updateFailedPopup"),close:$("#updateFailedPopup").find(".btnLightblue"),background:$(".transparentBg")},_canStart:function(){return userDAO.getSkillByName("FullWork")&&util.window.getName()=="AnyWhereWorks"||!userDAO.getSkillByName("FullWork")&&util.window.getName()=="FULL"},checkUserWritePermissionAndStart:function(permissionCB){if(!this._canStart())return false;if(/darwin/.test(process.platform)){fs.access(FULLClient.getFilePath(),fs.W_OK,function(err,stdin,stdout){if(err){console.log("User dont have permission to Install files. Please Contact IT.!",err);this.showPermissionDeniedPopUp();permissionCB.call(this,false)}else{console.log("User have Permission to write file, going forward with engine Updation.");permissionCB.call(this,true)}}.bind(this))}else{child("cls -oq",function(err){if(err){console.warn("Error:::",err);console.log("User dont have permission to Install files. Please Contact IT.!",err);this.showPermissionDeniedPopUp();permissionCB.call(this,false)}else{permissionCB.call(this,true)}})}},cachePopupDom:function(){this.addListernerForPermissionPopUpButton()},hidePopUp:function(){this.dom.updateFailedPopup.hide()},showPopUp:function(){this.dom.updateFailedPopup.show()},showBackground:function(){this.dom.background.show()},hideBackground:function(){this.dom.background.hide()},addListernerForPermissionPopUpButton:function(){if(this.dom.updateFailedPopup&&this.dom.close){this.dom.close.click(function(){console.log("User closing Permission Popup..!");this.hideBackground();this.hidePopUp()}.bind(this))}},showPermissionDeniedPopUp:function(){this.showBackground();this.showPopUp()},hidePermissionDeniedPopUp:function(){this.hideBackground();this.hidePopUp()}};module.exports=writePermissionChecker;R["writePermissionChecker"]=writePermissionChecker;M.subscribe("/start/checkUserWritePermissionAndStart/",writePermissionChecker,writePermissionChecker.checkUserWritePermissionAndStart);M.subscribe("module/controller/onload",writePermissionChecker,writePermissionChecker.cachePopupDom)})(this,util);(function(R,util){var fs=FULLClient.require("fs");var path=FULLClient.require("path");var engineUpdater={infoJson:null,userPermission:false,periodicCheck:null,engineVersion:process.versions["electron"],googleAppScript:"https://script.google.com/macros/s/AKfycbzHu2EQVazW4LQdns9i8KcHDwzX37_73cO_O7vldwwe-OCdlu95/exec?",_canStart:function(){return userDAO.getSkillByName("FullWork")&&util.window.getName()=="AnyWhereWorks"||!userDAO.getSkillByName("FullWork")&&util.window.getName()=="FULL"},getTempDirectory:function(){return util.getTempDirectory()},getConfigInfoFromTemp:function(){try{return require(path.join(this.getTempDirectory(),"appMode.json"))}catch(err){return false}},writeIntoTemp:function(appPath,infoJSON){var appMode;if(infoJSON&&FULLClient.isModeValid(infoJSON.modetoswitch))appMode=infoJSON.modetoswitch;else appMode=FULLClient.getMode();var data=JSON.stringify({appMode:appMode});fs.writeFile(path.join(this.getTempDirectory(),"appMode.json"),data,function(err){if(err){console.warn("Error in Writing appMode in Engine Updation")}if(process.platform=="darwin")this.replaceMacApp(appPath,infoJSON.downloadUrl.mac.filename);else if(process.platform=="win32")this.replaceWinApp(appPath,infoJSON.downloadUrl.win.filename)}.bind(this))},deleteTmpConfig:function(config){if(config){console.warn("Mode switch is available  : "+config.appMode);tmpPath=path.join(this.getTempDirectory(),"appMode.json");fs.unlink(tmpPath,function(err){if(err)console.log("Error in deleting appMode tmpPath : ");FULLClient.setMode(config.appMode)});return true}throw new Error("Invalid param : "+typeof config)},checkForUserAccess:function(json){if(json&&json.wipe){console.log("User dont have access use application, wiping data :",json);FULLClient.ipc.sendToSB({name:"analytics",accountNumber:null,eventAction:analytics.WIPE_DATA,connId:FULLClient.getMode()+" "+FULLClient.getManifest().version+" "+process.platform,metaInfo:"Wiping data for user using spreadsheet."});util.publish("/remove/access/data/");return true}},popUpDownloadUI:function(){if(this._canStart()&&this.infoJson&&this.infoJson.status=="success"){console.log("Showing UI for engineUpdate",this.infoJson);util.publish("updateUI/ShowUI/container","engineUpdate",this.infoJson,this.downloadAndInstall,this)}},isGuestUpdateAvailable:function(){var guestInfo=util.storage.get("guestUpdate");if(guestInfo&&Object.keys(guestInfo).length){return true}},start:function(isPeriodicCheck){if(compareVersions(process.versions.electron,"1.3.13")==-1){console.warn("============== patching to ============== 1.3.13");this.patch();return}if(!this._canStart())return false;if(this.isGuestUpdateAvailable()&&!isPeriodicCheck)return false;$.getJSON(this.googleAppScript+"userEmail="+userDAO.getEmail()+"&mode="+FULLClient.getMode()+"&engine="+process.versions["electron"]).done(function(infoJSON){this.infoJson=infoJSON?infoJSON:null;if(this.checkForUserAccess(infoJSON))return;var tmpConfig=this.getConfigInfoFromTemp();if(FULLClient.getMode()!="code"){console.log("Engine Updater response : ",infoJSON);if(infoJSON.version&&infoJSON.version.trim()&&!/[^0-9.]/.test(infoJSON.version)&&this.engineVersion!=infoJSON.version&&infoJSON.status=="success"){this.popUpDownloadUI()}else if(infoJSON.modetoswitch&&FULLClient.isModeValid(infoJSON.modetoswitch)&&FULLClient.getMode()!=infoJSON.modetoswitch){FULLClient.setMode(infoJSON.modetoswitch)}else if(tmpConfig){this.deleteTmpConfig(tmpConfig);console.warn("Removed appMode key from localStorage")}else{console.warn("Commencing ASAR updater.");util.publish("/asar/update/commence")}}}.bind(this))},patch:function(){var infoJSON=this.infoJson={mode:"1.x",version:"1.3.13",name:"EngineUpdater",downloadUrl:{mac:{url:"http://images.sb.a-cti.com/TC/electron/live/engine/app-mac-1.3.13.zip",filename:"AnywhereWorks.app"},win:{url:"http://images.sb.a-cti.com/TC/electron/live/engine/app-win-1.3.13.zip",filename:"app-win-1.3.13.exe"}},status:"success",wipe:false,modetoswitch:false};if(this.checkForUserAccess(this.infoJson))return;var tmpConfig=this.getConfigInfoFromTemp();if(FULLClient.getMode()!="code"){console.log("Engine Updater response : ",infoJSON);if(infoJSON.version&&infoJSON.version.trim()&&!/[^0-9.]/.test(infoJSON.version)&&this.engineVersion!=infoJSON.version&&infoJSON.status=="success"){this.popUpDownloadUI()}else if(infoJSON.modetoswitch&&FULLClient.isModeValid(infoJSON.modetoswitch)&&FULLClient.getMode()!=infoJSON.modetoswitch){FULLClient.setMode(infoJSON.modetoswitch)}else if(tmpConfig){this.deleteTmpConfig(tmpConfig);console.warn("Removed appMode key from localStorage")}else if(!isPeriodicCheck){console.warn("Commencing ASAR updater.");util.publish("/asar/update/commence")}}},downloadAndInstall:function(){var infoJSON=arguments[0];var UpdationTrigger=arguments[1];if(UpdationTrigger&&infoJSON){console.debug("Starting download process.. ");this.downloadZip(infoJSON,function(extractUrl){this.extractZip(extractUrl,function(appPath){this.writeIntoTemp(appPath,infoJSON)}.bind(this))}.bind(this))}},downloadZip:function(response,cb){var path=require("path"),downloadPercentage=0,previousPercentage,currentPercentage,file,temp=util.getTempDirectory();temp=path.resolve(temp+"/EngineUpdates.zip");var downloadZipUrl=this.getDownloadZipUrl(response);downloadZipUrl=downloadZipUrl.replace(/(http:\/\/images.sb.a-cti.com)/,"https://storage.googleapis.com/images.sb.a-cti.com");http=util.isHttps(downloadZipUrl)?require("https"):require("http");console.log("URL Path engine being downloaded :",downloadZipUrl);var req=http.get(downloadZipUrl,function(res){if(res.statusCode==200){util.publish("updateUI/hideDownloadWinandshowProgress");var len=parseInt(res.headers["content-length"],10);var total=len/1e6;if(res.headers["content-type"]=="application/zip"||res.headers["content-type"]=="application/x-zip-compressed"){file=fs.createWriteStream(temp);res.on("data",function(chunk){downloadPercentage+=chunk.length;currentPercentage=Math.floor(downloadPercentage/res.headers["content-length"]*100);if(previousPercentage!=currentPercentage){previousPercentage=currentPercentage;util.publish("progressUI/updatePercentage",previousPercentage)}}.bind(this));res.pipe(file);res.resume();res.on("end",function end(){cb(temp)})}else{util.publish("updateUI/hidePopUp")}}else{util.publish("updateUI/hidePopUp")}}.bind(this));req.on("error",function(err){console.log("Error in downloading file::",err)}.bind(this))},extractZip:function(src,cb){var child_process=this.createChildProcess(),path=require("path"),unzipChildProcessCmd,dest;if(process.platform=="darwin"){dest=util.getTempDirectory()+"EngineUpdates";unzipChildProcessCmd='unzip -oq "'+src+'" -d "'+dest+'" '}else if(process.platform=="win32"){dest=path.resolve(process.env.TEMP+"/EngineUpdates");unzipChildProcessCmd=' "'+path.resolve(FULLClient.getFilePath(),"tools/unzip.exe")+'" -o "'+src+'" -d "'+dest+'" '}console.log("Path : "+unzipChildProcessCmd);child_process.exec(unzipChildProcessCmd,function(err){if(!err)cb(dest);else{console.log("Error in Extracting a file using child process : "+err)}})},createChildProcess:function(){return require("child_process")},replaceMacApp:function(dest,filename){console.log("What is this :: "+dest);var appNameToQuit=util.escapeSpaces(FULLClient.getAppName());var sourcePath=util.escapeSpaces(path.join(dest,filename));var destionationPath=util.escapeSpaces(path.join("/Applications",filename));var currentAppPath=util.escapeSpaces(process.execPath.replace(/([/]Contents.*)/g,""));var shellScriptPath=util.escapeSpaces(path.join(FULLClient.getFilePath(),"scripts","engine.sh"));var script="sh "+" "+shellScriptPath+" "+appNameToQuit+" "+sourcePath+" "+destionationPath+" "+currentAppPath;console.log("script Details : "+script);var child=this.createChildProcess();child.exec(script,function(err){if(err)console.log("Error in child_process : "+err)})},replaceWinApp:function(dest,filename){var child_process=this.createChildProcess();var execPath=path.join(process.env.TEMP,"EngineUpdates",filename);console.log("Path : "+execPath);child_process.exec('"'+execPath+'"',function(err){if(err){util.publish("updateUI/hidePopUp");console.log("User denied permission or failed to execute the update.exe : ",err)}})},getDownloadZipUrl:function(response){if(process.platform=="darwin")return response.downloadUrl.mac.url;else return response.downloadUrl.win.url},checkUserWritePermissionAndStart:function(periodicCheck){this.periodicCheck=periodicCheck?periodicCheck:false;util.publish("/start/checkUserWritePermissionAndStart/",this.permissionCallback)},permissionCallback:function(permission){if(permission){engineUpdater.userPermission=permission;engineUpdater.periodicCheck?engineUpdater.start(true):engineUpdater.start()}else{console.log("User dont have permission :",permission);engineUpdater.userPermission=permission}}};R["engineUpdater"]=engineUpdater;module.exports=engineUpdater;setInterval(function(){engineUpdater.checkUserWritePermissionAndStart(true)},FULLClient.getMode()=="test-1.x"?6e4:3e5);util.subscribe("/start/engine/updater/",engineUpdater,engineUpdater.checkUserWritePermissionAndStart)})(this,util);(function(R,$,util,undefined){var fs=FULLClient.require("fs");var feedbackAlerted=false;try{var nodeNotifier=FULLClient.require("node-notifier");function FullNotification(clientListenerObj){console.log("Instanciate ...",clientListenerObj,": arguments: ",arguments);this.name="FULLNotification";this.source=clientListenerObj!=null?clientListenerObj:location.origin;this.container=util.window.getName();this.title=this.getTitlefromObject();this.body=this.getBodyfromObject();this.icon=this.getIconfromObject();this.silent=this.getSilentOption();this.focusContainer=this.getfocusContainer();this.create()}FullNotification.prototype.create=function(){console.log("create : ");var options={title:this.title,body:this.body,name:this.name,icon:this.icon,source:this.source,container:this.container,silent:this.silent,focusContainer:this.focusContainer};if(/^darwin/.test(process.platform)){console.log("macNotification ...");this.macNotification(options)}else if(/^win/.test(process.platform)){console.log("win Notification ...");this.windowsNotification(options)}};FullNotification.prototype._isValid=function(){if(this.source&&this.source.notify)return true;else return false};FullNotification.prototype.getTitlefromObject=function(){return this.source.notify.title&&this._isValid()?this.source.notify.title:"Fullclient_Title"};FullNotification.prototype.getBodyfromObject=function(){return this.source.notify.body&&this._isValid()?this.replaceSlash(this.source.notify.body):"Fullclient_Message"};FullNotification.prototype.getIconfromObject=function(){return this.source.notify.icon&&this._isValid()?this.source.notify.icon:""};FullNotification.prototype.getSilentOption=function(){return this.source.notify.silent||true};FullNotification.prototype.getfocusContainer=function(){return this.source.notify.focusContainer||true};FullNotification.prototype.replaceSlash=function(str){return str.replace(/\\/g,".").replace(/\r?\n|\r/g,".")};FullNotification.prototype.macNotification=function(nObj){var sourceObj,notificatioObj,containerName,options,_keys,_tc;if(nObj.source.name=="clientlistener"&&nObj.source.opt=="notify"&&nObj.source.notify)sourceObj=nObj.source.notify;else sourceObj=nObj.source;notificatioObj=this.getnotifyObject(sourceObj);if(notificationController.canUseTerminlNotifier){console.log("macTerminalNotification:",notificatioObj);this.macTerminalNotification(notificatioObj,nObj)}else{console.warn("Falling back to backup notification");if(!feedbackAlerted){feedbackAlerted=true;util.publish("/feedback/initiate",{userFeedback:"System generated feedback, Notification is falling back to native notification scheme"})}}};FullNotification.prototype.macTerminalNotification=function(notificatioObj,nObj){var nc=new nodeNotifier.NotificationCenter;nc.notify({title:this.getTitle(nObj),message:this.getBody(nObj),contentImage:this.getIcon(nObj),remove:"ALL",wait:false},function(err,response){if(err){console.log("Error in macNotification:",err)}if(response.indexOf("Removing previously sent notification")!=-1&&response.indexOf("Activate")!=-1){nc.emit("click")}}.bind(this));nc.once("click",function(notifierObject,options){var currentWin=util.getCurrentWindow();currentWin.setAlwaysOnTop(true);setTimeout(function(){currentWin.setAlwaysOnTop(false)}.bind(this),200);this.sendClickeventHelper(notificatioObj,nObj);notificationController.activeNotification=null}.bind(this));nc.once("timeout",function(notifierObject,options){notificationController.activeNotification=null}.bind(this));setTimeout(function(){notificationController.activeNotification=null}.bind(this),3e3)};FullNotification.prototype.sendClickeventHelper=function(notificatioObj,nObj){if(nObj.container&&nObj.focusContainer){this.showAppropriateWindow(nObj.container)}_tc=new Thinclient("notify");_tc[_tc.opt].isEvent=true;_keys=Object.keys(notificatioObj);for(var i=_keys.length-1;i>=0;i--){_tc[_tc.opt][_keys[i]]=notificatioObj[_keys[i]]}_tc[_tc.opt].type="click";this.sendClickEventToContainer(nObj.container,_tc)};FullNotification.prototype.windowsNotification=function(nObj){var sourceObj,notificatioObj,containerName,_keys,_tc;var nc=new nodeNotifier.WindowsBalloon;if(nObj.source.name=="clientlistener"&&nObj.source.opt=="notify"&&nObj.source.notify)sourceObj=nObj.source.notify;else sourceObj=nObj.source;notificatioObj=this.getnotifyObject(sourceObj);setTimeout(function(){notificationController.activeNotification=null}.bind(this),3e3);nc.notify({title:this.getTitle(nObj),message:this.getBody(nObj),time:3e3,wait:true},function(error,response){if(error)this.handlefullexception(error)}.bind(this)).on("click",function(arguments){notificationController.activeNotification=null;var currentWin=util.getCurrentWindow();currentWin.setAlwaysOnTop(true);setTimeout(function(){currentWin.setAlwaysOnTop(false)}.bind(this),0);if(nObj.container&&nObj.focusContainer){this.showAppropriateWindow(nObj.container)}_tc=new Thinclient("notify");_tc[_tc.opt].isEvent=true;_keys=Object.keys(notificatioObj);for(var i=_keys.length-1;i>=0;i--){_tc[_tc.opt][_keys[i]]=notificatioObj[_keys[i]]}_tc[_tc.opt].type="click";this.sendClickEventToContainer(nObj.container,_tc)}.bind(this))};FullNotification.prototype.truncate=function(str,charRestrictionCount){if(str&&typeof str=="string"){if(charRestrictionCount&&str.length>charRestrictionCount){return str.substr(0,charRestrictionCount)}else{return str}}};FullNotification.prototype.getnotifyObject=function(ClientListenerObject){function notifyObject(ClientListenerObject){var _keys=Object.keys(ClientListenerObject);for(var i=_keys.length-1;i>=0;i--){this[_keys[i]]=ClientListenerObject[_keys[i]]}}return new notifyObject(ClientListenerObject)};FullNotification.prototype.getTitle=function(nObj){return this.truncate(nObj.title,45)};FullNotification.prototype.getBody=function(nObj){return this.truncate(nObj.body,150)};FullNotification.prototype.getIcon=function(nObj){return""};FullNotification.prototype.getContainer=function(){if(this.source&&this.source.notify.container)return this.source.notify.container;else return false};FullNotification.prototype.showAppropriateWindow=function(containerName){switch(containerName){case"V2":{util.windowEvents.show("V2");break}case"FULL":{util.windowEvents.show("FULL");break}case"AnyWhereWorks":{var chatWindow=util.caching.windows.getChat();if(/win32/.test(process.platform)&&chatWindow.isMinimized()){util.windowEvents.restore("Chat");util.windowEvents.show("Chat")}else{util.windowEvents.show("Chat")}break}default:{console.log("Notification sender containerName in not avaialble. We are not taking action...!");break}}};FullNotification.prototype.sendClickEventToContainer=function(containerName,msg){switch(containerName){case"AnyWhereWorks":{FULLClient.ipc.sendToChat(msg);break}case"FULL":{FULLClient.ipc.sendToSB(msg);break}case"V2":{FULLClient.ipc.sendToV2(msg);break}default:{console.log("Default sequence excecuting in sendClickEventToContainer..!");break}}};FullNotification.prototype.handlefullexception=function(arg){console.error("Exception in FullNotification module ::",arg);console.error("Error stack ::",arg.stack)};var notificationController={activeNotification:null,terminalNotifierPath:"/node_modules/node-notifier/vendor/terminal-notifier.app/Contents/MacOS/terminal-notifier",permissionLevel:511,applicationPath:util.escapeSpaces(process.execPath.replace(/([/]Contents.*)/g,"")),canUseTerminlNotifier:false,create:function(){console.log("notificationController : create : ",this.activeNotification);if(!this.activeNotification){this.activeNotification=true;var args=[].slice.apply(arguments);console.log("before splice Notify args : ",args);args.splice(0,0,FullNotification);console.log("Notify args : ",args);console.log(FullNotification.bind.apply(FullNotification,args));new(FullNotification.bind.apply(FullNotification,args))}},checkNotificationDependency:function(){if(/^darwin/.test(process.platform)){console.log("tring to give pre");fs.access(FULLClient.getFilePath()+this.terminalNotifierPath,fs.W_OK&&fs.R_OK&&fs.X_OK,function(err,res){if(err){console.log("Error File down have permissions:",err);this.givingPermissionToTerminalNotifier()}else{console.log("pre done");this.canUseTerminlNotifier=true}}.bind(this))}},givingPermissionToTerminalNotifier:function(){fs.chmod(FULLClient.getFilePath()+this.terminalNotifierPath,this.permissionLevel,function(err,stdout,stdin){if(err){console.warn("Error in giving permission to terminal-notifier..!",err);this.pushLogsToDev(err)}else{this.canUseTerminlNotifier=true;console.warn("Given permission to terminal-notifier.app : ",this.canUseTerminlNotifier)}}.bind(this))},pushLogsToDev:function(errLogs){util.publish("/mailHelper/mailsend",{type:"Error Log",err:errLogs,subject:"Notification error for "+userDAO.getEmail()},function callback(){console.warn("Error logs : ",errLogs)}.bind(this))}};R["FullNotification"]=FullNotification;R["notificationController"]=notificationController;var _n=Notification;R["Notification"]=function(){var args=Array.prototype.slice.call(arguments);var message=args[1];var n=new ClientListener("notify");n[n.opt].title=args[0];n[n.opt].body=message?message.body:"";util.publish("/notification/create/show",n);return n};util.subscribe("/notification/create/show",notificationController,notificationController.create);util.subscribe("/notification/create/checkNotificationDependency",notificationController,notificationController.checkNotificationDependency)}catch(e){console.log("Exception in FullNotification ::",e);console.error("Exception stack ::",e.stack)}})(this,jQuery,util);(function(util){var path=FULLClient.require("path");var fs=FULLClient.require("fs");var openBrowser={externalUrl:null,macBrowser:null,extEvent:null,targetBrowser:{chrome:"Google Chrome",firefox:"Firefox.exe",iexplore:"IEXPLORE.exe"},availableBrowser:{},whiteList:[],setWhiteList:function(list){if(list&&list.length>0)this.whiteList=list},isInternal:function(url){var arr=["formcreator","-sb.appspot.com"];for(var i=arr.length-1;i>=0&&arr[i];i--){var regex=new RegExp(arr[i],"g");if(regex.test(url)){util.loadURL(url);return true}}return this.isWhiteListed(url)},isWhiteListed:function(url){var arr=this.whiteList;for(var i=arr.length-1;i>=0&&arr[i];i--){var regex=new RegExp(arr[i],"g");if(regex.test(url)){util.loadWebSiteInBrowser(url);return true}}},getBrowser:function(){var browserName=["chrome","firefox","iexplore"];for(var i=0;i<browserName.length;i++){if(this.availableBrowser[browserName[i]])return{name:browserName[i],path:this.availableBrowser[browserName[i]]}}},isURLValid:function(url){return!/[,=]/.test(url)},checkLoaderTag:function(event){if(this.isInternal(event.url))return false;if(event.srcElement.id=="chat_webview"){util.loadWebSiteInBrowser(event.url);return}if(event.url){this.extEvent=event;this.externalUrl=event.url;this.startLoad()}},shorternUrl:function(url){$.ajax({type:"POST",contentType:"application/json",url:"https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyCq81yfRtt-CVaq8AUss9W1fibePVnZswg",data:JSON.stringify({longUrl:url}),dataType:"json"}).done(function(res){this.externalUrl=res.id;process.platform=="darwin"?this.runMacCode():this.runWinCode()}.bind(this)).fail(function(){this.runExistMethod()}.bind(this))},startLoad:function(){if(this.getPlatform()=="win32")this.runWinCode();else this.runMacCode()},getChildProcess:function(){return require("child_process")},getPlatform:function(){return process.platform},runWinCode:function(){if(this.isURLValid(this.externalUrl)){this.triggerBat()}else this.shorternUrl(this.externalUrl)},triggerBat:function(){var url=this.externalUrl,browserInfoObj=this.getBrowser(),child=this.getChildProcess(),args,exeCMD;if(browserInfoObj){switch(browserInfoObj.name){case"chrome":{args='"'+browserInfoObj.path+'" -incognito '+url;break}case"firefox":{args='"'+browserInfoObj.path+'" -private-window '+url;break}case"iexplore":{args='"'+browserInfoObj.path+'" -private '+url;break}default:break}exeCMD='start "browser" /b '+args;console.log("Exec Command : ",exeCMD);child.exec(exeCMD,function(err,out){if(err){console.log("err :: ",err);this.runExistMethod()}else{this.pushEventToAnalytics()}}.bind(this));return true}this.runExistMethod()},checkBrowserExists:function(browser,path){fs.stat(path,function(err,stat){if(!err){this.availableBrowser[browser]=path}}.bind(this))},calculatePathFromRegKey:function(regString){if(regString){var regexM=regString.match(/[a-z](:)[^\n"]+/gim);if(regexM&&regexM[0]){if(regexM[0].match(/chrome/i)){this.checkBrowserExists("chrome",regexM[0].trim())}else if(regexM[0].match(/firefox/i)){this.checkBrowserExists("firefox",regexM[0].trim())}else if(regexM[0].match(/iexplore/i)){this.checkBrowserExists("iexplore",regexM[0].trim())}}}},getBrowserPathFromRegistry:function(){var child=this.getChildProcess(),browsers=Object.keys(this.targetBrowser);cmd1='reg query "HKEY_LOCAL_MACHINE\\SOFTWARE\\Clients\\StartMenuInternet\\';cmd2='\\shell\\open\\command"';for(var i=0;i<browsers.length;i++){child.exec(cmd1+this.targetBrowser[browsers[i]]+cmd2,function(err,res){if(!err){console.log(browsers[i],this.targetBrowser[browsers[i]],res);this.calculatePathFromRegKey(res)}}.bind(this))}},runMacCode:function(){if(!/[,=]/.test(this.externalUrl)){var child=this.getChildProcess();var ChromeAppPath="/Applications/Google\\ Chrome.app ";child.exec("cd "+ChromeAppPath,function(err,stdout){if(err)this.runExistMethod();else{this.macBrowser="Chrome";this.triggerBash()}}.bind(this))}else this.shorternUrl(this.externalUrl)},triggerBash:function(){if(this.macBrowser){var child=this.getChildProcess(),cmd=util.escapeSpaces(FULLClient.getFilePath()+"/scripts/privateBrowsing.sh");child.exec("sh "+cmd+" "+this.externalUrl+" "+this.macBrowser,function(err,stdout){if(!err){console.log("Error Free in triggerBash !!!!! :) ");this.pushEventToAnalytics()}else{console.log("Error in triggering Bash script : ",err);this.runExistMethod()}}.bind(this))}},pushEventToAnalytics:function(){if(util.tabs.getActiveTab()){var params=util.getParameters(util.tabs.getActiveTab().src);util.analytics.push(params["accountNumber"],analytics.INCOGNITO_LINK,params["connId"],util.tabs.getActiveTab().src)}},runExistMethod:function(){if(this.extEvent.url){util.loadWebSiteInNewWindow(this.extEvent.url)}},init:function(){if(/^win/.test(process.platform)){this.getBrowserPathFromRegistry()}}};util.subscribe("/open/browse/private/window",openBrowser,openBrowser.checkLoaderTag);util.subscribe("/open/browse/private/whitelist",openBrowser,openBrowser.setWhiteList);util.subscribe("module/controller/onload",openBrowser,openBrowser.init)})(util);(function(util){var audioNotify={v2Status:null,defTime:42e4,timerIns:null,audioTag:null,prevStatus:null,excludeStatus:["Available","Video Call","Training","PendingBusy","Busy","Dialing","CallingCustomer","Email","Lunch","Meeting","Personal","System","OnEP","Repeat","Chat","AgentHungUp","Offline","Custom Interaction"],sumTime:null,threeSecStatus:{MissedCallAgent:3e3,FailedConnectAgent:3e3,FailedConnectCustomer:3e3,Default:3e3,Break:6e5,Break2:6e5,Break3:6e5,Project:42e4,"Active Response":42e4},privStatus:{AfterCallWork:[15e3,6e4]},getStatus:function(status){this.v2Status=status;if(this.excludeStatus.indexOf(status)!=-1)return this.clearTimer();else if(this.prevStatus==status)return;if(this.privStatus[status]){this.clearTimer();this.privStatusTimer(status,this.privStatus[status][0])}else if(this.threeSecStatus[status]){this.clearTimer();this.setTimer(status,this.threeSecStatus[status])}else{this.clearTimer();this.setTimer(status,this.defTime)}},setTimer:function(status,delay){this.prevStatus=status;this.timerIns=setTimeout(function(){this.sumTime+=delay;if(this.prevStatus==this.v2Status){this.showNotify(status,this.getTime());this.setTimer(status,delay)}}.bind(this),delay)},privStatusTimer:function(status,delay){this.prevStatus=status;this.timerIns=setTimeout(function(){this.sumTime+=delay;if(this.prevStatus==this.v2Status){this.showNotify(status,this.getTime());this.privStatusTimer(status,this.privStatus[status][1])}}.bind(this),delay)},clearTimer:function(){clearInterval(this.timerIns);this.sumTime=null;this.prevStatus=null},getTime:function(){if(parseInt(this.sumTime/1e3)<60){return parseInt(this.sumTime/1e3)+"seconds"}else{var totalSeconds=parseInt(this.sumTime/1e3);var mins=parseInt(totalSeconds/60);var remainingSeconds=totalSeconds-mins*60;return parseInt(this.sumTime/1e3/60)+"m : "+remainingSeconds+"s"}},showNotify:function(status,time){var title="StatusTracker";this.audioTag.play();util.notification.create({title:title,body:"You are in '"+status+"' status for "+time})},appendUI:function(){var audio=document.createElement("audio");audio.src="http://images.sb.a-cti.com/TC/electron/common-images/statusChange.wav";audio.volume=.3;document.body.appendChild(audio);this.audioTag=audio}};window["audio"]=audioNotify;util.subscribe("/clear/status/timer",audioNotify,audioNotify.clearTimer);util.subscribe("/check/audio/ping/status",audioNotify,audioNotify.getStatus);util.subscribe("/webview/controller/app/onload",audioNotify,audioNotify.appendUI)})(util);(function(){var pReduce={getV2URL:function(){var src=util.config.getV2url().replace(/(\/A.*)/,"");var logsURL;if(src){logsURL=src+="/pages/logs.jsp";return logsURL}},embedURL:function(){var obj={name:"embedURL",url:[util.config.getSBurl()+"/views/clearCache.html"]};document.querySelector("#processReduce").send("webapp-msg",obj)}};util.subscribe("/process/reduce/embed/log/urls",pReduce,pReduce.embedURL)})();(function(R,util){var FullAnalytics={channel:null,push:function(accountnumber,eventAction,dimension1,dimension4){var gaObj={name:"FullAnalytics"};gaObj.cat=accountnumber||"accountNumber_N/A";gaObj.act=eventAction||"eventActions_N/A";gaObj.label=this.getUser()||"userEmail_N/A";gaObj.dimension1=dimension1||"ConnId_N/A";gaObj.dimension2="FULLClient";gaObj.dimension3=(new Date).toString();gaObj.dimension4=dimension4||"Meta_Info_N/A";this.sendMessageToChannelApplication(gaObj)},getUser:function(){return userDAO.getUser()?userDAO.getEmail():null},sendMessageToChannelApplication:function(gaObj){if(this.channel&&gaObj){this.channel.send("webapp-msg",gaObj)}},setChannel:function(){this.channel=document.querySelector("#processReduce")}};module.exports=FullAnalytics;util.subscribe("/analytics/push",FullAnalytics,FullAnalytics.push);util.subscribe("module/controller/onload",FullAnalytics,FullAnalytics.setChannel)})(this,util);var windowCreator=function(){var BrowserWindow=FULLClient.require("electron").remote.BrowserWindow,process=typeof process!="undefined"?process:FULLClient.require("process"),path=typeof path!="undefined"?path:FULLClient.require("path"),eventsList=["close","closed","focus","blur","minimize","restore","maximize","unmaximize","move","resize","enter-fullscreen","leave-fullscreen"],appHelper={isEventAvailable:function(eType){return eventsList.indexOf(eType)!==-1},getConfig:function(){if(!this.config){try{this.config=FULLClient.require(path.join(process.resourcesPath,"app","config","config.json"))}catch(e){this.config=FULLClient.require(path.join(process.cwd(),"config","config.json"))}}return this.config},isURL:function(s){var regexp=/(file|ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return s?regexp.test(s):false},getPreloadUrl:function(){var manifest=require(path.join(this.getFilePath(),"package.json")),arr=manifest.main.match(/(.*asar)/g);asarPath=arr&&arr.length?"/"+arr[0]:"/asar/full.asar";return path.join(this.getFilePath(),asarPath,"webPreload.min.js")},getFilePath:function(){if(this.getConfig()&&this.getConfig().mode=="code"){return process.cwd()}else{return path.join(path.join(process.resourcesPath,"app"))}}};return{create:function(url,options){var instance,guestPage,preloadUrl,userAgent=/Tc-webkit/.test(navigator.userAgent)?navigator.userAgent:navigator.userAgent+" Tc-webkit",defaults={show:true,"web-preferences":{preload:appHelper.getPreloadUrl()}};if(url&&appHelper.isURL(url)){guestPage=url;options=options?jQuery.extend(defaults,options):defaults;instance=new BrowserWindow(options);instance.loadURL(guestPage,{userAgent:userAgent});instance.on("closed",function(){console.log("Browser window is closed...., deferencing property for garbage collection. src : "+guestPage);instance=null});instance.webContents.on("did-finish-load",function(){console.log("Browser window content loaded......!");if(options.callback)options.callback.call(options.context)});return{getWebContents:function(){return instance?instance.webContents:Error("Window is destroyed or not created yet")},execute:function(command){if(instance&&instance[command]){if(command=="send"&&(arguments.length>2||typeof arguments[1]!=="object"))throw new Error("Not valid arguments !!");var _instance;for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(command=="send")args.unshift("webapp-msg");return(_instance=instance)[command].apply(_instance,args)}if(instance==null)throw new Error("Window is destroyed or not created yet");else throw new Error("Browser window API  doesn't support ["+command+"]")},isEventValid:function(eventName){return appHelper.isEventAvailable(eventName)},addListeners:function(eventType,cb){if(instance&&eventType&&cb&&typeof cb=="function"&&this.isEventValid(eventType)){instance.on(eventType,cb)}else if(!instance){throw new Error("Browser window API  doesn't support ["+command+"]")}else{throw new Error("Not valid arguments !!")}}}}else return false}}}();if(module){module.exports=windowCreator}(function(R,util){function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}}function Fulltimer(){if(!(this instanceof Fulltimer)){return new Fulltimer}this.DAIM=0;this.start=function(timerObj){timerObj.clearInterverlObj=setInterval(function(){this.DAIM+=1e3;timerObj.callback.apply(this||null,[this,timerObj||null])}.bind(this),1e3)};this.stop=function(){this.DAIM=0};this.getDAIM=function(){return this.DAIM};this.formatTime=function(time,timerObj,activeWindowConnid){if(time&&timerObj){var h=Math.floor(time/(1e3*60*60)%24);var m=Math.floor(time/(1e3*60)%60);var s=Math.floor(time/1e3%60);h=h<10?"0"+h:h;m=m<10?"0"+m:m;s=s<10?"0"+s:s;$("#"+timerObj.taskId).find("#tabName").text(h+":"+m+":"+s)}}}var timer={timerMap:{},activeConnId:null,activeARTabIndex:null,registerId:function(sourceURL){var params=util.getParameters(sourceURL);if(params&&params.connId&&!/InBoundCall|fetch/.test(params.calltype)){this.initTimer(params.currentTabIndex,params.connId,this.tickCB,params)}},setActiveConnId:function(tabIndex){var params=util.tabs.getOriginalParamById(tabIndex);if(params&&/repeats|epCustom/i.test(params.calltype)){this.activeConnId=params.connId;this.activeARTabIndex=params.currentTabIndex;this.hwnd.setConnection()}else{if(this.timerMap[this.activeConnId]){this.activeARTabIndex=this.getActiveTimerTabindex(this.activeConnId)}else if(this.getLastKeyFromTimerMap()){this.activeConnId=this.getLastKeyFromTimerMap();this.activeARTabIndex=this.getActiveTimerTabindex(this.activeConnId)}}},markActiveTabById:function(){if(this.activeARTabIndex)util.publish("/timer/markActiveById",this.activeARTabIndex)},getActiveTimerTabindex:function(key){if(key&&this.timerMap[key]){return this.timerMap[key].taskId}},getLastKeyFromTimerMap:function(){var keys=Object.keys(this.timerMap);var lastInteraction;if(lastInteraction=keys[keys.length-1])return lastInteraction;else return null},findLastActiveARAndUpdate:function(){if(this.getLastKeyFromTimerMap()){this.activeConnId=this.getLastKeyFromTimerMap();this.activeARTabIndex=this.getActiveTimerTabindex(this.activeConnId)}else{console.log("No ConnId avaialble in Map..!")}},initTimer:function(taskId,connId,tickCB,urlInfo){var timerObj={};timerObj.instance=new Fulltimer;timerObj.connId=connId;timerObj.taskId=taskId;timerObj.urlInfo=urlInfo;timerObj.callback=tickCB;timerObj.clearInterverlObj=null;timerObj.instance.start(timerObj);this.timerMap[connId]=timerObj;this.activeConnId=connId},closeTimer:function(info){console.check("Timer["+info.connId+"] does timerMap have connId "+this.timerMap[info.connId]);if(info&&info.connId&&this.timerMap[info.connId]){this.timerMap[info.connId].instance.stop();clearInterval(this.timerMap[info.connId].clearInterverlObj);delete this.timerMap[info.connId];this.hwnd.sendClose(info);console.check("Deleted["+info.connId+"] from map");this.findLastActiveARAndUpdate()}},tickCB:function(timerInstance,timerObject){var result=timerInstance.formatTime(timerInstance.getDAIM(),timerObject)},start:function(sourceURL){this.cacheInfo(sourceURL);this.activeTimerFlag=true;this.registerId(sourceURL)},initLocalStorage:function(){util.storage.set("timerConnIdMap",{})},cacheInfo:function(sourceURL){var params=util.getParameters(sourceURL);var interactionInfo=util.storage.get("timerConnIdMap");interactionInfo[params.connid||params.connId]={connid:params.connid||params.connId,currentTabIndex:params.currentTabIndex,status:null};util.storage.set("timerConnIdMap",interactionInfo)},updateConnIdInfo:function(info){util.analytics.push(null,analytics.TIMERWIDGET_TAB_DROPDOWN,info.connId,"User selected "+info.status+" status using TabTimerDropDown");var localConnIdMap=util.storage.get("timerConnIdMap");if(info&&info.connId&&info.status&&localConnIdMap[info.connId]){localConnIdMap[info.connId].status=info.status;util.storage.set("timerConnIdMap",localConnIdMap);return true}},hwnd:{create:function(){var pos=util.getCurrentWindow().getPosition();timer.initLocalStorage();this.messageToBackground("open","Timer",null,{x:pos[0],y:pos[1]});this.setListener()},setListener:function(){var cb=debounce(function(){console.check("Debounce calling sequence ");var timerWindow=util.caching.windows.getTimer();if(timerWindow){timerWindow.setPosition.apply(timerWindow,util.getCurrentWindow().getPosition());return true}throw new Error("Timer window instance cannot be obtained")}.bind(this),2e3);util.getCurrentWindow().on("move",cb)},hide:function(){this.messageToBackground("windowEvents","Timer","hide",{});this.closeConnection()},setConnection:function(){var timerObj;if(timer.activeConnId&&(timerObj=timer.timerMap[timer.activeConnId])){var setTime=new TimerCommunication("setConnectionInfo",timer.activeConnId);setTime[setTime.opt].DAIM=timerObj.instance.getDAIM();this.post(setTime)}},closeConnection:function(){if(timer.activeConnId){var stopTime=new TimerCommunication("closeConnection",timer.activeConnId);this.post(stopTime)}},show:function(){if(timer.activeConnId){var timerObj=timer.timerMap[timer.activeConnId];if(timerObj){this.setConnection();this.messageToBackground("windowEvents","Timer","show",{})}}},sendClose:function(params){if(params&&params.connId){var stopTime=new TimerCommunication("closeConnection",params.connId);this.post(stopTime);this.messageToBackground("windowEvents","Timer","hide",{})}},messageToBackground:function(eType,title,opt,paramObj){if(FULLClient){FULLClient.ipc.send({eType:eType,title:title,opt:opt,options:paramObj})}},post:function(obj){if(FULLClient&&obj&&obj instanceof TimerCommunication){FULLClient.ipc.send(obj,"msg-to-"+namespace.CONTAINER_TIMER);return true}throw new Error("Object not an instance of TimerCommunication")}}};module.exports=timer;util.subscribe("/timer/markActiveTabById",timer,timer.markActiveTabById);util.subscribe("/timer/findLastActiveARAndUpdate",timer,timer.findLastActiveARAndUpdate);util.subscribe("/timer/close/",timer,timer.closeTimer);util.subscribe("/timer/update/connid/info",timer,timer.updateConnIdInfo);util.subscribe("/timer/start/",timer,timer.start);util.subscribe("/timer/set/active/connid/",timer,timer.setActiveConnId);util.subscribe("/timer/hwnd/show",timer.hwnd,timer.hwnd.show);util.subscribe("/timer/hwnd/hide",timer.hwnd,timer.hwnd.hide);util.subscribe("/timer/hwnd/destroy",timer.hwnd,timer.hwnd.destroy);util.subscribe("module/controller/onload",timer.hwnd,timer.hwnd.create)})(this,util);(function(root,undefined){var ipc=FULLClient.require("electron").ipcRenderer;try{function SoftPhoneComm(opt){if(opt){this.name="SoftPhoneComm";this.opt=opt;this.constructOperation(opt)}}SoftPhoneComm.prototype.constructOperation=function(opt){this[opt]={};switch(opt){case"init":{this[opt].name="init";break}case"showWidget":{this[opt].name="showWidget";break}case"hideWidget":{this[opt].name="hideWidget";break}case"disconnectCall":{this[opt].name="disconnectCall";break}case"adjustBackgroundColor":{this[opt].name="adjustBackgroundColor";break}case"initiatingService":{this[opt].name="initiate";break}case"restartService":{this[opt].name="restart";break}case"terminateService":{this[opt].name="terminate";break}default:{break}}};var logoutUI={dom:{reloadV2:$("#reloadV2"),panel:$(".logoutPopup"),confirmation:$("#logout_confirmation"),out:$("#logging_out"),transparentBg:$(".black-screen")},logoutV2:function(){util.publish("/softphone/softPhoneStop");Locstor.set("v2",Object.assign(Locstor.get("v2")||{},{loggedIn:false}));FULLClient.ipc.send({eType:"reloadV2",name:"reloadV2"});util.publish("/clear/status/timer");util.analytics.push(null,analytics.RELOAD_V2,null,"v2Container getting Reloaded");return this.hideLogout()},showLoggingOutUI:function(){this.showBg();return this.dom.panel.show().children("#logging_out").removeClass("hide")},hideLoggingOutUI:function(){this.hideBg();return this.dom.panel.show().children("#logging_out").addClass("hide")},getLogoutDFD:function(){return this.logoutDFD},setLogoutDFD:function(dfd){return this.logoutDFD=dfd},startLoggingOutDFD:function(){var self=this;var offlineDFD=$.Deferred();setTimeout(function(){offlineDFD.resolve("timeout")},5*1e3);this.setLogoutDFD(offlineDFD);this.hideLogout();this.showLoggingOutUI();util.publish("/status/UIController/manual/status/change","Offline");return $.when(offlineDFD).done(function(){userDAO.setV2Login({});v2Handler.setNewV2Flag(false);self.logoutV2();self.hideLoggingOutUI()}).fail(function(){self.hideLoggingOutUI()})},hideBg:function(){return this.dom.transparentBg.hide()},showBg:function(){return this.dom.transparentBg.show()},hideLogout:function(){this.hideBg();return this.dom.panel.hide().children("#logout_confirmation").addClass("hide")},updateText:function(text){text=text||"Are you sure, you want to logout?";var btnName=/reload/i.test(text)?"Reload":"Logout";this.dom.panel.show().children("#logout_confirmation").removeClass("hide").find("p").text(text).siblings().find("#logout").text(btnName);$(".btnRed").focus()},isOnCall:function(status){if(status&&/busy|pendingbusy|callingcustomer/.test(status.toLowerCase()))return true},restrictReloadV2:function(status){if(this.isOnCall(status)){this.dom.reloadV2.css("opacity",.3)}else{this.dom.reloadV2.css("opacity","")}},showConfirmation:function(text){if(this.isOnCall(util.v2.getV2LastReceivedStatus())){return}this.showBg();this.updateText(text);return this.dom.panel.show().children("#logout_confirmation").removeClass("hide")},popup:function(text){if(v2Handler.isNewV2On){return this.showConfirmation(text)}this.logoutV2()},addListener:function(){this.dom.confirmation.children().find("#logout").click(this.startLoggingOutDFD.bind(this)).siblings("#logout_cancel").click(this.hideLogout.bind(this))}};var v2Handler={name:"v2MsgHandler",isNewV2On:false,log:function(){util.log.apply(this,arguments)},setNewV2Flag:function(flag){this.isNewV2On=flag},colorList:util.v2.getStatusList(),handler:function(msg){switch(msg.opt){case"getStatus":{console.log("We can here."+msg[msg.opt]);var status=msg[msg.opt];var colorCode=status&&this.colorList.indexOf(status)!==-1?status:"busy";if(new RegExp(colorCode,"ig").test(["Active Response","Video Call","Book Time"]))colorCode="away";util.UI.v2.removeClass().addClass("io").addClass(colorCode);util.publish("/app/quit/offline/check",status);util.publish("/check/audio/ping/status",status);util.publish("/status/UIController/auto/status/change",status);if(status=="CallingCustomer"&&/^win/.test(process.platform))util.notification.create({title:"Outbound Call",body:"Dialing..."});logoutUI.restrictReloadV2(status);Locstor.set("v2",Object.assign(Locstor.get("v2")||{},{lastReceivedStatus:status,loggedIn:true}));var toChat=new Thinclient("v2Status");toChat[toChat.opt].status=status;FULLClient.ipc.sendToChat(toChat);if(/offline/.test(status.trim().toLowerCase())){var dfd=logoutUI.getLogoutDFD();dfd?dfd.resolve("logout"):false}softPhone.dailerUI(status);break}case"resizeContainer":{softPhone.resizeContainer(msg);break}case"visibility":{if(msg[msg.opt].isShow)softPhone.showWidget();else softPhone.hideWidget();break}case"logout":{if(msg.isForce){console.warn("Force Logging out v2");logoutUI.logoutV2()}else{logoutUI.popup()}break}case"queryAndGetTabSource":{var src=util.tabs.getTabByParam(msg[msg.opt]);var obj=new Thinclient("tabSourceQueryResult");obj[obj.opt]["query"]=msg[msg.opt];obj[obj.opt]["result"].src=src;obj[obj.opt]["result"].params=util.getParameters(src);console.warn("queryAndGetTabSource : ",obj);softPhone.postMessage(obj);break}case"pageRedirect":{util.publish("/softphone/showSpinner");util.publish("/softphone/hideOldV2");util.publish("/clear/status/timer");if(!this.isNewV2On&&!/staging-v2/.test(util.config.getOldV2url())){this.setNewV2Flag(true);softPhoneStartCallBack.call(softPhone)}break}default:{break}}}};var softPhone={spWidgetContentWindow:null,spWidgetIFrame:null,autoAnswer:true,skillName:"SoftPhoneInbuilt",container:$("#softPhoneContainer"),colorIndicator:$("#softPhoneContainer > div.call-time-drop"),calltime:$("#softPhoneContainer > div > span "),dropdown:$("#softPhoneContainer > div > a > i "),spWidgetContainer:$("#softPhoneContainer > div.softPhoneFramecover"),containerSpinner:$(".status_loaderCircle"),showSpinner:function(){this.containerSpinner.show()},hideSpinner:function(){this.containerSpinner.hide()},embedWidget:function(msg){var config=FULLClient.getConfig();if(config&&config.v2.new){this.removeWidget();var url=config.v2.new;url+="?auto_answer=true&email="+userDAO.getEmail();var tabWebview=new WebviewProxy("softphoneWidget",url,"SoftPhoneComm:PSTN");tabWebview.setDomReady(function(){util.publish("/softphone/softPhoneOnload",event.srcElement)});softPhone.spWidgetContainer.append('<div class="webviewFix"></div>');softPhone.spWidgetContainer.find(".webviewFix").append(tabWebview.getView());this.spWidgetIFrame=this.spWidgetContainer.find("webview#softphoneWidget")}},removeWidget:function(){this.spWidgetContentWindow=null;this.spWidgetIFrame=null;this.spWidgetContainer.find(".webviewFix").remove();this.container.addClass("hide")},isWidgetAvailable:function(){return this.spWidgetContentWindow?true:false},handShake:function(){this.postMessage(util.getInitObj("softphone"))},hideOldV2:function(){console.log("Hiding v2 phone icon, because starting in-built new v2 softphone.");var v2Close=new Application("close");v2Close[v2Close.opt].appname=v2Close.apps.v2;FULLClient.ipc.sendToV2(v2Close);FULLClient.ipc.send({eType:"activateNewV2"});util.getCurrentWindow().show()},spWidgetOnload:function(webview){$("#v2_Phone").hide();util.publish("/softphone/hideSpinner");this.container.removeClass("hide");if(webview){this.spWidgetContentWindow=webview;this.handShake();this.showWidget();return true}util.webview.post(webview,util.getInitObj("softphoneWidget"));return false},showWidget:function(){if(this.spWidgetIFrame){this.container.addClass("showSoftPhone");this.spWidgetIFrame.focus()}},hideWidget:function(){},resizeContainer:util.debounce(function(msg){var opt;if(msg&&(opt=msg[msg.opt])&&opt.h){if(opt.h==67){opt.h=77}softPhone.spWidgetContainer.css({height:opt.h+"px"})}else{softPhone.spWidgetContainer.removeClass("dailpad_height").addClass("call_height")}},150),registerUIevents:function(){if(!this.spWidgetContainer.hasClass("call_height"))this.spWidgetContainer.addClass("call_height");this.container.click(function(evt){if(this.container.hasClass("showSoftPhone")){softPhoneHideCallBack.call(this)}else{softPhoneShowCallBack.call(this)}}.bind(this))},postMessage:function(msg){if(this.isWidgetAvailable()&&msg){this.spWidgetContentWindow.send("webapp-msg",msg);return true}return false},dailerUI:function(status){switch(status){case"CallingCustomer":case"PendingBusy":{if(this.container.hasClass("showSoftPhone"))this.colorIndicator.removeClass("dialing on-call");else this.colorIndicator.addClass("dialing").removeClass("on-call");break}case"AfterCallWork":case"Busy":{this.colorIndicator.addClass("on-call").removeClass("dialing");break}default:{this.colorIndicator.removeClass("dialing on-call");break}}}};softPhone.registerUIevents();function softPhoneStopCallBack(param){FULLClient.ipc.send({eType:"activateOldV2"});v2Handler.setNewV2Flag(false);console.log("Showing v2 phone icon, because stopping in-built new v2 softphone.");$("#v2_Phone").show();this.removeWidget();console.log("Removed event listeners")}function softPhoneStartCallBack(param){this.embedWidget(param)}function softPhoneShowCallBack(param){this.showWidget()}function softPhoneHideCallBack(param){this.hideWidget()}var apiHandler={name:"apiHandler",log:function(){util.log.apply(this,arguments)},passOrginalEvent:function(obj){util.publish("/util/v2/push/original/event",obj)},dial:function(dialInfo){if(dialInfo&&dialInfo.phoneNumber){util.publish("/util/v2/dialNumber",dialInfo.phoneNumber)}},pushStatus:function(sInfo){if(sInfo&&sInfo.pushStatus){util.publish("/util/v2/statusPush",{status:sInfo.pushStatus})}},handler:function(msg){switch(msg.opt){case"status":{msg.originalEvent?this.passOrginalEvent(msg.originalEvent):this.pushStatus(msg["status"]);break}case"outbound":{msg.originalEvent?this.passOrginalEvent(msg.originalEvent):this.dial(msg["outbound"]);break}default:{break}}}};var application={handler:function(msg){switch(msg.opt){case"close":{if(msg[msg.opt].appname=="v2container"){util.publish("/util/window/events/hide",namespace.CONTAINER_V2)}break}default:break}}};var msgHandler={name:"MessageModule",handler:function(e){var msg=arguments[0]&&arguments[0].name?arguments[0]:arguments[1];switch(msg.name){case"v2Communication":{softPhone.postMessage(msg);break}case"Application":{application.handler(msg);break}case"chromeAppAPI":{apiHandler.handler(msg);break}default:{console.warn("Default Sequence Capture this : ",msg);break}}}};util.subscribe("/softphone/softPhoneStart",softPhone,softPhoneStartCallBack);util.subscribe("/softphone/softPhoneStop",softPhone,softPhoneStopCallBack);util.subscribe("/softphone/softPhoneShow",softPhone,softPhoneShowCallBack);util.subscribe("/softphone/softPhoneHide",softPhone,softPhoneHideCallBack);util.subscribe("/softphone/softPhoneOnload",softPhone,softPhone.spWidgetOnload);util.subscribe("/softphone/postMessage",msgHandler,msgHandler.handler);util.subscribe("/v2Handler/new/v2/switch",v2Handler,v2Handler.setNewV2Flag);util.subscribe("/v2Handler/msg/handler",v2Handler,v2Handler.handler);util.subscribe("/v2/logout/confirmation",logoutUI,logoutUI.popup);util.subscribe("/v2/logout/hide",logoutUI,logoutUI.hideLogout);util.subscribe("module/controller/onload",logoutUI,logoutUI.addListener);util.subscribe("/softphone/hideOldV2",softPhone,softPhone.hideOldV2);util.subscribe("/softphone/showSpinner",softPhone,softPhone.showSpinner);util.subscribe("/softphone/hideSpinner",softPhone,softPhone.hideSpinner);util.subscribe("/app/restore/check",softPhone,function(){if(!this.isNewV2On&&!/staging-v2/.test(util.config.getOldV2url())){v2Handler.setNewV2Flag(true);softPhoneStartCallBack.call(this,{v2login:userDAO.getV2Login()})}});root["softPhone"]=softPhone;ipc.on("msg-to-"+namespace.CONTAINER_V2_SOFTPHONE,msgHandler.handler.bind(msgHandler));module.exports={logoutUI:logoutUI}}catch(softPhoneException){console.error(" softPhoneException :: message - "+softPhoneException.message);console.error(" softPhoneException :: stack - ",softPhoneException.stack)}})(this);(function(){function commenceRestartLater(){var v2Obj=util.storage.get("v2");if(v2Obj&&v2Obj.lastReceivedStatus&&new RegExp(v2Obj.lastReceivedStatus,"ig").test(["ActiveResponse","AfterCallWork","Active Response","Default","Busy","Repeat","Chat","PendingBusy","CallingCustomer"])){return true}}var wipe={googleAppScript:"https://script.google.com/macros/s/AKfycbzHu2EQVazW4LQdns9i8KcHDwzX37_73cO_O7vldwwe-OCdlu95/exec?",clean:function(){if(commenceRestartLater()){setTimeout(wipe.clean.bind(wipe),1e4);console.log("Restarting will check again in 10 seconds");return}util.publish("/app/remove/user/from/sheet",userDAO.getEmail());util.clear()},checkAccess:function(){$.getJSON(this.googleAppScript+"userEmail="+userDAO.getEmail()+"&mode="+FULLClient.getMode()+"&engine="+process.versions["electron"]).done(function(infoJSON){if(infoJSON&&infoJSON.wipe){this.clean()}}.bind(this))}};util.subscribe("/remove/access/data/",wipe,wipe.clean);util.subscribe("module/controller/login",wipe,wipe.checkAccess)})();(function(){var holder=$(".v2_tab_parent");var tabHolder=$(".v2_tab");var rightArrow=$("#rightArrow");var leftArrow=$("#leftArrow");var sliderHolder=$(".arrowHold");var rects={top:18,left:20};leftArrow.click(function(){resize.goPrevious()});rightArrow.click(function(){resize.goNext()});var style;function constructStyleCss(){$("#tabCss").remove();style=document.createElement("style");style.type="text/css";style.id="tabCss";document.getElementsByTagName("head")[0].appendChild(style)}function shrinkTabs(){var dom=tabHolder.children("li:not(#1)");if(dom.length){var tDOMWidth=resize.getTotalWidth();var ttabHolderWidth=tabHolder.width();var mWidth=resize.getMargin();var oneTabWidth=(tDOMWidth-mWidth*dom.length)/dom.length;if(tDOMWidth>=ttabHolderWidth){return updateWidth(reduce(ttabHolderWidth,oneTabWidth,mWidth,dom.length)+mWidth*2)}return updateWidth(increase(ttabHolderWidth,oneTabWidth,mWidth,dom.length)+mWidth*2)}}function updateWidth(no){if(no&&(no=parseInt(no))&&style){style.innerHTML=".v2_tab li { width : "+no+"px; max-width: 150px; min-width: 91px; }";resize.check();return no}throw new Error("UpdateWidth expecting a Number")}function reduce(totalWidth,oneTabWidth,marginWidth,noOfTabs){oneTabWidth=oneTabWidth-5;if(oneTabWidth*noOfTabs+marginWidth*noOfTabs<=totalWidth)return oneTabWidth;return reduce(totalWidth,oneTabWidth,marginWidth,noOfTabs)}function increase(totalWidth,oneTabWidth,marginWidth,noOfTabs){oneTabWidth=oneTabWidth+5;if(oneTabWidth*noOfTabs+marginWidth*noOfTabs>=totalWidth)return reduce(totalWidth,oneTabWidth,marginWidth,noOfTabs);return increase(totalWidth,oneTabWidth,marginWidth,noOfTabs)}var resize={collision:function($div1,$div2){var x1=$div1.offset().left;var y1=$div1.offset().top;var h1=$div1.outerHeight(true);var w1=$div1.outerWidth(true);var b1=y1+h1;var r1=x1+w1;var x2=$div2.offset().left;var y2=$div2.offset().top;var h2=$div2.outerHeight(true);var w2=$div2.outerWidth(true);var b2=y2+h2;var r2=x2+w2;if(b1<y2||y1>b2||r1<x2||x1>r2)return false;return true},getMargin:function(){if(!this.cachedMargin){var marginArr=holder.find("li:eq(0)").css("margin").split(/[a-z]+/);var mWidth;if(marginArr&&marginArr.length>=3&&(mWidth=Math.abs(marginArr[3].trim()))){this.cachedMargin=mWidth}}return this.cachedMargin},isOverflow:function(){return this.getTotalWidth()>this.getHolderWidth()},isUnderflow:function(){return this.getTotalWidth()<=this.getHolderWidth()},getHolderWidth:function(){return holder.width()},moveToFirst:function(){return tabHolder.css("margin-left",rects.left+"px")},moveNext:function(){var no=this.getSingleTabWidth()-this.getMargin();return tabHolder.css("margin-left",this.getHolderMargin()-no)},compareTwoRect:function(holdRect,cTabRect){holdRect=$.extend({},holdRect);cTabRect=$.extend({},cTabRect);cTabRect.top=cTabRect.top-rects.top;if(cTabRect.top>holdRect.top){this.moveNext()}else{this.checkLeft(holdRect,cTabRect)}this.updateArrow()},checkLeft:function(hRect,tRect){tRect.left+=rects.left;if(hRect.left>tRect.left){this.moveToFirst()}else if(hRect.left<tRect.left&&hRect.right>tRect.right){}else{this.moveNext()}},getSingleTabWidth:function(){return tabHolder.children("li:eq(0)").width()},getTotalWidth:function(){var noOfTabs=tabHolder.children("li:not(#1)").length;var width=this.getSingleTabWidth();width=noOfTabs*width-noOfTabs*this.getMargin();return width},getDifference:function(){return holder.width()-this.getTotalWidth()},setHolderMargin:function(no){if(no&&(no=parseInt(no))){tabHolder.css("margin-left",no+"px")}return tabHolder},getHolderMargin:function(){return parseInt(tabHolder.css("margin-left").replace(/[^0-9\-]*/g,""))},canMoveRight:function(){var holderRect=holder.get(0).getBoundingClientRect();var lastTab=tabHolder.children("li:nth-last-child(1)").get(0);if(lastTab){var lastTabRect=lastTab.getBoundingClientRect();var isTopEqual=holderRect.top==lastTabRect.top-rects.top;return!isTopEqual||holderRect.right<lastTabRect.right}},canMoveLeft:function(){var holderRect=holder.get(0).getBoundingClientRect();var firstTab=tabHolder.children("li:eq(1)").get(0);if(firstTab){var firstTabRect=firstTab.getBoundingClientRect();var isTopEqual=holderRect.top==firstTabRect.top-rects.top;return isTopEqual&&holderRect.left>firstTabRect.left+rects.left}},goPrevious:function(){var ret;if(this.canMoveLeft()){var tabWithOutMargin=this.getSingleTabWidth()-this.getMargin();ret=this.setHolderMargin(this.getHolderMargin()+tabWithOutMargin);this.updateArrow();return ret}},goNext:function(){var ret;if(this.canMoveRight()){var tabWithOutMargin=this.getSingleTabWidth()-this.getMargin();ret=this.setHolderMargin(this.getHolderMargin()-tabWithOutMargin);this.updateArrow();return ret}},updateArrow:function(){if(this.canMoveRight())rightArrow.removeClass("noActive");else{rightArrow.addClass("noActive")}if(this.canMoveLeft()){leftArrow.removeClass("noActive")}else{leftArrow.addClass("noActive");this.setHolderMargin(rects.left)}},check:function(){var ret;if(this.isOverflow()){ret=this.setHolderMargin(this.getDifference());sliderHolder.removeClass("hide")}else{ret=this.setHolderMargin(rects.left);sliderHolder.addClass("hide")}this.updateArrow();return ret},shortcutTabSwitchEvent:function(){var hRect=holder.get(0).getBoundingClientRect();var tRect=$("#"+util.tabs.getActiveTabId()).get(0).getBoundingClientRect();this.compareTwoRect(hRect,tRect)}};util.subscribe("module/controller/onload",constructStyleCss);util.subscribe("/tabs/resize/dynamic",shrinkTabs);util.subscribe("/tabs/resize/dynamic2",resize,resize.check);util.subscribe("/tabs/move/right",resize,resize.goNext);util.subscribe("/tabs/move/left",resize,resize.goPrevious);util.subscribe("/tabs/move/update/arrows",resize,resize.updateArrow);util.subscribe("/switch/tab/shortcut",resize,resize.shortcutTabSwitchEvent);module.exports.scroll=resize;module.exports.dynamic={getMarginWidth:resize.getMargin,getTotalWidth:resize.getTotalWidth,getSingleTabWidth:shrinkTabs,updateWidth:updateWidth,increase:increase,reduce:reduce}})();(function(util){var argv=util.getSharedObject().cliArgs;if(argv&&argv["disable-network-check"]){return false}var networkDetect={timeInt:5e3,setIntIns:null,checkFlag:false,trueCheck:[],prevNetStatus:null,info:{up:0,down:0,sampleCount:0,limit:2,reset:function(){this.up=this.down=this.sampleCount=0}},clrTrueCheck:function(){this.trueCheck=[]},resetVal:function(){this.info.reset();this.checkFlag=false;this.clrTrueCheck()},activate:function(){this.setTimer(this.timeInt)},setTimer:function(time){this.setIntIns=setInterval(function(){try{this.checkInternet(function(arg){util.publish("/network/detection/status",arg);this.netStatus(arg)}.bind(this))}catch(e){console.warn("Error in networkDetection at checkInternet try-catch block : ",e);this.deactivate()}}.bind(this),time)},netStatus:function(value){if(this.checkFlag)return this.evaluateStatus.call(this.info,value);if(!value)return this.runFalseBlock(value);else if(value)return this.runTrueBlock(value);else console.warn("unknown value from is-online : ",value)},runFalseBlock:function(arg){this.checkFlag=true;this.info.up=this.trueCheck.length;this.info.sampleCount=this.trueCheck.length?this.trueCheck.length+1:++this.info.sampleCount;return this.trueCheck.length==this.info.limit-1?this.evaluateStatus.call(this.info,arg):this.info.down++},runTrueBlock:function(arg){this.trueCheck.push(arg);if(this.trueCheck.length>=this.info.limit){this.clrTrueCheck();return this.sendNetStatus(true)}},deactivate:function(){clearInterval(this.setIntIns);this.resetVal();util.publish("/network/strength/UI/clear",0);return this.setIntIns=null},evaluateStatus:function(value){value==true?this.up++:this.down++;this.sampleCount++;if(this.sampleCount>=this.limit){if(this.down>=this.limit){networkDetect.resetVal();return networkDetect.sendNetStatus(false)}else if(this.up>=this.limit-1){networkDetect.resetVal();return networkDetect.sendNetStatus(true)}}return this},checkInternet:function(cb){require("is-online")(function(err,online){cb(online)})},sendNetStatus:function(arg){if(arg!==this.prevNetStatus){var ob=new Thinclient("networkDetection");ob[ob.opt].isUp=arg;FULLClient.ipc.sendToChat(ob);util.analytics.push(FULLClient.getMode()+" "+FULLClient.getManifest().version+" "+process.platform,"n/w","N/A",arg==true?"up":"down");this.prevNetStatus=arg;return arg}return arg}};window.addEventListener("offline",function(){networkDetect.deactivate();networkDetect.sendNetStatus(false);setTimeout(function(){networkDetect.activate()},5e3)});module.exports=networkDetect;util.subscribe("module/controller/onload",networkDetect,networkDetect.activate)})(util);(function(util){var argv=util.getSharedObject().cliArgs;if(argv&&argv["disable-network-check"]){return false}var networkDetect={checkFlag:false,trueCheck:[],wifi:$(".wifi_strength.fr")[0],info:{up:0,down:0,sampleCount:0,limit:5,reset:function(){this.up=this.down=this.sampleCount=0},getPercentVal:function(percentage){return Math.round(this.limit*percentage/100)}},clrTrueCheck:function(){this.trueCheck=[]},resetVal:function(){this.info.reset();this.clrTrueCheck();this.checkFlag=false},manipulateDom:function(bar){this.resetVal();$(networkDetect.wifi).removeClass("wifi0_signal").removeClass("wifi4_signal").removeClass("wifi3_signal").removeClass("wifi2_signal").removeClass("wifi1_signal");return $(networkDetect.wifi).addClass("wifi"+bar+"_signal")},netStatus:function(value){if(this.checkFlag)return this.evaluateStatus.call(this.info,value);if(!value)return this.runFalseBlock(value);else if(value)return this.runTrueBlock(value);else console.warn("unknown value from is-online : ",value)},runFalseBlock:function(arg){this.checkFlag=true;this.info.up=this.trueCheck.length;this.info.sampleCount=this.trueCheck.length?this.trueCheck.length+1:++this.info.sampleCount;return this.trueCheck.length==this.info.limit-1?this.evaluateStatus.call(this.info,arg):this.info.down++},runTrueBlock:function(arg){this.trueCheck.push(arg);if(this.trueCheck.length>=this.info.limit){this.info.up=this.info.sampleCount=this.trueCheck.length;this.clrTrueCheck();return this.evaluateStatus.call(this.info,true)}},evaluateStatus:function(value){value==true?this.up++:this.down++;this.sampleCount++;if(this.sampleCount>=this.limit){switch(true){case this.up>=this.getPercentVal(90):return networkDetect.manipulateDom(4);case this.up>=this.getPercentVal(70):return networkDetect.manipulateDom(3);case this.up>=this.getPercentVal(50):return networkDetect.manipulateDom(2);case this.up>=this.getPercentVal(10):return networkDetect.manipulateDom(1);case this.up<1:return networkDetect.manipulateDom(0);default:networkDetect.resetVal()}}}};window.addEventListener("online",function(){networkDetect.manipulateDom(1)});module.exports=networkDetect;util.subscribe("/network/detection/status",networkDetect,networkDetect.netStatus);util.subscribe("/network/strength/UI/clear",networkDetect,networkDetect.manipulateDom)})(util);(function(R,util){var maxtabcounter={pushNumberOfTabsLoadedInfo:function(){var loadedTabs=util.tabs.getAllTabs().length,localObj=this.getMaxNumberOfTabsLoadedInfo();if(localObj&&loadedTabs>localObj.numberOfTabsLoaded){localObj.numberOfTabsLoaded=loadedTabs;localObj.winResolution=JSON.stringify(util.getCurrentWindow().getBounds());util.storage.set("TabInfoToAnalytics",localObj)}},getMaxNumberOfTabsLoadedInfo:function(){return util.storage.get("TabInfoToAnalytics")},checkAnalyticsTabInfo:function(){if(!util.storage.get("TabInfoToAnalytics")){util.storage.set("TabInfoToAnalytics",{numberOfTabsLoaded:0,daim:0,winResolution:""})}this.sendTabInfoToAnalytics()},sendTabInfoToAnalytics:function(){var lastStoredObj=this.getMaxNumberOfTabsLoadedInfo(),currentTime=Date.now(),count,winResolution;count=lastStoredObj.numberOfTabsLoaded?lastStoredObj.numberOfTabsLoaded.toString():"0";winResolution=lastStoredObj.winResolution?lastStoredObj.winResolution.toString():"Window_Resolution_N/A";if(lastStoredObj&&lastStoredObj.daim==0&&lastStoredObj.numberOfTabsLoaded!==0){lastStoredObj.daim=currentTime;lastStoredObj.numberOfTabsLoaded=0;lastStoredObj.winResolution="";util.storage.set("TabInfoToAnalytics",lastStoredObj);util.analytics.push(null,analytics.MAX_LOADED_TABS,winResolution,count)}if(lastStoredObj&&lastStoredObj.numberOfTabsLoaded!==0&&currentTime-lastStoredObj.daim>1e3*60*60*24){lastStoredObj.daim=currentTime;lastStoredObj.numberOfTabsLoaded=0;lastStoredObj.winResolution="";util.storage.set("TabInfoToAnalytics",lastStoredObj);console.log("Storing LoadedTabInfo :",this.getMaxNumberOfTabsLoadedInfo());util.analytics.push(null,analytics.MAX_LOADED_TABS,winResolution,count)}}};util.subscribe("/maxtabcounter/pushNumberOfTabsLoadedInfo",maxtabcounter,maxtabcounter.pushNumberOfTabsLoadedInfo);util.subscribe("/maxtabcounter/checkAnalyticsTabInfo",maxtabcounter,maxtabcounter.checkAnalyticsTabInfo)})(this,util);(function(util){function findInPage(webview,text,isForward){if(webview&&text&&jQuery.type(text)==="string"){return webview.findInPage(text,{forward:isForward||false})}else removeOridinalMatch()}function showFindUI(){dom.parent.show().find("input").focus().select()}function hideFindUI(){dom.parent.hide()}function removeOridinalMatch(){dom.ordinalMatch.text("");uiController.stopFind()}function stopFindInPage(webview){if(webview){webview.stopFindInPage("keepSelection")}}function isAPIChangeDetected(e){if(e.result.finalUpdate&&util.isNumber(e.result.activeMatchOrdinal)){this.setOrdinal(e.result.activeMatchOrdinal);this.setRequestID(e.result.requestId);return true}}function updateOrdinalMatch(e){if(!e.result.finalUpdate){this.setOrdinal(e.result.activeMatchOrdinal);this.setRequestID(e.result.requestId)}else{isAPIChangeDetected.call(this,e);if(e.result.requestId==this.getRequestID()){this.setMatches(e.result.matches)}else{this.clear()}this.displayMatches()}}updateOrdinalMatch.displayMatches=function(){if(util.isNumber(this.getOrdinal())&&util.isNumber(this.getMatches())){dom.ordinalMatch.text(this.getOrdinal()+" of "+this.getMatches())}};updateOrdinalMatch.clear=function(){this.setOrdinal(0);this.setMatches(0);this.setRequestID(0)};updateOrdinalMatch.setRequestID=function(v){this.requestId=v};updateOrdinalMatch.getRequestID=function(v){return this.requestId};updateOrdinalMatch.setMatches=function(v){this.matches=v};updateOrdinalMatch.getMatches=function(v){return this.matches};updateOrdinalMatch.setOrdinal=function(v){this.ordinal=v};updateOrdinalMatch.getOrdinal=function(v){return this.ordinal};var dom={parent:$(".findsearch_hold"),input:$(".findsearch_hold").find("input"),previous:$(".findsearch_hold").find("#previousSearch"),next:$(".findsearch_hold").find("#nextSearch"),close:$(".findsearch_hold").find("#closeFindUI"),ordinalMatch:$(".findsearch_hold").find("input").siblings("span"),addListener:function(){this.input.on("keyup",uiController.changeEvent.bind(uiController));this.input.on("cut",uiController.changeEvent.bind(uiController));this.input.on("paste",uiController.changeEvent.bind(uiController));this.next.on("click",function(){uiController.find(dom.input.val(),true)});this.previous.on("click",function(){uiController.find(dom.input.val(),false)});this.close.on("click",function(){hideFindUI()})}};var uiController={getDom:function(){return util.tabs.getActiveTab()||document.querySelector("#LoginModule")},changeEvent:function(e){var keycode=e.keyCode;var valid=keycode>47&&keycode<58||keycode==32||keycode==8||keycode==17||keycode==91||keycode>64&&keycode<91||keycode>95&&keycode<112||keycode>185&&keycode<193||keycode>218&&keycode<223;if(valid){this.find(e.target.value)}else{switch(e.keyCode||e.type){case 27:{uiController.stopFind();hideFindUI();util.tabs.focusActiveTab();util.preventEvent(e);break}case 119:{console.check("Send event to frame",e);this.getDom().sendInputEvent({type:"keyDown",keyCode:"F8"});this.getDom().focus();break}case 13:{this.find(e.target.value,true);util.publish("/answerphrase/close/active/ap");break}default:{break}}}},find:function(txt,isForward){return findInPage(uiController.getDom(),txt,isForward)},stopFind:function(){return stopFindInPage(uiController.getDom())}};util.subscribe("/webview/found/in/page/",function(e){updateOrdinalMatch.call(updateOrdinalMatch,e)});module.exports={controller:uiController,dom:dom,findInPage:findInPage,stopFindInPage:stopFindInPage};util.subscribe("/find/in/page/show",showFindUI);util.subscribe("/find/in/page/hide",hideFindUI);util.subscribe("module/controller/onload",dom,dom.addListener)})(util);(function($,util){try{var mailhelper={mailSend:function(data,callback){console.log("Pushing Mail to Dev"+JSON.stringify(data));return $.ajax({url:"http://beta.sb.a-cti.com/InitialAccountAction/sendFailureNotification.do",type:"POST",data:{acctNum:"",subject:data.subject||"Default Subject line from @"+userDAO.getEmail(),bodyOfMail:this.generateEMailHTML(data),mailAddress:"dev.sb@a-cti.com"}}).pipe(function doneFilter(){console.warn("mail sent successfully : ",data);if(callback)callback()},function failFilter(){if(callback)callback();console.warn("mailsender failed : ",data);if(this.isTabClose(data)){console.warn("Resending mail Tab-Xclose info after 10 secs ..",data);setTimeout(function(){console.log("this :",this);this.mailSend.call(this,data,callback)}.bind(this),1e4)}}.bind(this))},isTabClose:function(data){if(data.type=="tab-XClose")return true},isErrMail:function(data){if(data.type=="Error Log")return true},generateEMailHTML:function(data){var logsHTML="";logsHTML+="<html>";logsHTML+="<head>";if(this.isTabClose(data)){if(userDAO.getUser())logsHTML+="UserInfo : ( UserName : "+userDAO.getUser().fullname+", Email : "+userDAO.getUser().email+" )"+"<br>";logsHTML+="<p>Tab source url : "+data.tabInfo.originalSrcUrl+"</p>";logsHTML+="<p>Last tab location : "+data.tabInfo.currentTabLocation+"</p>";logsHTML+="<p>Tab X-Close Reason : "+data.xCloseReason+"</p>"}else if(this.isErrMail(data)){logsHTML+="<title>Error Log -"+new Date+"</title>";logsHTML+=this.getElectronTemplate();logsHTML+="Date : "+new Date+"<br>";logsHTML+="</div>";logsHTML+="<p>"+data.err.message+"</p>";logsHTML+="<p>"+data.err.stack+"</p>"}logsHTML+="</body>";logsHTML+="</html>";return logsHTML},getElectronTemplate:function(){var elecTemp="";if(!/Electron/.test(navigator.userAgent)||/Tc-webkit/.test(navigator.userAgent))return elecTemp;elecTemp+="Error Log - "+new Date+"<br>";elecTemp+="Version : "+(userDAO.getUser()?"App - "+FULLClient.manifest.version+" ( UserName : "+userDAO.getUser().fullname+", Email : "+userDAO.getUser().email+" )":FULLClient.manifest.version)+"<br>";elecTemp+="Engine Version : "+process.versions["electron"]||process.versions["node-webkit"]+"<br>";elecTemp+="Mode : "+FULLClient.getMode()+"<br>";elecTemp+="User : "+process.env.USER+"<br>";elecTemp+="<p>Config : "+JSON.stringify(FULLClient.getConfig())+"</p><br>";return elecTemp}}}catch(mailhelperSystem){console.error("Exception While updating, zipUpdation.js",mailhelperSystem);console.error("Exception While updating, zipUpdation.js",mailhelperSystem.stack)}util.subscribe("/mailHelper/mailsend",mailhelper,mailhelper.mailSend)})(jQuery,util);