/* KDebug Logs Api */
!function(a){function b(a,b,c){this.name="logs",this.host=a||"FULLClient",this.value=b,this.parentId=c}function c(a){return JSON.stringify(a,function(a,b){return b instanceof Function||"function"==typeof b?b.toString():b instanceof RegExp?"_PxEgEr_"+b:b})}function d(a){this.opt=a||!1,this.registerLogsDB={name:"registerLogsDB",dbName:"logsDB4",storeName:"logStoreV4"},this.getCount={name:"getCount"},this.setLogs={name:"setLogs",args:null,type:null,origin:location.origin,referer:document.referrer,viewName:null},this.clearLogs={name:"clearLogs"},this.getDevEntireLogs={name:"getDevEntireLogs",uniqueID:null,location:location.href,referer:document.referrer,template:{}},this.getLogs={name:"getLogs",uniqueID:null,queryLimit:null,location:location.href,referer:document.referrer,template:{}}}var e,f={getCount:function(){var a=new d("getCount");h.sender(a)},registerDB:function(){var a=new d("registerLogsDB");h.sender(a)},getViewName:function(){return/Electron/.test(navigator.userAgent)?document.title:/Tc-webkit/.test(navigator.userAgent)?!("object"!=typeof self_window||!self_window.name)&&self_window.name:void 0},setLogs:function(a,b){var e=new d("setLogs");e[e.opt].args=c(a),e[e.opt].type=b,e[e.opt].viewName=this.getViewName(),h.sender(e)},isElectron:function(){return!(!/Electron/.test(navigator.userAgent)||/Tc-webkit/.test(navigator.userAgent))},isNodeWebKit:function(){return!/Tc-webkit/.test(navigator.userAgent)},getTemplateInfo:function(){return"undefined"!=typeof userDAO?{engineVersion:process.versions.electron||process.versions["node-webkit"],jsVersion:jsVersion,userDetail:userDAO.getUser()?userDAO.getUser():null,user:process.env.USER,logName:process.env.LOGNAME,tempDir:util.getTempDirectory(),envPath:process.env.PATH,execPath:process.execPath,appUpTime:Math.round(process.uptime()/60),memoryUsage:JSON.stringify(process.memoryUsage())}:{}},getNwTemplate:function(){if(!this.isNodeWebKit())return"";var a=this.getTemplateInfo();return"undefined"!=typeof gui&&"undefined"!=typeof _appConfig?(a.appVersion=gui.App.manifest.version,a.mode=_appConfig.mode,a.config=JSON.stringify(_appConfig),a):void 0},getElectronTemplate:function(){if(!this.isElectron())return null;var a=this.getTemplateInfo();return a.appVersion=FULLClient.manifest.version,a.mode=FULLClient.getMode(),a.config=JSON.stringify(FULLClient.getConfig()),a},clearLogsReq:function(){var a=new d("clearLogs");h.sender(a)},getLogsReq:function(a,b){var c=b?"getLogs":"getDevEntireLogs",e=new d(c);e[e.opt].uniqueID=a,e[e.opt].queryLimit=b||null,e[e.opt].template=this.getElectronTemplate()||this.getNwTemplate(),h.sender(e)}},g={cbMap:{},isCallBackValid:function(a){return!(!a||"function"!=typeof a)},store:function(a,b,c,d){var e=a;this.cbMap[e]={},this.cbMap[e].cb=b,this.cbMap[e].context=c||null,f.getLogsReq(e,d)},handler:function(a){if(a.error)return console.check("Error while Getting Logs : ",error);var c=a.parentId,d=this.cbMap[c];d.cb.call(d.context||null,new b(location.host,a.logData,c)),setTimeout(function(){this.reclaimMemory(c)}.bind(this),0)},reclaimMemory:function(a){delete this.cbMap[a]}},h={countDfd:null,init:function(){"undefined"!=typeof webworker_script&&setTimeout(function(){var a=window.URL.createObjectURL(new Blob(["("+webworker_script.toString()+")()"],{type:"text/javascript"}));e=new Worker(a),f.registerDB(),e.onmessage=function(a){h.receiver(a)}},0)}(),sender:function(a){e&&e.postMessage(a)},receiver:function(a){var a=a.data,b=a&&a[a.opt]?a[a.opt]:null;if(b)switch(b.name){case"captureLogs":g.handler(b);break;case"getLogsCount":this.countDfd.resolve(b.error||b.count);break;default:console.check("Default Sequence in worker response")}}},i={user_name:"SB Devs",user_email:"sithika.abdhul@a-cti.com",loopKey:"agtzfmxvb3BhYmFja3IRCxIETG9vcBiAgICi28uSCQw",loopUrl:"http://test.loopaback.appspot.com//forms/getBlobUploadUrl?type=feedback",getUniqueId:function(){return(new Date).valueOf()},trigger:function(a){console.check("reached err Log with Limit : ",a),g.store(this.getUniqueId(),function(a){this.processLogObj(a)},i,a||1e3)},getLogBlb:function(a){return new Blob([a],{type:"text/html"})},processLogObj:function(a){this.createFormData(this.getLogBlb(a),location.host)},getUploadUrl:function(){return console.check("Getting Blob Url ..."),$.ajax({url:this.loopUrl,type:"POST",crossDomain:!0,data:{time:(new Date).getTime()}}).pipe(function(a){return a.blobUrl?(console.check("getUploadUrl :: blob url successfully Recieved ",a.blobUrl),a.blobUrl):(console.check("getUploadUrl :: doneFilter ::blob url failure :: requeued "),this.getUploadUrl())},function(){console.check("failed request  :",arguments)}.bind(this))},getBlobUrlAndSend:function(a){return this.getUploadUrl().pipe(function(b){return console.check("Sending Feedback ..."),{url:b,FormData:a}}).pipe(this.sendFeedback)},sendFeedback:function(a){return $.ajax({url:a.url,type:"POST",processData:!1,contentType:!1,enctype:"multipart/form-data",data:a.FormData}).pipe(function(a){return"sent"},function(){return console.check("FeedBack Failed to sent for ErroIntimation Mail Sequence :: ",arguments),this.sendFeedback(a)})},createFormData:function(a,b){console.check("Form data creation in Error log Intimation Mail Sequence");var c=new FormData;c.append("card_title","ErrorLog Message !!!"),c.append("feedbackAttachment",a,b),c.append("t",(new Date).getTime()),c.append("tag","suggestion"),c.append("loopKey",this.loopKey),c.append("user_name",this.user_name),c.append("user_email",this.user_email),this.getBlobUrlAndSend(c)}},j={isEmbedded:null,wrap:function(a){return c({action:"logs",source:location.href,logs:a})},isEmbeddedAR:function(){if("boolean"==typeof this.isEmbedded)return this.isEmbedded;var a=/(IndependentRouting.html)/i,b=location.href;return this.isEmbedded=b&&a.test(b)&&window!=window.parent,console.check("is it embedded : ",this.isEmbedded),this.isEmbedded},sendLogsCopy:function(a){try{if(a){var b=this.wrap(a);window.parent.postMessage(b,"*")}}catch(a){console.check("Error log in ARFRAME :",a.message),console.check("Error log in ARFRAME :",a.stack)}}},k={handler:{log:console.log,debug:console.debug,info:console.info,warn:console.warn,error:console.error},isShowLogsInConsole:!0,check:{handler:console.debug,setLogs:function(a){this.handler.apply(console,a)}},enableConsoleView:function(){this.isShowLogsInConsole=!0},disableConsoleView:function(){this.isShowLogsInConsole=!1},getLogs:function(a,b,c,d){g.isCallBackValid(b)?g.store(a,b,c,d||5e3):console.check("Callback is not a function")},clearLogs:function(){f.clearLogsReq()},getDevEntireLogs:function(a,b,c){g.isCallBackValid(b)?g.store(a,b,c,null):console.check("Callback is not a function")},getCount:function(a){g.isCallBackValid(a)?(h.countDfd=$.Deferred(),f.getCount(),$.when(h.countDfd).done(function(b){a(b)})):console.check("Callback is not a function")},setLogs:function(a,b){f.setLogs(b,a),!j.isEmbeddedAR()&&this.isShowLogsInConsole?this.handler[a].apply(console,b):j.sendLogsCopy(b)},extend:function(){for(var a=["log","debug","info","warn","error","check"],b=0;b<a.length;b++){var c=a[b];console[c]=function(a){return function(){"check"==a?k[a].setLogs(arguments):k.setLogs(a,arguments)}}(c)}}()};a.kDebug={errorLogTrigger:i.trigger.bind(i),enableConsoleView:k.enableConsoleView.bind(k),disableConsoleView:k.disableConsoleView.bind(k),clearLogs:k.clearLogs.bind(k),getLogs:k.getLogs.bind(k),getDevEntireLogs:k.getDevEntireLogs.bind(k),getCount:k.getCount.bind(k)}}(this);/* 2015 FULLClient */