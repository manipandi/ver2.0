let userInfo=null;let path=require("path");let namespace={messengerPath:`../assets/comm/messenger.js`,channel:{SB:`msg-to-FULL`,CHAT:`msg-to-Chat`,V2:`msg-to-V2`,Mediator:`msg-to-Mediator`,Main:`msg-to-Main`},preload:{container:`assets/js/preload/preloadContainer.js`,mediator:`assets/js/preload/preloadHiddenWindow.js`,webview:`webPreload.min.js`},module:{messageHandler:`mainMessagingModule`},APP_ID:/^win/.test(process.platform)&&/FULLClient/.test(process.execPath)?`FULL`:`AnywhereWorks`,HIDDEN_CONTAINER:`HiddenWindow`,CONTAINER_CHAT:`AnyWhereWorks`,CONTAINER_CHAT_ALIAS:"Chat",CONTAINER_SB:"FULL",CONTAINER_V2:"V2",CONTAINER_TIMER:"Timer",CONTAINER_V2_SOFTPHONE:"V2SoftPhone",ZOOMIN:`ZoomIn`,ZOOMOUT:`ZoomOut`,ENABLE:`enable`,DISABLE:`disable`,BOTH:`Both`,ALL:`All`,ZOOMIN_LIMIT:9,ZOOMOUT_LIMIT:-8,ZOOM_ACTUAL_SIZE:0,ZOOM_FACTOR:1};let util={config:null,userInfo:null,getConfig(){if(!this.config){try{this.config=require(path.join(process.resourcesPath,"app","config","config.json"))}catch(e){this.config=require(path.join(process.cwd(),"config","config.json"))}}return this.config},getAppPath(){return path.join(path.join(process.resourcesPath,`app`))},getFilePath(){return this.getConfig()&&this.getConfig().mode==`code`?process.cwd():this.getAppPath()},getContainerPreload(){return path.join(this.getFilePath(),namespace.preload.container)},getHiddenWindowPreload(){return path.join(this.getFilePath(),namespace.preload.mediator)},getManifest(){return require(path.join(this.getFilePath(),"package.json"))},getwebPreload(){arr=manifest.main.match(/(.*asar)/g);asarPath=arr&&arr.length?"/"+arr[0]:"/asar/full.asar";return path.join(this.getFilePath(),asarPath,namespace.preload.webview)}};const{app:app,BrowserWindow:BrowserWindow,ipcMain:ipcMain}=require(`electron`);app.commandLine.appendSwitch(`remote-debugging-port`,`9222`);var Emitter=new(require(`events`).EventEmitter);app.on(`ready`,()=>{WindowManager.openHiddenContainer();WindowManager.openChatContainer()});var __BrowserWindow=getBrowserWindowConstructor();function getBrowserWindowConstructor(){if(require&&typeof window=="undefined"){return require("electron").BrowserWindow}else if(FULLClient.require){var remote=util.getRemote();return require("electron").remote.BrowserWindow}}function WindowCreator(url,options,cb){this.url=url;this.options=options;this.cb=cb||function(){};this._windowInstance=null;this.open();this.addDefaultListerners()}WindowCreator.prototype.addDefaultListerners=function(){this.listenCrash()};WindowCreator.prototype.listenCrash=function(){var appWin=this.get();var windowInfo={title:path.basename(this.url,".html"),url:this.url,id:appWin.id};appWin.webContents.on("crashed",function(){console.log("Crashed :: "+windowInfo.title+" id: "+windowInfo.id);Emitter.emit("RendererCrash",windowInfo)})};WindowCreator.prototype.open=function(){if(this.url){this._windowInstance=new __BrowserWindow(this.options);this._windowInstance.loadURL(this.url,{extraHeaders:"pragma: no-cache\n"});this.hideMenuBar();this.show();this.onClose()}};WindowCreator.prototype.get=function(cb,context){if(this._windowInstance){var appWindow=this._windowInstance;if(cb){cb.call(context||null,appWindow)}else{return appWindow}}};WindowCreator.prototype.hideMenuBar=function(){var appWin=this.get();appWin.setMenuBarVisibility(false)};WindowCreator.prototype.onClose=function(){var appWin=this.get();appWin.once("closed",function(){if(this&&this.url){console.log("onclosed ?? :: "+this.url);messageHandler.removeContainer(this.url)}}.bind(this))};WindowCreator.prototype.show=function(){var appWin=this.get();if(this.options&&this.options.show)appWin.show()};WindowCreator.prototype.hide=function(){var appWin=this.get();appWin.hide()};module.exports=WindowCreator;var windowEventsController={eventHandler:function(container,eType,paramsObj){if(container)switch(eType.toLowerCase()){case"enableontop":{container.setAlwaysOnTop(true);!container.isFocused()?container.show():false}case"show":{container.show();break}case"focus":{container.focus();break}case"hide":{if(!container.isFullScreen())container.hide();break}case"setPosition":{container.setPosition(paramsObj.x,paramsObj.y);break}case"disableontop":{container.setAlwaysOnTop(false);break}case"restore":{container.restore();break}case"minimize":{container.minimize();break}case"maximize":{container.maximize();break}case"setsize":{var specs=container.getSize();var width=paramsObj.width?paramsObj.width:specs[0];var height=paramsObj.height?paramsObj.height:specs[1];container.setSize(width,height)}case"blur":{container.blur();break}case"showinactive":{container.showInactive();break}case"bounce":{container.flashFrame(true)}default:{console.log("Default event in windows Events handler");break}}}};var container={cache:{v2:null,sb:null,chat:null},get(title){if(title){switch(title){case"Chat":{title="AnyWhereWorks";break}case namespace.CONTAINER_V2_SOFTPHONE:{title=namespace.CONTAINER_SB;break}case namespace.CONTAINER_CHAT:{title="AnyWhereWorks";break}default:{break}}return this.cache[title]||this.set(title)}},set(title){if(title){this.cache[title]=this.getTarget({title:title});return this.cache[title]}},remove:function(url){let title;if(url&&(title=path.basename(url,".html"))){this.cache[title]=null}},getAll(){return typeof __BrowserWindow!="undefined"?__BrowserWindow.getAllWindows():[]},getById(id){return parseInt(id)&&typeof __BrowserWindow!="undefined"?__BrowserWindow.fromId(id):false},getTarget(lTarget){util.log("searching for Target : ",lTarget);let targetArray=this.getAll();for(let i=targetArray.length-1;i>=0;i--){if(targetArray[i].getURL().indexOf(lTarget.title+".html")!==-1){util.log('container["'+lTarget.title+'"], available ');return targetArray[i]}}},open(options){switch(title){case"V2":{WindowManager.openV2Container();break}case"FULL":{WindowManager.openWebContainer();break}case"Chat":{WindowManager.openChatContainer();break}case"sbMocha":{WindowManager.openSBMochaRunner();break}case"sbJasmineRunner":{WindowManager.openSBJasmineRunner();break}case"v2Mocha":{WindowManager.openV2MochaRunner();break}case"Timer":{if(options)WindowManager.openTimerWidget(options);break}default:{break}}}};let WindowManager={name:"WindowManager",log(){console.log.apply(console,arguments)},openHiddenContainer(){console.log("Hidden Window is getting opened !! ");let filepath=util.getFilePath();let hiddenWindow=new WindowCreator("file://"+util.getFilePath()+"/view/hiddenWindow.html",{title:namespace.HIDDEN_CONTAINER,width:1100,height:680,fullscreen:false,kiosk:false,show:true,minWidth:1100,minHeight:680,webPreferences:{preload:util.getHiddenWindowPreload(),webSecurity:false,allowRunningInsecureContent:true,allowDisplayingInsecureContent:true}});return hiddenWindow.get()},openWebContainer(isShowWindow){console.log("WebContainer is getting opened !! ");if(container.get("FULL"))return;let WebContainer=new WindowCreator("file://"+util.getFilePath()+"/view/FULL.html",{title:namespace.CONTAINER_CHAT,width:1152,height:700,fullscreen:false,kiosk:false,center:true,minWidth:1060,minHeight:680,show:false,webPreferences:{preload:util.getContainerPreload(),webSecurity:false,allowDisplayingInsecureContent:true,allowRunningInsecureContent:true}});this.setSbHandler(WebContainer.get());return WebContainer.get()},setSbHandler(winRef){winRef.on("focus",event=>{Emitter.emit("onFocus",{container:"FULL"});lastFocussedWindow=namespace.CONTAINER_SB});winRef.on("blur",event=>{Emitter.emit("onBlur")})},setV2Handler(winRef){winRef.on("focus",event=>{Emitter.emit("onFocus",{container:"V2"})});winRef.on("blur",event=>{Emitter.emit("onBlur")})},openV2Container(isShowWindow){if(container.get("V2"))return;this.log("V2Container is getting opened !! ");let v2Container=new WindowCreator("file://"+util.getFilePath()+"/view/V2.html",{title:namespace.CONTAINER_V2,width:550,height:710,fullscreen:false,kiosk:false,center:true,show:false,minWidth:550,minHeight:710,webPreferences:{preload:util.getContainerPreload(),webSecurity:false,allowRunningInsecureContent:true,allowDisplayingInsecureContent:true}});this.setV2Handler(v2Container.get())},setChatHandler(winRef){winRef.on("minimize",()=>{let _tc=new Thinclient("state");_tc[_tc.opt]["window"]["isMinimized"]=true;emitterController.chatHandler(null,_tc)});winRef.on("focus",()=>{Emitter.emit("onFocus",{container:"Chat"});lastFocussedWindow=namespace.CONTAINER_CHAT;let _tc=new Thinclient("state");_tc[_tc.opt]["window"]["isFocused"]=true;emitterController.chatHandler(null,_tc)});winRef.on("blur",()=>{Emitter.emit("onBlur");let _tc=new Thinclient("state");_tc[_tc.opt]["window"]["isBlured"]=true;emitterController.chatHandler(null,_tc)});winRef.webContents.on("new-window",e=>{e.preventDefault()})},openChatContainer(){console.log("ChatContainer is getting opened !! ");let filepath=util.getFilePath();let chatContainer=new WindowCreator("file://"+util.getFilePath()+"/view/AnyWhereWorks.html",{title:namespace.CONTAINER_CHAT,width:1100,height:680,fullscreen:false,kiosk:false,show:true,minWidth:1100,minHeight:680,webPreferences:{preload:util.getContainerPreload(),webSecurity:false,allowRunningInsecureContent:true,allowDisplayingInsecureContent:true}})},openTimerWidget(options){if(container.get(namespace.CONTAINER_TIMER))return;let timerContainer=new WindowCreator("file://"+util.getFilePath()+"/view/Timer.html",{title:"TimerWidget",alwaysOnTop:true,frame:false,show:false,width:165,height:85,maxWidth:170,maxHeight:273,x:options?options.x:0,y:options?options.y:0,webPreferences:{preload:this.getPreloadUrl()}});if(parseInt(process.versions["electron"].split(".")[1])<36)timerContainer.get().setAlwaysOnTop(true)},openSBMochaRunner(){this.log("ChatContainer is getting opened !! ");new WindowCreator("file://"+util.getFilePath()+"/tests/html/sbMochaRun.html",{title:"Mocha",width:900,height:600,fullscreen:false,kiosk:false,center:true,webPreferences:{preload:this.getPreloadUrl()}})},openSBJasmineRunner(){this.log("openSBJasmineRunner is getting opened !! ");new WindowCreator("file://"+util.getFilePath()+"/tests/jasmine/view/FULLJasmineRunner.html",{title:namespace.CONTAINER_CHAT+"-JasmineRunner",width:1152,height:700,fullscreen:false,kiosk:false,center:true,minWidth:1060,minHeight:680,show:true,webPreferences:{nodeIntegration:true,preload:this.getPreloadUrl()}})},openV2MochaRunner(){this.log("ChatContainer is getting opened !! ");new WindowCreator("file://"+util.getFilePath()+"/tests/html/v2MochaRun.html",{title:"Mocha",width:900,height:600,fullscreen:false,kiosk:false,center:true,webPreferences:{preload:this.getPreloadUrl()}})},openWebsite(url){this.log("openWebsite is getting opened !! ");new WindowCreator(url,{title:"Website Loading....",width:1152,height:700,fullscreen:false,kiosk:false,center:true,webPreferences:{nodeIntegration:false}})}};let messenger=require(namespace.messengerPath);let messageHandler={name:namespace.module.messageHandler,log(...args){console.log.apply(console,[this.name,args])},passInfo(containerTitle,msg){if(typeof containerTitle=="string"&&typeof msg=="object"){let targetWindow=this.getContainer(containerTitle);if(targetWindow&&targetWindow.send){targetWindow.send("msg-to-"+containerTitle,msg)}}},decider(msg){this.log("Emitter message : ",msg);this.log("Decider Block : "+msg.eType);if(msg&&msg.eType){switch(msg.eType){case"menuActions":{Emitter.emit("switchZoomUI",msg.opt);break}case"transerInfo":{this.transerInfo(msg);break}case"userInfo":{userInfo=msg.userObj;canQuitApp=false;mainModuleLoader.skillBasedLoader();break}case"init":{Emitter.emit("attachAppListeners");break}case"appQuit":{canQuitApp=true;this.passInfo("Chat",msg);this.passInfo("V2",msg);this.passInfo(namespace.CONTAINER_TIMER,msg);this.passInfo=function(){};break}case"bounce":{this.bounce(msg.opt);break}case"dockHide":{this.hideDockIcon(msg.opt);break}case"setBadge":{this.setBadge(msg.count);break}case"setOverlayIcon":{this.setOverlayIcon(msg);break}case"getState":{let _tc=new Thinclient;this.passInfo("Chat",_tc);break}case"windowEvents":{let container;if(msg.id&&parseInt(msg.id))container=WindowManager.getWindowById(msg.id);else container=this.getContainer(msg.title);windowEventsController.eventHandler(container,msg.opt,msg.paramObj);break}case"activateNewV2":{console.log("New v2 switch is on..");ipc.removeAllListeners("msg-to-V2");ipc.on("msg-to-V2",messageHandler.v2NewHandler);break}case"activateOldV2":{console.log("New v2 switch is off..");ipc.removeAllListeners("msg-to-V2");ipc.on("msg-to-V2",messageHandler.v2OldHandler);break}case"loadWebsiteInNewWindow":{WindowManager.openWebsite(msg.url);break}case"reloadV2":{this.passInfo("V2",msg);break}case"open":{container.open(msg);break}case"reLogin":{userInfo={};canQuitApp=true;this.passInfo("FULL",msg);this.passInfo("Chat",msg);this.passInfo("V2",msg);this.passInfo(namespace.CONTAINER_TIMER,msg);Emitter.emit("/network/boot/startup");break}case"isRestored":{if(msg.container){switch(msg.container){case namespace.CONTAINER_V2:{crashManager.track.isV2=false;break}case namespace.CONTAINER_SB:{crashManager.track.isSB=false;break}case namespace.CONTAINER_CHAT:{crashManager.track.isChat=false;break}default:{console.warn("Track : ",msg);break}}}break}case"isCrashed":{if(msg.container){switch(msg.container){case namespace.CONTAINER_V2:{this.passInfo(namespace.CONTAINER_V2,{name:"crashed",crashed:crashManager.track.isV2});break}case namespace.CONTAINER_SB:{this.passInfo(namespace.CONTAINER_SB,{name:"crashed",crashed:crashManager.track.isSB});break}case namespace.CONTAINER_CHAT:{this.passInfo(namespace.CONTAINER_CHAT,{name:"crashed",crashed:crashManager.track.isChat});break}default:{console.warn("Track : ",msg);break}}}break}case"dummyMessage":{msg.isReply=true;this.passInfo("FULL",msg);this.passInfo("Chat",msg);this.passInfo("V2",msg);break}case"crashReporter":{if(msg.source){this.passInfo(msg.source,{name:"crashReporter",port:crashReportServer.port})}break}default:{break}}}},transerInfo(msg){this.log("transerInfo Block :",msg.target);let _target=this.getTarget(msg.target);if(_target&&_target.send)_target.send("msg-from-main",msg)},v2OldHandler(event,msg){messageHandler.passInfo("V2",msg)},v2NewHandler(event,msg){if(msg&&/object/i.test(typeof msg)){msg.isForV2=true;messageHandler.passInfo(namespace.CONTAINER_V2_SOFTPHONE,msg)}},sbHandler(event,msg){messageHandler.passInfo("FULL",msg)},chatHandler(event,msg){messageHandler.passInfo("Chat",msg)},mainHandler(msg){messageHandler.decider(msg)},timerHandler(event,msg){messageHandler.passInfo(namespace.CONTAINER_TIMER,msg)}};messenger.subscribe(namespace.channel.Main,event=>{console.log(`message received  in main : ${event}`);messageHandler.mainHandler(event.data)});var mainModuleLoader={name:"mainModuleLoader",log:function(){console.log.apply(console,arguments)}};mainModuleLoader.skillBasedLoader=function(){console.log("skillBasedLoader ...");if(typeof userInfo!="undefined"&&Object.keys(userInfo).length){console.log("use contact available..");Emitter.emit("/user/contact/available");if(userInfo.isCEA){this.customerExecutiveAssociate()}else if(userInfo.isFullWork){console.log("chat mode ...");this.chatMode()}else{this.callCenterMode()}}};mainModuleLoader.customerExecutiveAssociate=function(){WindowManager.openWebContainer(true);windowEventsController.eventHandler(messageHandler.getContainer(namespace.CONTAINER_CHAT),"show");if(/win/.test(process.platform))windowEventsController.eventHandler(messageHandler.getContainer(namespace.CONTAINER_CHAT),"restore");WindowManager.openV2Container(true)};mainModuleLoader.chatMode=function(){windowEventsController.eventHandler(messageHandler.getContainer(namespace.CONTAINER_CHAT),"show");if(/win/.test(process.platform))windowEventsController.eventHandler(messageHandler.getContainer(namespace.CONTAINER_CHAT),"restore");WindowManager.openWebContainer(false);WindowManager.openV2Container(false)};mainModuleLoader.callCenterMode=function(){WindowManager.openWebContainer(true);WindowManager.openV2Container(false);windowEventsController.eventHandler(messageHandler.getContainer(namespace.CONTAINER_CHAT),"hide")};try{var crashReporter,url,http,formidable,fs,FormData,request,socks,getPort;try{crashReporter=require("electron").crashReporter;url=require("url");http=require("http");formidable=require("formidable");fs=require("fs");FormData=require("form-data");request=require("request");getPort=require("get-port")}catch(e){console.log("Required module not found : "+e.message);throw new Error("Stop all Crash service "+e.message)}getPort(function(err,port){crashReportServer.port=port;crashReportServer.startCrashReporter();crashReportServer.startIncomingPort()});var crashReportServer={instance:null,port:null,name:"CrashReportServer",log:function(){console.log.apply(console,arguments)},checkCharacterLimit:function(UserInfo){this.log("Reached checkCharacterLimit function : UserInfo len:",UserInfo.length);if(UserInfo&&UserInfo.length<=500){this.log("UserInfo less than 500.");return UserInfo}else{this.log("UserInfo >500. So truncating..!",UserInfo.substring(0,499));return UserInfo.substring(0,499)}},startCrashReporter:function(){crashReporter.start({productName:"FULLClient-Electron",companyName:"FULLCreative",autoSubmit:true,submitURL:"http://localhost:"+this.port+"/crashreporter",extra:{githuburl:"https://github.com/kamesh-a",email:"kamesh.arumugam@a-cti.com",contact:"+919884228421"}})},logInfoInSpreadSheet:function(attachmentURL){if(userInfo&&userInfo.crashInfo&&userInfo.login){var config=WindowManager.getConfig();var mode=config.mode;var crashInfo=userInfo.crashInfo;var url=config[mode].crashAnalytics+"?userEmailId="+userInfo.login+"&mode="+crashInfo.mode+"&appVersion="+crashInfo.appVersion+"&engine="+crashInfo.engine+"&platform="+crashInfo.platform+"&os="+crashInfo.os+"&dumpfilelink="+attachmentURL||"N/A";console.log("URL:",url);request(url,function(error,response,body){if(!error&&response.statusCode==200){console.log("Crash for user has been logged : "+userInfo?userInfo.login:"unknown")}})}},getdumpfileurl:function(cardId,cb){var url="http://my.loopto.do/loop/agtzfmxvb3BhYmFja3IRCxIETG9vcBiAgICzrN3bCgw/cards/"+cardId;request(url,function(error,response,body){var respbody;if(error)this.logInfoInSpreadSheet(null);if(!error){respbody=response.body;var responseArray=new Function("return ["+respbody+"];")();cb.call(this,responseArray[0][0].attachmentURL)}}.bind(this))},startIncomingPort:function(){crashReportServer.log("Inside crashReportServer.startIncomingPort function:");this.instance=http.createServer(function(req,res){if(req&&req.url.indexOf("/crashreporter")!==-1){var config=WindowManager.getConfig();var mode=config.mode;var form=new formidable.IncomingForm;form.parse(req,function(err,fields,files){this.log("JSON:",JSON.stringify({fields:fields,files:files}));var filePathToLoopTodo=files.upload_file_minidump.path;this.log("Dump file path : ",filePathToLoopTodo);this.log("Dump file name:",files.upload_file_minidump.name);var UserInfo="Date & Time     : "+new Date+"<br>"+"GUID            : "+fields.guid+"<br>"+"Process_Type    : "+fields.process_type+"<br>"+"Prod            : "+fields.prod+"<br>"+"Engine Version  : "+fields.ver+"<br>";var form=new FormData;form.append("t",(new Date).getTime());form.append("tag","CrashReporter");form.append("loopKey","agtzfmxvb3BhYmFja3IRCxIETG9vcBiAgICzrN3bCgw");form.append("user_name",userInfo?userInfo.login:"CrashReporter");form.append("user_email",userInfo?userInfo.login:"unknown");form.append("card_title",this.checkCharacterLimit(UserInfo));form.append("feedbackAttachment",fs.createReadStream(filePathToLoopTodo),{filename:files.upload_file_minidump.name,"content-type":"application/octet-stream"});console.log("LoopURL : ",config[mode].loopURL);request.post(config[mode].loopURL+"/forms/getBlobUploadUrl?type=feedback",function(err,resp,body){if(err){this.logInfoInSpreadSheet(false)}else if(resp&&resp.statusCode==200){this.log("Blob url: ",JSON.parse(body).blobUrl);var localURL=JSON.parse(body).blobUrl;var b=request.post(localURL,function(err,resp,body){this.log("Error : ",err);if(err){this.logInfoInSpreadSheet(false)}else if(resp.body){this.getdumpfileurl(resp.body,this.logInfoInSpreadSheet)}}.bind(this));b._form=form}}.bind(this))}.bind(this));return}res.writeHead(200,{"Access-Control-Allow-Origin":"*"});res.end("Crashreport service is active.")}.bind(this));this.instance.listen(this.port,function(err,info){})}}}catch(e){console.error("Exception in CrashReportServer:",e);console.error("Error is:",e.stack)}var crashManager={name:"crashManager",track:{isSB:false,isChat:false,isV2:false},log:function(){util.log.apply(this,arguments)},proxy:function(){crashManager.notify.apply(crashManager,arguments)},reload:function(windowInfo){switch(windowInfo.title){case namespace.CONTAINER_V2:{this.track.isV2=true;if(/^win32/.test(process.platform)&&/1.4/.test(process.versions.electron)){ipcController.getContainer(namespace.CONTAINER_V2).close();Emitter.emit("/windowManager/open/v2/container",true)}else{ipcController.getContainer(namespace.CONTAINER_V2).webContents.reloadIgnoringCache()}console.log("V2 Window got crashed.");break}case namespace.CONTAINER_SB:{this.track.isSB=true;if(/^win32/.test(process.platform)&&/1.4/.test(process.versions.electron)){ipcController.getContainer(namespace.CONTAINER_SB).close();Emitter.emit("/windowManager/open/sb/container",true)}else{ipcController.getContainer(namespace.CONTAINER_SB).webContents.reloadIgnoringCache()}console.log("FULL Window got crashed.");break}case namespace.CONTAINER_CHAT:{this.track.isChat=true;if(/^win32/.test(process.platform)&&/1.4/.test(process.versions.electron)){ipcController.getContainer(namespace.CONTAINER_CHAT).close();Emitter.emit("/windowManager/open/chat/container",true)}else{ipcController.getContainer(namespace.CONTAINER_CHAT).webContents.reloadIgnoringCache()}console.log("Chat Window got crashed");break}default:{console.log("What title i recieved : ",windowInfo);break}}},notify:function(title){this.log("recieved crash on window : "+title);if(title){this.reload(title)}}};Emitter.on("RendererCrash",crashManager.proxy);var darwinMenuList=[{label:"Application",submenu:[{label:"About Application",selector:"orderFrontStandardAboutPanel:"},{type:"separator"},{label:"Check for Updates...",click:function(){Emitter.emit("checkForUpdates")}},{label:"Hide AnyWhereWorks",role:"hide"},{label:"Hide Others",role:"hideothers"},{label:"Show All",role:"unhide"},{type:"separator"},{label:"Quit",click:function(){app.quit()},accelerator:"Command+Q"}]},{label:"Edit",submenu:[{label:"Undo",accelerator:"CmdOrCtrl+Z",selector:"undo:"},{label:"Redo",accelerator:"Shift+CmdOrCtrl+Z",selector:"redo:"},{type:"separator"},{label:"Cut",accelerator:"CmdOrCtrl+X",selector:"cut:"},{label:"Copy",accelerator:"CmdOrCtrl+C",selector:"copy:"},{label:"Paste",accelerator:"CmdOrCtrl+V",selector:"paste:"},{label:"Select All",accelerator:"CmdOrCtrl+A",selector:"selectAll:"}]},{label:"View",submenu:[{label:"Zoom In",accelerator:"Command+Plus",click:function(item,focusedWindow){Emitter.emit("zoomIn",focusedWindow)}},{label:"Zoom Out",accelerator:"Command+-",click:function(item,focusedWindow){Emitter.emit("zoomOut",focusedWindow)}},{label:"Actual Size",accelerator:"Command+o",click:function(item,focusedWindow){Emitter.emit("resetZoom",focusedWindow)}}]},{label:"Window",role:"window",submenu:[{label:"Minimize",role:"minimize"},{label:"Zoom",role:"zoom"},{label:"Close",role:"close"},{label:"Bring All to Front",role:"front"}]},{label:"Help",submenu:[{label:"Report Issue",click:function(event){Emitter.emit("ReportIssue",event)}},{label:"Reset App Data",click:function(){Emitter.emit("clearCache")}}]}];var winMenuList=[{label:"Application",submenu:[{label:"About Application"},{type:"separator"},{label:"Check for Updates...",click:function(){menuActions.checkForUpdates()}},{label:"Hide AnyWhereWorks",accelerator:"Command+H",role:"hide"},{label:"Hide Others",accelerator:"Option+Command+H",role:"hideothers"},{label:"Show All",role:"unhide"},{type:"separator"},{label:"Quit",accelerator:"Command+Q",click:function(){app.quit()}}]},{label:"Edit",submenu:[{label:"Undo",accelerator:"CmdOrCtrl+Z",selector:"undo"},{label:"Redo",accelerator:"Shift+CmdOrCtrl+Z",selector:"redo"},{type:"separator"},{label:"Cut",accelerator:"CmdOrCtrl+X",selector:"cut"},{label:"Copy",accelerator:"CmdOrCtrl+C",selector:"copy"},{label:"Paste",accelerator:"CmdOrCtrl+V",selector:"paste"},{label:"Select All",accelerator:"CmdOrCtrl+A",selector:"selectAll"}]},{label:"View",submenu:[{label:"Zoom In",click:function(item,focusedWindow){console.log("zoom in");menuActions.zoomIn(focusedWindow)}},{label:"Zoom Out",click:function(item,focusedWindow){menuActions.zoomOut(focusedWindow)}},{label:"Actual Size",click:function(item,focusedWindow){console.log("actual size");menuActions.resetZoom(focusedWindow)}}]},{label:"Window",role:"window",submenu:[{label:"Minimize",accelerator:"CmdOrCtrl+Z",role:"minimize"},{label:"Zoom",accelerator:"Shift+CmdOrCtrl+Z",role:"zoom"},{label:"Close",accelerator:"Shift+CmdOrCtrl+Z",role:"close"},{label:"Bring All to Front",role:"front"}]},{label:"Help",submenu:[{label:"Report Issue",click:function(event){menuActions.sendSignalToChat(event)}},{label:"Reset App Data",click:function(){menuActions.clearCache()}}]}];var menuActions={menu:null,template:null,isMac:function(){return/^darwin/.test(process.platform)},setNativeMenu:function(){this.menu=require("electron").Menu;if(this.isMac()){this.setNativeMenuForMac(darwinMenuList);this.attachListener()}else{}},setNativeMenuForMac:function(template){if(template){this.template=this.menu.buildFromTemplate(template);this.menu.setApplicationMenu(this.template)}},setNativeMenuForWin:function(template){console.log("setting native menu for windows..",ipcController.getContainer(namespace.CONTAINER_CHAT));console.log("is fn available ? ",ipcController.getContainer(namespace.CONTAINER_CHAT).setMenu);ipcController.getContainer(namespace.CONTAINER_CHAT).setMenu(new this.menu(this.template))},sendSignalToChat:function(_event){var msg=new Thinclient("menu");msg[msg.opt].metainfo.menu="Help";msg[msg.opt].metainfo.menuitem=_event.label;this.contactRenderer(namespace.CONTAINER_CHAT_ALIAS,msg)},getTarget:function(ref){var winTitleList=[namespace.CONTAINER_CHAT,namespace.CONTAINER_SB];var targetArray=[namespace.CONTAINER_CHAT_ALIAS,namespace.CONTAINER_SB];for(var i=targetArray.length-1;i>=0;i--){if(ref.getURL().indexOf(winTitleList[i]+".html")!==-1){return targetArray[i]}}},contactRenderer:function(containerTitle,message){if(containerTitle&&message){ipcController.passInfo(containerTitle,message)}},checkForUpdates:function(){this.contactRenderer("Chat",new Application("checkForUpdates"))},enableZoomIn:function(){this.template.items[2].submenu.items[0].enabled=true},disableZoomIn:function(){this.template.items[2].submenu.items[0].enabled=false},enableZoomOut:function(){this.template.items[2].submenu.items[1].enabled=true},disableZoomOut:function(){this.template.items[2].submenu.items[1].enabled=false},enableActualSize:function(){this.template.items[2].submenu.items[2].enabled=true},disableActualSize:function(){this.template.items[2].submenu.items[2].enabled=false},enableReportIssue:function(){this.template.items[4].submenu.items[0].enabled=true},disableReportIssue:function(){this.template.items[4].submenu.items[0].enabled=false},enableResetAppData:function(){this.template.items[4].submenu.items[1].enabled=true},disableResetAppData:function(){this.template.items[4].submenu.items[1].enabled=false},enableCheckForUpdates:function(){this.template.items[0].submenu.items[2].enabled=true},disableCheckForUpdates:function(){this.template.items[0].submenu.items[2].enabled=false},disableZooming:function(){this.disableZoomOut();this.disableZoomIn();this.disableActualSize()},disableAll:function(){this.disableZoomOut();this.disableZoomIn();this.disableActualSize();this.disableCheckForUpdates();this.disableResetAppData();this.disableReportIssue()},enableAll:function(){this.enableZoomIn();this.enableZoomOut();this.enableActualSize();this.enableCheckForUpdates();this.enableResetAppData();this.enableReportIssue()},enableBoth:function(){this.enableZoomIn();this.enableZoomOut()},isContactAvail:function(){if(userInfo&&Object.keys(userInfo).length)return true;else return false},onBlur:function(){if(this.isContactAvail()){this.disableZooming()}},onFocus:function(option){if(this.isContactAvail()){if(option.container&&option.container=="V2"){this.disableZooming()}else{this.enableActualSize();this.contactRenderer(option.container,new Application("onFocus"))}}},zoomIn:function(winRef){this.contactRenderer(this.getTarget(winRef),new Application("zoomIn"))},zoomOut:function(winRef){this.contactRenderer(this.getTarget(winRef),new Application("zoomOut"))},resetZoom:function(winRef){this.contactRenderer(this.getTarget(winRef),new Application("resetZoom"))},clearCache:function(){this.contactRenderer("FULL",new Application("clearCache"))},switchZoomUI:function(option){switch(option){case"enableZoomIn":{this.enableZoomIn();break}case"enableZoomOut":{this.enableZoomOut();break}case"disableZoomIn":{this.disableZoomIn();break}case"disableZoomOut":{this.disableZoomOut();break}case"enableBoth":{this.enableBoth();break}case"disableAll":{this.disableAll();break}default:{console.log("default sequence in zoomUI ...",option)}}},attachListener:function(){Emitter.on("zoomIn",menuActions.zoomIn.bind(menuActions));Emitter.on("zoomOut",menuActions.zoomOut.bind(menuActions));Emitter.on("resetZoom",menuActions.resetZoom.bind(menuActions));Emitter.on("ReportIssue",menuActions.sendSignalToChat.bind(menuActions));Emitter.on("clearCache",menuActions.clearCache.bind(menuActions));Emitter.on("checkForUpdates",menuActions.checkForUpdates.bind(menuActions));Emitter.on("switchZoomUI",menuActions.switchZoomUI.bind(menuActions));Emitter.on("onBlur",menuActions.onBlur.bind(menuActions));Emitter.on("onFocus",menuActions.onFocus.bind(menuActions));Emitter.on("/user/contact/available",menuActions.enableAll.bind(menuActions))}};Emitter.on("mainOnload",menuActions.setNativeMenu.bind(menuActions));